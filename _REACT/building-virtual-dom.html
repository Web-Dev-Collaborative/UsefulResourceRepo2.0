<!DOCTYPE html>
<html>
  <head>
    <title>building-virtual-dom</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="file:///c:\Users\bryan\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.21\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css"
    />

    <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
      code[class*="language-"],
      pre[class*="language-"] {
        color: #333;
        background: none;
        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
        text-align: left;
        white-space: pre;
        word-spacing: normal;
        word-break: normal;
        word-wrap: normal;
        line-height: 1.4;

        -moz-tab-size: 8;
        -o-tab-size: 8;
        tab-size: 8;

        -webkit-hyphens: none;
        -moz-hyphens: none;
        -ms-hyphens: none;
        hyphens: none;
      }

      /* Code blocks */
      pre[class*="language-"] {
        padding: 0.8em;
        overflow: auto;
        /* border: 1px solid #ddd; */
        border-radius: 3px;
        /* background: #fff; */
        background: #f5f5f5;
      }

      /* Inline code */
      :not(pre) > code[class*="language-"] {
        padding: 0.1em;
        border-radius: 0.3em;
        white-space: normal;
        background: #f5f5f5;
      }

      .token.comment,
      .token.blockquote {
        color: #969896;
      }

      .token.cdata {
        color: #183691;
      }

      .token.doctype,
      .token.punctuation,
      .token.variable,
      .token.macro.property {
        color: #333;
      }

      .token.operator,
      .token.important,
      .token.keyword,
      .token.rule,
      .token.builtin {
        color: #a71d5d;
      }

      .token.string,
      .token.url,
      .token.regex,
      .token.attr-value {
        color: #183691;
      }

      .token.property,
      .token.number,
      .token.boolean,
      .token.entity,
      .token.atrule,
      .token.constant,
      .token.symbol,
      .token.command,
      .token.code {
        color: #0086b3;
      }

      .token.tag,
      .token.selector,
      .token.prolog {
        color: #63a35c;
      }

      .token.function,
      .token.namespace,
      .token.pseudo-element,
      .token.class,
      .token.class-name,
      .token.pseudo-class,
      .token.id,
      .token.url-reference .token.variable,
      .token.attr-name {
        color: #795da3;
      }

      .token.entity {
        cursor: help;
      }

      .token.title,
      .token.title .token.punctuation {
        font-weight: bold;
        color: #1d3e81;
      }

      .token.list {
        color: #ed6a43;
      }

      .token.inserted {
        background-color: #eaffea;
        color: #55a532;
      }

      .token.deleted {
        background-color: #ffecec;
        color: #bd2c00;
      }

      .token.bold {
        font-weight: bold;
      }

      .token.italic {
        font-style: italic;
      }

      /* JSON */
      .language-json .token.property {
        color: #183691;
      }

      .language-markup .token.tag .token.punctuation {
        color: #333;
      }

      /* CSS */
      code.language-css,
      .language-css .token.function {
        color: #0086b3;
      }

      /* YAML */
      .language-yaml .token.atrule {
        color: #63a35c;
      }

      code.language-yaml {
        color: #183691;
      }

      /* Ruby */
      .language-ruby .token.function {
        color: #333;
      }

      /* Markdown */
      .language-markdown .token.url {
        color: #795da3;
      }

      /* Makefile */
      .language-makefile .token.symbol {
        color: #795da3;
      }

      .language-makefile .token.variable {
        color: #183691;
      }

      .language-makefile .token.builtin {
        color: #0086b3;
      }

      /* Bash */
      .language-bash .token.keyword {
        color: #0086b3;
      }

      /* highlight */
      pre[data-line] {
        position: relative;
        padding: 1em 0 1em 3em;
      }
      pre[data-line] .line-highlight-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        background-color: transparent;
        display: block;
        width: 100%;
      }

      pre[data-line] .line-highlight {
        position: absolute;
        left: 0;
        right: 0;
        padding: inherit 0;
        margin-top: 1em;
        background: hsla(24, 20%, 50%, 0.08);
        background: linear-gradient(
          to right,
          hsla(24, 20%, 50%, 0.1) 70%,
          hsla(24, 20%, 50%, 0)
        );
        pointer-events: none;
        line-height: inherit;
        white-space: pre;
      }

      pre[data-line] .line-highlight:before,
      pre[data-line] .line-highlight[data-end]:after {
        content: attr(data-start);
        position: absolute;
        top: 0.4em;
        left: 0.6em;
        min-width: 1em;
        padding: 0 0.5em;
        background-color: hsla(24, 20%, 50%, 0.4);
        color: hsl(24, 20%, 95%);
        font: bold 65%/1.5 sans-serif;
        text-align: center;
        vertical-align: 0.3em;
        border-radius: 999px;
        text-shadow: none;
        box-shadow: 0 1px white;
      }

      pre[data-line] .line-highlight[data-end]:after {
        content: attr(data-end);
        top: auto;
        bottom: 0.4em;
      }
      html body {
        font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans,
          sans-serif;
        font-size: 16px;
        line-height: 1.6;
        color: #333;
        background-color: #fff;
        overflow: initial;
        box-sizing: border-box;
        word-wrap: break-word;
      }
      html body > :first-child {
        margin-top: 0;
      }
      html body h1,
      html body h2,
      html body h3,
      html body h4,
      html body h5,
      html body h6 {
        line-height: 1.2;
        margin-top: 1em;
        margin-bottom: 16px;
        color: #000;
      }
      html body h1 {
        font-size: 2.25em;
        font-weight: 300;
        padding-bottom: 0.3em;
      }
      html body h2 {
        font-size: 1.75em;
        font-weight: 400;
        padding-bottom: 0.3em;
      }
      html body h3 {
        font-size: 1.5em;
        font-weight: 500;
      }
      html body h4 {
        font-size: 1.25em;
        font-weight: 600;
      }
      html body h5 {
        font-size: 1.1em;
        font-weight: 600;
      }
      html body h6 {
        font-size: 1em;
        font-weight: 600;
      }
      html body h1,
      html body h2,
      html body h3,
      html body h4,
      html body h5 {
        font-weight: 600;
      }
      html body h5 {
        font-size: 1em;
      }
      html body h6 {
        color: #5c5c5c;
      }
      html body strong {
        color: #000;
      }
      html body del {
        color: #5c5c5c;
      }
      html body a:not([href]) {
        color: inherit;
        text-decoration: none;
      }
      html body a {
        color: #08c;
        text-decoration: none;
      }
      html body a:hover {
        color: #00a3f5;
        text-decoration: none;
      }
      html body img {
        max-width: 100%;
      }
      html body > p {
        margin-top: 0;
        margin-bottom: 16px;
        word-wrap: break-word;
      }
      html body > ul,
      html body > ol {
        margin-bottom: 16px;
      }
      html body ul,
      html body ol {
        padding-left: 2em;
      }
      html body ul.no-list,
      html body ol.no-list {
        padding: 0;
        list-style-type: none;
      }
      html body ul ul,
      html body ul ol,
      html body ol ol,
      html body ol ul {
        margin-top: 0;
        margin-bottom: 0;
      }
      html body li {
        margin-bottom: 0;
      }
      html body li.task-list-item {
        list-style: none;
      }
      html body li > p {
        margin-top: 0;
        margin-bottom: 0;
      }
      html body .task-list-item-checkbox {
        margin: 0 0.2em 0.25em -1.8em;
        vertical-align: middle;
      }
      html body .task-list-item-checkbox:hover {
        cursor: pointer;
      }
      html body blockquote {
        margin: 16px 0;
        font-size: inherit;
        padding: 0 15px;
        color: #5c5c5c;
        background-color: #f0f0f0;
        border-left: 4px solid #d6d6d6;
      }
      html body blockquote > :first-child {
        margin-top: 0;
      }
      html body blockquote > :last-child {
        margin-bottom: 0;
      }
      html body hr {
        height: 4px;
        margin: 32px 0;
        background-color: #d6d6d6;
        border: 0 none;
      }
      html body table {
        margin: 10px 0 15px 0;
        border-collapse: collapse;
        border-spacing: 0;
        display: block;
        width: 100%;
        overflow: auto;
        word-break: normal;
        word-break: keep-all;
      }
      html body table th {
        font-weight: bold;
        color: #000;
      }
      html body table td,
      html body table th {
        border: 1px solid #d6d6d6;
        padding: 6px 13px;
      }
      html body dl {
        padding: 0;
      }
      html body dl dt {
        padding: 0;
        margin-top: 16px;
        font-size: 1em;
        font-style: italic;
        font-weight: bold;
      }
      html body dl dd {
        padding: 0 16px;
        margin-bottom: 16px;
      }
      html body code {
        font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
        font-size: 0.85em !important;
        color: #000;
        background-color: #f0f0f0;
        border-radius: 3px;
        padding: 0.2em 0;
      }
      html body code::before,
      html body code::after {
        letter-spacing: -0.2em;
        content: "\00a0";
      }
      html body pre > code {
        padding: 0;
        margin: 0;
        font-size: 0.85em !important;
        word-break: normal;
        white-space: pre;
        background: transparent;
        border: 0;
      }
      html body .highlight {
        margin-bottom: 16px;
      }
      html body .highlight pre,
      html body pre {
        padding: 1em;
        overflow: auto;
        font-size: 0.85em !important;
        line-height: 1.45;
        border: #d6d6d6;
        border-radius: 3px;
      }
      html body .highlight pre {
        margin-bottom: 0;
        word-break: normal;
      }
      html body pre code,
      html body pre tt {
        display: inline;
        max-width: initial;
        padding: 0;
        margin: 0;
        overflow: initial;
        line-height: inherit;
        word-wrap: normal;
        background-color: transparent;
        border: 0;
      }
      html body pre code:before,
      html body pre tt:before,
      html body pre code:after,
      html body pre tt:after {
        content: normal;
      }
      html body p,
      html body blockquote,
      html body ul,
      html body ol,
      html body dl,
      html body pre {
        margin-top: 0;
        margin-bottom: 16px;
      }
      html body kbd {
        color: #000;
        border: 1px solid #d6d6d6;
        border-bottom: 2px solid #c7c7c7;
        padding: 2px 4px;
        background-color: #f0f0f0;
        border-radius: 3px;
      }
      @media print {
        html body {
          background-color: #fff;
        }
        html body h1,
        html body h2,
        html body h3,
        html body h4,
        html body h5,
        html body h6 {
          color: #000;
          page-break-after: avoid;
        }
        html body blockquote {
          color: #5c5c5c;
        }
        html body pre {
          page-break-inside: avoid;
        }
        html body table {
          display: table;
        }
        html body img {
          display: block;
          max-width: 100%;
          max-height: 100%;
        }
        html body pre,
        html body code {
          word-wrap: break-word;
          white-space: pre;
        }
      }
      .markdown-preview {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }
      .markdown-preview .pagebreak,
      .markdown-preview .newpage {
        page-break-before: always;
      }
      .markdown-preview pre.line-numbers {
        position: relative;
        padding-left: 3.8em;
        counter-reset: linenumber;
      }
      .markdown-preview pre.line-numbers > code {
        position: relative;
      }
      .markdown-preview pre.line-numbers .line-numbers-rows {
        position: absolute;
        pointer-events: none;
        top: 1em;
        font-size: 100%;
        left: 0;
        width: 3em;
        letter-spacing: -1px;
        border-right: 1px solid #999;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }
      .markdown-preview pre.line-numbers .line-numbers-rows > span {
        pointer-events: none;
        display: block;
        counter-increment: linenumber;
      }
      .markdown-preview pre.line-numbers .line-numbers-rows > span:before {
        content: counter(linenumber);
        color: #999;
        display: block;
        padding-right: 0.8em;
        text-align: right;
      }
      .markdown-preview .mathjax-exps .MathJax_Display {
        text-align: center !important;
      }
      .markdown-preview:not([for="preview"]) .code-chunk .btn-group {
        display: none;
      }
      .markdown-preview:not([for="preview"]) .code-chunk .status {
        display: none;
      }
      .markdown-preview:not([for="preview"]) .code-chunk .output-div {
        margin-bottom: 16px;
      }
      .scrollbar-style::-webkit-scrollbar {
        width: 8px;
      }
      .scrollbar-style::-webkit-scrollbar-track {
        border-radius: 10px;
        background-color: transparent;
      }
      .scrollbar-style::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background-color: rgba(150, 150, 150, 0.66);
        border: 4px solid rgba(150, 150, 150, 0.66);
        background-clip: content-box;
      }
      html body[for="html-export"]:not([data-presentation-mode]) {
        position: relative;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        margin: 0;
        padding: 0;
        overflow: auto;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])
        .markdown-preview {
        position: relative;
        top: 0;
      }
      @media screen and (min-width: 914px) {
        html
          body[for="html-export"]:not([data-presentation-mode])
          .markdown-preview {
          padding: 2em calc(50% - 457px + 2em);
        }
      }
      @media screen and (max-width: 914px) {
        html
          body[for="html-export"]:not([data-presentation-mode])
          .markdown-preview {
          padding: 2em;
        }
      }
      @media screen and (max-width: 450px) {
        html
          body[for="html-export"]:not([data-presentation-mode])
          .markdown-preview {
          font-size: 14px !important;
          padding: 1em;
        }
      }
      @media print {
        html
          body[for="html-export"]:not([data-presentation-mode])
          #sidebar-toc-btn {
          display: none;
        }
      }
      html
        body[for="html-export"]:not([data-presentation-mode])
        #sidebar-toc-btn {
        position: fixed;
        bottom: 8px;
        left: 8px;
        font-size: 28px;
        cursor: pointer;
        color: inherit;
        z-index: 99;
        width: 32px;
        text-align: center;
        opacity: 0.4;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        #sidebar-toc-btn {
        opacity: 1;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100%;
        padding: 32px 0 48px 0;
        font-size: 14px;
        box-shadow: 0 0 4px rgba(150, 150, 150, 0.33);
        box-sizing: border-box;
        overflow: auto;
        background-color: inherit;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc::-webkit-scrollbar {
        width: 8px;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc::-webkit-scrollbar-track {
        border-radius: 10px;
        background-color: transparent;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc::-webkit-scrollbar-thumb {
        border-radius: 5px;
        background-color: rgba(150, 150, 150, 0.66);
        border: 4px solid rgba(150, 150, 150, 0.66);
        background-clip: content-box;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc
        a {
        text-decoration: none;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc
        ul {
        padding: 0 1.6em;
        margin-top: 0.8em;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc
        li {
        margin-bottom: 0.8em;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .md-sidebar-toc
        ul {
        list-style-type: none;
      }
      html
        body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
        .markdown-preview {
        left: 300px;
        width: calc(100% - 300px);
        padding: 2em calc(50% - 457px - 150px);
        margin: 0;
        box-sizing: border-box;
      }
      @media screen and (max-width: 1274px) {
        html
          body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
          .markdown-preview {
          padding: 2em;
        }
      }
      @media screen and (max-width: 450px) {
        html
          body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc]
          .markdown-preview {
          width: 100%;
        }
      }
      html
        body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc])
        .markdown-preview {
        left: 50%;
        transform: translateX(-50%);
      }
      html
        body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc])
        .md-sidebar-toc {
        display: none;
      }
      /* Please visit the URL below for more information: */
      /*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
    </style>
  </head>
  <body for="html-export">
    <div class="mume markdown-preview">
      <h2 class="mume-header" id="overview">Overview</h2>

      <ul>
        <li><a href="#overview">Overview</a></li>
        <li>
          <a href="#background-what-is-virtual-dom-"
            >Background: What is Virtual DOM? </a
          ><a name="background" href></a>
          <ul>
            <li>
              <a href="#didnt-mention-in-the-talk"
                >Didn&apos;t mention in the talk</a
              >
            </li>
          </ul>
        </li>
        <li><a href="#setup-">Setup </a><a name="setup" href></a></li>
        <li>
          <a href="#createelement-tagname-options-"
            >createElement (tagName, options) </a
          ><a name="createElement" href></a>
          <ul>
            <li>
              <a href="#didnt-mention-in-the-talk-1"
                >Didn&apos;t mention in the talk</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="#render-vnode-">render (vNode) </a><a name="render" href></a>
          <ul>
            <li>
              <a href="#rendering-virtual-elements-"
                >Rendering virtual elements </a
              ><a name="rendering-velem" href></a>
            </li>
            <li>
              <a href="#elementnode-and-textnode-">ElementNode and TextNode </a
              ><a name="elem-and-text" href></a>
            </li>
            <li>
              <a href="#extending-render-to-support-textnode-"
                >Extending render to support TextNode </a
              ><a name="extend-rendering-for-textnode" href></a>
            </li>
            <li>
              <a href="#render-our-vapp">Render our <code>vApp</code>!</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="#mount-node-target-"
            >mount (<span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow
                      ><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi
                      ><mo separator="true">,</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >node,</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="
                      height: 0.8888799999999999em;
                      vertical-align: -0.19444em;
                    "
                  ></span
                  ><span class="mord mathnormal">n</span
                  ><span class="mord mathnormal">o</span
                  ><span class="mord mathnormal">d</span
                  ><span class="mord mathnormal">e</span
                  ><span class="mpunct">,</span></span
                ></span
              ></span
            >target) </a
          ><a name="render" href></a>
        </li>
        <li>
          <a href="#lets-make-our-app-more-interesting-"
            >Let&apos;s make our app more interesting </a
          ><a name="further-improve-app" href></a>
        </li>
        <li>
          <a href="#diff-oldvtree-newvtree">diff (oldVTree, newVTree)</a>
          <ul>
            <li>
              <a href="#diffattrs-oldattrs-newattrs-"
                >diffAttrs (oldAttrs, newAttrs) </a
              ><a name="diffAttrs" href></a>
            </li>
            <li>
              <a href="#diffchildren-oldvchildren-newvchildren-"
                >diffChildren (oldVChildren, newVChildren) </a
              ><a name="diffChildren" href></a>
            </li>
            <li><a href="#finalised-diffjs">Finalised diff.js</a></li>
          </ul>
        </li>
        <li>
          <a href="#make-our-app-more-complicated"
            >Make our app more complicated</a
          >
        </li>
      </ul>
      <h2
        class="mume-header"
        id="background-what-is-virtual-dom-a-namebackgrounda"
      >
        Background: What is Virtual DOM? <a name="background" href></a>
      </h2>

      <p>
        Virtual DOMs usually refer to
        <strong>plain objects</strong> representing the actual
        <a
          href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction"
          >DOM</a
        >s.
      </p>
      <blockquote>
        <p>
          The Document Object Model (DOM) is a programming interface for HTML
          documents.
        </p>
      </blockquote>
      <p>For example, when you do this:</p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        You will get the DOM for
        <code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code> on the page.
        This DOM will have some programming interface for you to control it. For
        example:
      </p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      >$app<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">;</span>
</pre>
      <p>
        To make a plain object to represent <code>$app</code>, we can write
        something like this:
      </p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token punctuation">{</span>
  tagName<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <h3 class="mume-header" id="didnt-mention-in-the-talk">
        Didn&apos;t mention in the talk
      </h3>

      <p>
        There is no strict rule of how the virtual DOM should look like. You can
        call it <code>tagLabel</code> instead of <code>tagName</code>, or
        <code>props</code> instead of <code>attrs</code>. As soon as it
        represents the DOM, it is a &quot;virtual DOM&quot;.
      </p>
      <p>
        Virtual DOM will not have any of those programming interface. This is
        what makes them <strong>lightweight</strong> comparing to actual DOMs.
      </p>
      <p>
        However, keep in mind that since DOMs are the fundamental elements of
        the browser, most browsers must have done some serious optimisation to
        them. So actual DOMs might not be as slow as many people claim.
      </p>
      <h2 class="mume-header" id="setup-a-namesetupa">
        Setup <a name="setup" href></a>
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/7wqm7pv476?expanddevtools=1"
            >https://codesandbox.io/s/7wqm7pv476?expanddevtools=1</a
          >
        </p>
      </blockquote>
      <p>We start of by creating and going into our project directory.</p>
      <pre
        data-role="codeBlock"
        data-info
        class="language-"
      ><code>$ mkdir /tmp/vdommm
$ cd /tmp/vdommm
</code></pre>
      <p>
        We will then initiate the git repo, create the
        <code>.gitignore</code> file with
        <a href="https://www.npmjs.com/package/gitignorer">gitignorer</a> and
        initiate npm.
      </p>
      <pre data-role="codeBlock" data-info class="language-"><code>$ git init
$ gitignore init node
$ npm init -y
</code></pre>
      <p>Let&apos;s do out initial commit.</p>
      <pre data-role="codeBlock" data-info class="language-"><code>$ git add -A
$ git commit -am &apos;:tada: initial commit&apos;
</code></pre>
      <p>
        Next, install <a href="https://parceljs.org/">Parcel Bundler</a> the
        truly zero-configuration bundler. It supports all kinds of file format
        out of the box. It is always my choice of bundler in live-coding talks.
      </p>
      <pre
        data-role="codeBlock"
        data-info
        class="language-"
      ><code>$ npm install parcel-bundler
</code></pre>
      <p>(Fun fact: you no longer need to pass <code>--save</code> anymore.)</p>
      <p>
        While this is installing, let&apos;s create some files in our project.
      </p>
      <p><strong>src/index.html</strong></p>
      <pre
        data-role="codeBlock"
        data-info="html"
        class="language-html"
      ><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    Hello world
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token punctuation">{</span>
  tagName<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p><strong>package.json</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token punctuation">{</span>
  <span class="token spread operator">...</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;parcel src/index.html&quot;</span><span class="token punctuation">,</span> <span class="token comment">// add this script</span>
  <span class="token punctuation">}</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span>
</pre>
      <p>Now you can spawn the development server by doing:</p>
      <pre data-role="codeBlock" data-info class="language-"><code>$ npm run dev

&gt; vdommm@0.0.1 dev /private/tmp/vdommm

&gt; parcel src/index.html



Server running at http://localhost:1234

Built in 959ms.
</code></pre>
      <p>
        Going to <a href="http://localhost:1234">http://localhost:1234</a> and
        you should see hello world on the page and the virtual DOM we defined in
        the console. If you see them, then you are correctly set up!
      </p>
      <h2
        class="mume-header"
        id="createelement-tagname-options-a-namecreateelementa"
      >
        createElement (tagName, options) <a name="createElement" href></a>
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/n9641jyo04?expanddevtools=1"
            >https://codesandbox.io/s/n9641jyo04?expanddevtools=1</a
          >
        </p>
      </blockquote>
      <p>
        Most virtual DOM implementation will have this function called
        <code>createElement</code> function, often referred as <code>h</code>.
        These functions will simply return a &quot;virtual element&quot;. So
        let&apos;s implement that.
      </p>
      <p><strong>src/vdom/createElement.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    tagName<span class="token punctuation">,</span>
    attrs<span class="token operator">:</span> opts<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> opts<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <p>With object destructuring we can write the above like this:</p>
      <p><strong>src/vdom/createElement.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    tagName<span class="token punctuation">,</span>
    attrs<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <p>
        We should also allow creating elements without any options, so
        let&apos;s put some default values for out options.
      </p>
      <p><strong>src/vdom/createElement.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    tagName<span class="token punctuation">,</span>
    attrs<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <p>Recall the virtual DOM that we created before:</p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token punctuation">{</span>
  tagName<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>It now can be written as:</p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        Go back to the browser and you should see the same virtual dom as we
        defined previously. Let&apos;s add an image under the
        <code>div</code> sourcing from giphy:
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>Go back to the browser and you should see the updated virtual DOM.</p>
      <h3 class="mume-header" id="didnt-mention-in-the-talk-1">
        Didn&apos;t mention in the talk
      </h3>

      <p>
        Object literals (e.g. <code>{ a: 3 }</code>) automatically inherit from
        <code>Object</code>. This means that the object created by object
        literals will have methods defined in the
        <a
          href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/prototype"
          ><code>Object.prototype</code></a
        >
        like <code>hasOwnProperty</code>, <code>toString</code>, etc.
      </p>
      <p>
        We could make our virtual DOM a little bit &quot;purer&quot; by using
        <code>Object.create(null)</code>. This will create a truly plain object
        that doesn&apos;t inherit from <code>Object</code> but
        <code>null</code> instead.
      </p>
      <p><strong>src/vdom/createElement.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> vElem <span class="token operator">=</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">assign</span><span class="token punctuation">(</span>vElem<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    tagName<span class="token punctuation">,</span>
    attrs<span class="token punctuation">,</span>
    children<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> vElem<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <h2 class="mume-header" id="render-vnode-a-namerendera">
        render (vNode) <a name="render" href></a>
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/pp9wnl5nj0?expanddevtools=1"
            >https://codesandbox.io/s/pp9wnl5nj0?expanddevtools=1</a
          >
        </p>
      </blockquote>
      <h3
        class="mume-header"
        id="rendering-virtual-elements-a-namerendering-velema"
      >
        Rendering virtual elements <a name="rendering-velem" href></a>
      </h3>

      <p>
        Now we got a function that generates virtual DOM for us. Next we need a
        way to translate our virtual DOM to real DOM. Let&apos;s define
        <code>render (vNode)</code> which will take in a virtual node and return
        the corresponding DOM.
      </p>
      <p><strong>src/vdom/render.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vNode</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// create the element</span>
  <span class="token comment">//   e.g. &lt;div&gt;&lt;/div&gt;</span>
  <span class="token keyword">const</span> $el <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// add all attributs as specified in vNode.attrs</span>
  <span class="token comment">//   e.g. &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span>vNode<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $el<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// append all children as specified in vNode.children</span>
  <span class="token comment">//   e.g. &lt;div id=&quot;app&quot;&gt;&lt;img&gt;&lt;/div&gt;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> child <span class="token keyword">of</span> vNode<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $el<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> $el<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> render<span class="token punctuation">;</span>
</pre>
      <p>
        The above code should be quite self-explanatory. I am more than happy to
        explain more tho if there is any request for it.
      </p>
      <hr />
      <h3
        class="mume-header"
        id="elementnode-and-textnode-a-nameelem-and-texta"
      >
        ElementNode and TextNode <a name="elem-and-text" href></a>
      </h3>

      <p>
        In real DOM, there are
        <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType"
          >8 types of nodes</a
        >. In this article, we will only look at two types:
      </p>
      <ol>
        <li>
          <code>ElementNode</code>, such as <code>&lt;div&gt;</code> and
          <code>&lt;img&gt;</code>
        </li>
        <li><code>TextNode</code>, plain texts</li>
      </ol>
      <p>
        Our virtual element structure,
        <code>{ tagName, attrs, children }</code>, only represents the
        <code>ElementNode</code> in the DOM. So we need some representation for
        the <code>TextNode</code> as well. We will simply use
        <code>String</code> to represent <code>TextNode</code>.
      </p>
      <p>
        To demonstrate this, let&apos;s add some text to our current virtual
        DOM.
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">,</span> <span class="token comment">// represents TextNode</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// represents ElementNode</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// represents ElementNode</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <hr />
      <h3
        class="mume-header"
        id="extending-render-to-support-textnode-a-nameextend-rendering-for-textnodea"
      >
        Extending render to support TextNode
        <a name="extend-rendering-for-textnode" href></a>
      </h3>

      <p>
        As I mentioned, we are considering two types of nodes. The current
        <code>render (vNode)</code> only only renders <code>ElementNode</code>.
        So let&apos;s extend <code>render</code> so that it supports rendering
        of <code>TextNode</code> too.
      </p>
      <p>
        We will first rename our existing function <code>renderElem</code> as it
        is what it does. I will also add object destructuring to make the code
        looks nicer.
      </p>
      <p><strong>src/vdom/render.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> <span class="token function-variable function">renderElem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// create the element</span>
  <span class="token comment">//   e.g. &lt;div&gt;&lt;/div&gt;</span>
  <span class="token keyword">const</span> $el <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// add all attributs as specified in vNode.attrs</span>
  <span class="token comment">//   e.g. &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $el<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// append all children as specified in vNode.children</span>
  <span class="token comment">//   e.g. &lt;div id=&quot;app&quot;&gt;&lt;img&gt;&lt;/div&gt;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> child <span class="token keyword">of</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $el<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> $el<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> render<span class="token punctuation">;</span>
</pre>
      <p>
        Let&apos;s redefine <code>render (vNode)</code>. We just need to check
        if <code>vNode</code> is a <code>String</code>. If it is then we can use
        <code>document.createTextNode(string)</code> to render the
        <code>textNode</code>. Otherwise, just call
        <code>renderElem(vNode)</code>.
      </p>
      <p><strong>src/vdom/render.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> <span class="token function-variable function">renderElem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> tagName<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// create the element</span>
  <span class="token comment">//   e.g. &lt;div&gt;&lt;/div&gt;</span>
  <span class="token keyword">const</span> $el <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// add all attributs as specified in vNode.attrs</span>
  <span class="token comment">//   e.g. &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span>attrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $el<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// append all children as specified in vNode.children</span>
  <span class="token comment">//   e.g. &lt;div id=&quot;app&quot;&gt;&lt;img&gt;&lt;/div&gt;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> child <span class="token keyword">of</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $el<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> $el<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">vNode</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> vNode <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createTextNode</span><span class="token punctuation">(</span>vNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// we assume everything else to be a virtual element</span>
  <span class="token keyword control-flow">return</span> <span class="token function">renderElem</span><span class="token punctuation">(</span>vNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> render<span class="token punctuation">;</span>
</pre>
      <p>
        Now our <code>render (vNode)</code> function is capable of rendering two
        types of virtual nodes:
      </p>
      <ol>
        <li>
          Virtual Elements - created with our
          <code>createElement</code> function
        </li>
        <li>Virtual Texts - represented by strings</li>
      </ol>
      <hr />
      <h3 class="mume-header" id="render-our-vapp">
        Render our <code>vApp</code>!
      </h3>

      <p>
        Now let&apos;s try to render our <code>vApp</code> and
        <code>console.log</code> it!
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/render&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>$app<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        Go to the browser and you would see the console showing the DOM for:
      </p>
      <pre
        data-role="codeBlock"
        data-info="html"
        class="language-html"
      ><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  Hello world
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</pre>
      <h2 class="mume-header" id="mount-node-target-a-namerendera">
        mount (<span class="katex"
          ><span class="katex-mathml"
            ><math xmlns="http://www.w3.org/1998/Math/MathML"
              ><semantics
                ><mrow
                  ><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi
                  ><mo separator="true">,</mo></mrow
                ><annotation encoding="application/x-tex"
                  >node,</annotation
                ></semantics
              ></math
            ></span
          ><span class="katex-html" aria-hidden="true"
            ><span class="base"
              ><span
                class="strut"
                style="height: 0.8888799999999999em; vertical-align: -0.19444em"
              ></span
              ><span class="mord mathnormal">n</span
              ><span class="mord mathnormal">o</span
              ><span class="mord mathnormal">d</span
              ><span class="mord mathnormal">e</span
              ><span class="mpunct">,</span></span
            ></span
          ></span
        >target) <a name="render" href></a>
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/vjpk91op47"
            >https://codesandbox.io/s/vjpk91op47</a
          >
        </p>
      </blockquote>
      <p>
        We are now able to create our virtual DOM and render it to real DOM.
        Next we would need to put our real DOM on the page.
      </p>
      <p>
        Let&apos;s first create a mounting point for our app. I will replace the
        <code>Hello world</code> on the <code>src/index.html</code> with
        <code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>.
      </p>
      <p><strong>src/index.html</strong></p>
      <pre
        data-role="codeBlock"
        data-info="html"
        class="language-html"
      ><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>hello world<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</pre>
      <p>
        What we want to do now is to replace this empty <code>div</code> with
        our rendered <code>$app</code>. This is super easy to do if we ignore
        Internet Explorer and Safari. We can just use
        <a
          href="https://developer.mozilla.org/en-US/docs/Web/API/ChildNode/replaceWith"
          ><code>ChildNode.replaceWith</code></a
        >.
      </p>
      <p>
        Let&apos;s define <code>mount ($node, $target)</code>. This function
        will simply replace <code>$target</code> with <code>$node</code> and
        return <code>$node</code>.
      </p>
      <p><strong>src/vdom/mount.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">(</span><span class="token parameter">$node<span class="token punctuation">,</span> $target</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  $target<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <p>
        Now in our <strong>main.js</strong> simply mount our
        <code>$app</code> to the empty div.
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/render&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">mount</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/mount&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
        src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mount</span><span class="token punctuation">(</span>$app<span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        Our app will show on the page now and we should see a cat on the page.
      </p>
      <h2
        class="mume-header"
        id="lets-make-our-app-more-interesting-a-namefurther-improve-appa"
      >
        Let&apos;s make our app more interesting
        <a name="further-improve-app" href></a>
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/ox02294zo5"
            >https://codesandbox.io/s/ox02294zo5</a
          >
        </p>
      </blockquote>
      <p>
        Now let&apos;s make our app more interesting. We will wrap our
        <code>vApp</code> in a function called <code>createVApp</code>. It will
        then take in a <code>count</code> which then the <code>vApp</code> will
        use it.
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/render&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">mount</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/mount&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createVApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
  <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
      dataCount<span class="token operator">:</span> count<span class="token punctuation">,</span> <span class="token comment">// we use the count here</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;The current count is: &quot;</span><span class="token punctuation">,</span>
      <span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// and here</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createVApp</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mount</span><span class="token punctuation">(</span>$app<span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        Then, we will <code>setInterval</code> to increment the count every
        second and create, render and mount our app again on the page.
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/render&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">mount</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/mount&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createVApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
  <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
      dataCount<span class="token operator">:</span> count<span class="token punctuation">,</span> <span class="token comment">// we use the count here</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;The current count is: &quot;</span><span class="token punctuation">,</span>
      <span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// and here</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vApp <span class="token operator">=</span> <span class="token function">createVApp</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> $rootEl <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>$app<span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  $rootEl <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">createVApp</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> $rootEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        Note that I used <code>$rootEl</code> to keep track of the root element.
        So that <code>mount</code> knows where to mount our new app.
      </p>
      <p>
        If we go back to the browser now, we should see the count increment
        every second by 1 and works perfectly!
      </p>
      <p>
        We now gain the power to declaratively create our application. The
        application is rendered predictably and is very very easy to reason
        about. If you know how things are done in the JQuery way, you will
        appreciate how much cleaner this approach is.
      </p>
      <p>
        However, there are a couple of problems with re-rendering the whole
        application every second:
      </p>
      <ol>
        <li>
          Real DOM are much heavier than virtual DOM. Rendering the whole
          application to real DOM can be expensive.
        </li>
        <li>
          Elements will lose their states. For example,
          <code>&lt;input&gt;</code> will lose their focus whenever the
          application re-mount to the page. See live demo
          <a href="https://codesandbox.io/s/6l1v8lwj5k">here</a>.
        </li>
      </ol>
      <p>We will solve these problems in the next section.</p>
      <h2 class="mume-header" id="diff-oldvtree-newvtree">
        diff (oldVTree, newVTree)
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/0xv007yqnv"
            >https://codesandbox.io/s/0xv007yqnv</a
          >
        </p>
      </blockquote>
      <p>
        Imagine we have a function <code>diff (oldVTree, newVTree)</code> which
        calculate the differences between the two virtual trees; return a
        <code>patch</code> function that takes in the real DOM of
        <code>oldVTree</code> and perform appropriate operations to the real DOM
        to make the real DOM looks like the <code>newVTree</code>.
      </p>
      <p>
        If we have that <code>diff</code> function, then we could just re-write
        our interval to become:
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/render&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">mount</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/mount&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">diff</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/diff&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createVApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
  <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
      dataCount<span class="token operator">:</span> count<span class="token punctuation">,</span> <span class="token comment">// we use the count here</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;The current count is: &quot;</span><span class="token punctuation">,</span>
      <span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// and here</span>
      <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vApp <span class="token operator">=</span> <span class="token function">createVApp</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> $rootEl <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>$app<span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vNewApp <span class="token operator">=</span> <span class="token function">createVApp</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>vApp<span class="token punctuation">,</span> vNewApp<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// we might replace the whole $rootEl,</span>
  <span class="token comment">// so we want the patch will return the new $rootEl</span>
  $rootEl <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>$rootEl<span class="token punctuation">)</span><span class="token punctuation">;</span>

  vApp <span class="token operator">=</span> vNewApp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        So let&apos;s try to implement this
        <code>diff (oldVTree, newVTree)</code>. Let&apos;s start with some easy
        cases:
      </p>
      <ol>
        <li>
          <code>newVTree</code> is <code>undefined</code>
          <ul>
            <li>
              we can simply remove the <code>$node</code> passing into the
              <code>patch</code> then!
            </li>
          </ul>
        </li>
        <li>
          They are both TextNode (string)
          <ul>
            <li>If they are the same string, then do nothing.</li>
            <li>
              If they are not, replace <code>$node</code> with
              <code>render(newVTree)</code>.
            </li>
          </ul>
        </li>
        <li>
          One of the tree is TextNode, the other one is ElementNode
          <ul>
            <li>
              In that case they are obviously not the same thing, then we will
              replace <code>$node</code> with <code>render(newVTree)</code>.
            </li>
          </ul>
        </li>
        <li>
          <code>oldVTree.tagName !== newVTree.tagName</code>
          <ul>
            <li>
              we assume that in this case, the old and new trees are totally
              different.
            </li>
            <li>
              instead of trying to find the differences between two trees, we
              will just replace the <code>$node</code> with
              <code>render(newVTree)</code>.
            </li>
            <li>
              this assumption also exists in react. (<a
                href="https://reactjs.org/docs/reconciliation.html#motivation"
                >source</a
              >)
            </li>
            <li>
              <blockquote>
                <p>
                  Two elements of different types will produce different trees.
                </p>
              </blockquote>
            </li>
          </ul>
        </li>
      </ol>
      <p><strong>src/vdom/diff.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./render&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVTree<span class="token punctuation">,</span> newVTree</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// let&apos;s assume oldVTree is not undefined!</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>newVTree <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// the patch should return the new root node.</span>
      <span class="token comment">// since there is none in this case,</span>
      <span class="token comment">// we will just return undefined.</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword nil">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldVTree <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> newVTree <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>oldVTree <span class="token operator">!==</span> newVTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// could be 2 cases:</span>
      <span class="token comment">// 1. both trees are string and they have different values</span>
      <span class="token comment">// 2. one of the trees is text node and</span>
      <span class="token comment">//    the other one is elem node</span>
      <span class="token comment">// Either case, we will just render(newVTree)!</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> $newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newVTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
        $node<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> $newNode<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// this means that both trees are string</span>
      <span class="token comment">// and they have the same values</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">!==</span> newVTree<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we assume that they are totally different and</span>
    <span class="token comment">// will not attempt to find the differences.</span>
    <span class="token comment">// simply render the newVTree and mount it.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> $newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newVTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $newNode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// (A)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> diff<span class="token punctuation">;</span>
</pre>
      <p>If the code reaches <code>(A)</code>, it implies the following:</p>
      <ol>
        <li>
          <code>oldVTree</code> and <code>newVTree</code> are both virtual
          elements.
        </li>
        <li>They have the same <code>tagName</code>.</li>
        <li>
          They might have different <code>attrs</code> and
          <code>children</code>.
        </li>
      </ol>
      <p>
        We will implement two functions to deal with the attributes and children
        separately, namely <code>diffAttrs (oldAttrs, newAttrs)</code> and
        <code>diffChildren (oldVChildren, newVChildren)</code>, which will
        return a patch separately. As we know at this point we are not going to
        replace <code>$node</code>, we can safely return
        <code>$node</code> after applying both patches.
      </p>
      <p><strong>src/vdom/diff.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./render&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diffAttrs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldAttrs<span class="token punctuation">,</span> newAttrs</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diffChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVChildren<span class="token punctuation">,</span> newVChildren</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVTree<span class="token punctuation">,</span> newVTree</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// let&apos;s assume oldVTree is not undefined!</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>newVTree <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// the patch should return the new root node.</span>
      <span class="token comment">// since there is none in this case,</span>
      <span class="token comment">// we will just return undefined.</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword nil">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldVTree <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> newVTree <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>oldVTree <span class="token operator">!==</span> newVTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// could be 2 cases:</span>
      <span class="token comment">// 1. both trees are string and they have different values</span>
      <span class="token comment">// 2. one of the trees is text node and</span>
      <span class="token comment">//    the other one is elem node</span>
      <span class="token comment">// Either case, we will just render(newVTree)!</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> $newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newVTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
        $node<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> $newNode<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// this means that both trees are string</span>
      <span class="token comment">// and they have the same values</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">!==</span> newVTree<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we assume that they are totally different and</span>
    <span class="token comment">// will not attempt to find the differences.</span>
    <span class="token comment">// simply render the newVTree and mount it.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> $newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newVTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $newNode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> patchAttrs <span class="token operator">=</span> <span class="token function">diffAttrs</span><span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">,</span> newVTree<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> patchChildren <span class="token operator">=</span> <span class="token function">diffChildren</span><span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">,</span> newVTree<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">patchAttrs</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">patchChildren</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> diff<span class="token punctuation">;</span>
</pre>
      <h3 class="mume-header" id="diffattrs-oldattrs-newattrs-a-namediffattrsa">
        diffAttrs (oldAttrs, newAttrs) <a name="diffAttrs" href></a>
      </h3>

      <p>
        Let&apos;s first focus on the <code>diffAttrs</code>. It is actually
        pretty easy. We know that we are going to set everything in
        <code>newAttrs</code>. After setting them, we just need to go through
        all the keys in <code>oldAttrs</code> and make sure they all exist in
        <code>newAttrs</code> too. If not, remove them.
      </p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> <span class="token function-variable function">diffAttrs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldAttrs<span class="token punctuation">,</span> newAttrs</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> patches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// setting newAttrs</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span>newAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    patches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// removing attrs</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> k <span class="token keyword">in</span> oldAttrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>k <span class="token keyword">in</span> newAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      patches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        $node<span class="token punctuation">.</span><span class="token method function property-access">removeAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> patch <span class="token keyword">of</span> patches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <p>
        Notice how we create a wrapper patch and loop through the
        <code>patches</code> to apply them.
      </p>
      <h3
        class="mume-header"
        id="diffchildren-oldvchildren-newvchildren-a-namediffchildrena"
      >
        diffChildren (oldVChildren, newVChildren)
        <a name="diffChildren" href></a>
      </h3>

      <p>
        Children would be a little bit more complicated. We can consider three
        cases:
      </p>
      <ol>
        <li>
          <code>oldVChildren.length === newVChildren.length</code>
          <ul>
            <li>
              we can do <code>diff(oldVChildren[i], newVChildren[i])</code
              ><br />
              where <code>i</code> goes from <code>0</code> to
              <code>oldVChildren.length</code>.
            </li>
          </ul>
        </li>
        <li>
          <code>oldVChildren.length &gt; newVChildren.length</code>
          <ul>
            <li>
              we can also do <code>diff(oldVChildren[i], newVChildren[i])</code
              ><br />
              where <code>i</code> goes from <code>0</code> to
              <code>oldVChildren.length</code>.
            </li>
            <li>
              <code>newVChildren[j]</code> will be <code>undefined</code> for
              <code>j &gt;= newVChildren.length</code>
            </li>
            <li>
              But this is fine, because our <code>diff</code> can handle
              <code>diff(vNode, undefined)</code>!
            </li>
          </ul>
        </li>
        <li>
          <code>oldVChildren.length &lt; newVChildren.length</code>
          <ul>
            <li>
              we can also do <code>diff(oldVChildren[i], newVChildren[i])</code
              ><br />
              where <code>i</code> goes from <code>0</code> to
              <code>oldVChildren.length</code>.
            </li>
            <li>
              this loop will create patches for each already existing children
            </li>
            <li>
              we just need to create the remaining additional children i.e.
              <code>newVChildren.slice(oldVChildren.length)</code>.
            </li>
          </ul>
        </li>
      </ol>
      <p>
        To conclude, we loop through <code>oldVChildren</code> regardless and we
        will call <code>diff(oldVChildren[i], newVChildren[i])</code>.
      </p>
      <p>
        Then we will render the additional children (if any), and append them to
        the <code>$node</code>.
      </p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword">const</span> <span class="token function-variable function">diffChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVChildren<span class="token punctuation">,</span> newVChildren</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childPatches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  oldVChildren<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">oldVChild<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    childPatches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token function">diff</span><span class="token punctuation">(</span>oldVChild<span class="token punctuation">,</span> newVChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> additionalPatches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> additionalVChild <span class="token keyword">of</span> newVChildren<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span>oldVChildren<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    additionalPatches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span>newVChildren<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$parent</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// since childPatches are expecting the $child, not $parent,</span>
    <span class="token comment">// we cannot just loop through them and call patch($parent)</span>
    $parent<span class="token punctuation">.</span><span class="token property-access">childNodes</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$child<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      childPatches<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>$child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> patch <span class="token keyword">of</span> additionalPatches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> $parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <p>
        I think it is a little bit more elegant if we use the
        <code>zip</code> function.
      </p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./render&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">zip</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">xs<span class="token punctuation">,</span> ys</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> zipped <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span>xs<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span> ys<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    zipped<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> zipped<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diffChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVChildren<span class="token punctuation">,</span> newVChildren</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childPatches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  oldVChildren<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">oldVChild<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    childPatches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token function">diff</span><span class="token punctuation">(</span>oldVChild<span class="token punctuation">,</span> newVChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> additionalPatches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> additionalVChild <span class="token keyword">of</span> newVChildren<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span>oldVChildren<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    additionalPatches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span>additionalVChild<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$parent</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// since childPatches are expecting the $child, not $parent,</span>
    <span class="token comment">// we cannot just loop through them and call patch($parent)</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>patch<span class="token punctuation">,</span> $child<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">zip</span><span class="token punctuation">(</span>childPatches<span class="token punctuation">,</span> $parent<span class="token punctuation">.</span><span class="token property-access">childNodes</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> patch <span class="token keyword">of</span> additionalPatches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> $parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
      <h3 class="mume-header" id="finalised-diffjs">Finalised diff.js</h3>

      <p><strong>src/vdom/diff.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./render&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">zip</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">xs<span class="token punctuation">,</span> ys</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> zipped <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">min</span><span class="token punctuation">(</span>xs<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span> ys<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    zipped<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> zipped<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diffAttrs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldAttrs<span class="token punctuation">,</span> newAttrs</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> patches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// setting newAttrs</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span>newAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    patches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// removing attrs</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> k <span class="token keyword">in</span> oldAttrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>k <span class="token keyword">in</span> newAttrs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      patches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        $node<span class="token punctuation">.</span><span class="token method function property-access">removeAttribute</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> patch <span class="token keyword">of</span> patches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diffChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVChildren<span class="token punctuation">,</span> newVChildren</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> childPatches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  oldVChildren<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">oldVChild<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    childPatches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token function">diff</span><span class="token punctuation">(</span>oldVChild<span class="token punctuation">,</span> newVChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> additionalPatches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> additionalVChild <span class="token keyword">of</span> newVChildren<span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span>oldVChildren<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    additionalPatches<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span>additionalVChild<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$parent</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// since childPatches are expecting the $child, not $parent,</span>
    <span class="token comment">// we cannot just loop through them and call patch($parent)</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>patch<span class="token punctuation">,</span> $child<span class="token punctuation">]</span> <span class="token keyword">of</span> <span class="token function">zip</span><span class="token punctuation">(</span>childPatches<span class="token punctuation">,</span> $parent<span class="token punctuation">.</span><span class="token property-access">childNodes</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> patch <span class="token keyword">of</span> additionalPatches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>$parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> $parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">diff</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">oldVTree<span class="token punctuation">,</span> newVTree</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// let&apos;s assume oldVTree is not undefined!</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>newVTree <span class="token operator">===</span> <span class="token keyword nil">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// the patch should return the new root node.</span>
      <span class="token comment">// since there is none in this case,</span>
      <span class="token comment">// we will just return undefined.</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword nil">undefined</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldVTree <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> newVTree <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>oldVTree <span class="token operator">!==</span> newVTree<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// could be 2 cases:</span>
      <span class="token comment">// 1. both trees are string and they have different values</span>
      <span class="token comment">// 2. one of the trees is text node and</span>
      <span class="token comment">//    the other one is elem node</span>
      <span class="token comment">// Either case, we will just render(newVTree)!</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> $newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newVTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
        $node<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">return</span> $newNode<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// this means that both trees are string</span>
      <span class="token comment">// and they have the same values</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> $node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">tagName</span> <span class="token operator">!==</span> newVTree<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we assume that they are totally different and</span>
    <span class="token comment">// will not attempt to find the differences.</span>
    <span class="token comment">// simply render the newVTree and mount it.</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> $newNode <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>newVTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
      $node<span class="token punctuation">.</span><span class="token method function property-access">replaceWith</span><span class="token punctuation">(</span>$newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> $newNode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> patchAttrs <span class="token operator">=</span> <span class="token function">diffAttrs</span><span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">,</span> newVTree<span class="token punctuation">.</span><span class="token property-access">attrs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> patchChildren <span class="token operator">=</span> <span class="token function">diffChildren</span><span class="token punctuation">(</span>oldVTree<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">,</span> newVTree<span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token parameter">$node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">patchAttrs</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">patchChildren</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> $node<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> diff<span class="token punctuation">;</span>
</pre>
      <h2 class="mume-header" id="make-our-app-more-complicated">
        Make our app more complicated
      </h2>

      <blockquote>
        <p>
          <a href="https://codesandbox.io/s/mpmo2yy69"
            >https://codesandbox.io/s/mpmo2yy69</a
          >
        </p>
      </blockquote>
      <p>
        Our current app doesn&apos;t really make full use of the power of our
        virtual DOM. To show how powerful our Virtual DOM is, let&apos;s make
        our app more complicated:
      </p>
      <p><strong>src/main.js</strong></p>
      <pre
        data-role="codeBlock"
        data-info="js"
        class="language-javascript"
      ><span class="token keyword module">import</span> <span class="token imports">createElement</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/createElement&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">render</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/render&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">mount</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/mount&quot;</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">diff</span> <span class="token keyword module">from</span> <span class="token string">&quot;./vdom/diff&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createVApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
  <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span>
      dataCount<span class="token operator">:</span> count<span class="token punctuation">,</span> <span class="token comment">// we use the count here</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;The current count is: &quot;</span><span class="token punctuation">,</span>
      <span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// and here</span>
      <span class="token spread operator">...</span><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length<span class="token operator">:</span> count <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span>
        <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
            src<span class="token operator">:</span> <span class="token string">&quot;https://media.giphy.com/media/cuPm4p4pClZVC/giphy.gif&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> vApp <span class="token operator">=</span> <span class="token function">createVApp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>vApp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> $rootEl <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>$app<span class="token punctuation">,</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vNewApp <span class="token operator">=</span> <span class="token function">createVApp</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> patch <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>vApp<span class="token punctuation">,</span> vNewApp<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// we might replace the whole $rootEl,</span>
  <span class="token comment">// so we want the patch will return the new $rootEl</span>
  $rootEl <span class="token operator">=</span> <span class="token function">patch</span><span class="token punctuation">(</span>$rootEl<span class="token punctuation">)</span><span class="token punctuation">;</span>

  vApp <span class="token operator">=</span> vNewApp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
      <p>
        Our app now will generate a random number <code>n</code> between 0 and 9
        and display <code>n</code> cat photos on the page. If you go into the
        dev tools, you will see how we are &quot;intelligently&quot; inserting
        and removing <code>&lt;img&gt;</code> depending on <code>n</code>.
      </p>
    </div>
    <div class="md-sidebar-toc">
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li>
          <a href="#background-what-is-virtual-dom-a-namebackgrounda"
            >Background: What is Virtual DOM?
          </a>
          <ul>
            <li>
              <a href="#didnt-mention-in-the-talk"
                >Didn&apos;t mention in the talk</a
              >
            </li>
          </ul>
        </li>
        <li><a href="#setup-a-namesetupa">Setup </a></li>
        <li>
          <a href="#createelement-tagname-options-a-namecreateelementa"
            >createElement (tagName, options)
          </a>
          <ul>
            <li>
              <a href="#didnt-mention-in-the-talk-1"
                >Didn&apos;t mention in the talk</a
              >
            </li>
          </ul>
        </li>
        <li>
          <a href="#render-vnode-a-namerendera">render (vNode) </a>
          <ul>
            <li>
              <a href="#rendering-virtual-elements-a-namerendering-velema"
                >Rendering virtual elements
              </a>
            </li>
            <li>
              <a href="#elementnode-and-textnode-a-nameelem-and-texta"
                >ElementNode and TextNode
              </a>
            </li>
            <li>
              <a
                href="#extending-render-to-support-textnode-a-nameextend-rendering-for-textnodea"
                >Extending render to support TextNode
              </a>
            </li>
            <li>
              <a href="#render-our-vapp">Render our <code>vApp</code>!</a>
            </li>
          </ul>
        </li>
        <li>
          <a href="#mount-node-target-a-namerendera"
            >mount (<span class="katex"
              ><span class="katex-mathml"
                ><math xmlns="http://www.w3.org/1998/Math/MathML"
                  ><semantics
                    ><mrow
                      ><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi
                      ><mo separator="true">,</mo></mrow
                    ><annotation encoding="application/x-tex"
                      >node,</annotation
                    ></semantics
                  ></math
                ></span
              ><span class="katex-html" aria-hidden="true"
                ><span class="base"
                  ><span
                    class="strut"
                    style="
                      height: 0.8888799999999999em;
                      vertical-align: -0.19444em;
                    "
                  ></span
                  ><span class="mord mathnormal">n</span
                  ><span class="mord mathnormal">o</span
                  ><span class="mord mathnormal">d</span
                  ><span class="mord mathnormal">e</span
                  ><span class="mpunct">,</span></span
                ></span
              ></span
            >target)
          </a>
        </li>
        <li>
          <a
            href="#lets-make-our-app-more-interesting-a-namefurther-improve-appa"
            >Let&apos;s make our app more interesting
          </a>
        </li>
        <li>
          <a href="#diff-oldvtree-newvtree">diff (oldVTree, newVTree)</a>
          <ul>
            <li>
              <a href="#diffattrs-oldattrs-newattrs-a-namediffattrsa"
                >diffAttrs (oldAttrs, newAttrs)
              </a>
            </li>
            <li>
              <a
                href="#diffchildren-oldvchildren-newvchildren-a-namediffchildrena"
                >diffChildren (oldVChildren, newVChildren)
              </a>
            </li>
            <li><a href="#finalised-diffjs">Finalised diff.js</a></li>
          </ul>
        </li>
        <li>
          <a href="#make-our-app-more-complicated"
            >Make our app more complicated</a
          >
        </li>
      </ul>
    </div>
    <a id="sidebar-toc-btn">&#x2261;</a>

    <script>
      var sidebarTOCBtn = document.getElementById("sidebar-toc-btn");
      sidebarTOCBtn.addEventListener("click", function (event) {
        event.stopPropagation();
        if (document.body.hasAttribute("html-show-sidebar-toc")) {
          document.body.removeAttribute("html-show-sidebar-toc");
        } else {
          document.body.setAttribute("html-show-sidebar-toc", true);
        }
      });
    </script>
  </body>
</html>
