<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>morgan</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="morgan">morgan</h1>
    <p>
      <a href="https://npmjs.org/package/morgan"
        ><img src="https://badgen.net/npm/v/morgan" alt="NPM Version"
      /></a>
      <a href="https://npmjs.org/package/morgan"
        ><img src="https://badgen.net/npm/dm/morgan" alt="NPM Downloads"
      /></a>
      <a href="https://travis-ci.org/expressjs/morgan"
        ><img
          src="https://badgen.net/travis/expressjs/morgan/master"
          alt="Build Status"
      /></a>
      <a href="https://coveralls.io/r/expressjs/morgan?branch=master"
        ><img
          src="https://badgen.net/coveralls/c/github/expressjs/morgan/master"
          alt="Test Coverage"
      /></a>
    </p>
    <p>HTTP request logger middleware for node.js</p>
    <blockquote>
      <p>
        Named after
        <a href="http://en.wikipedia.org/wiki/Dexter_Morgan">Dexter</a>, a show
        you should not watch until completion.
      </p>
    </blockquote>
    <h2 id="installation">Installation</h2>
    <p>
      This is a <a href="https://nodejs.org/en/">Node.js</a> module available
      through the <a href="https://www.npmjs.com/">npm registry</a>.
      Installation is done using the
      <a
        href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally"
        ><code>npm install</code> command</a
      >:
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="ex">npm</span> install morgan</a></code></pre>
    </div>
    <h2 id="api">API</h2>
    <!-- eslint-disable no-unused-vars -->
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a></code></pre>
    </div>
    <h3 id="morganformat-options">morgan(format, options)</h3>
    <p>
      Create a new morgan logger middleware function using the given
      <code>format</code> and <code>options</code>. The
      <code>format</code> argument may be a string of a predefined name (see
      below for the names), a string of a format string, or a function that will
      produce a log entry.
    </p>
    <p>
      The <code>format</code> function will be called with three arguments
      <code>tokens</code>, <code>req</code>, and <code>res</code>, where
      <code>tokens</code> is an object with all defined tokens,
      <code>req</code> is the HTTP request and <code>res</code> is the HTTP
      response. The function is expected to return a string that will be the log
      line, or <code>undefined</code> / <code>null</code> to skip logging.
    </p>
    <h4 id="using-a-predefined-format-string">
      Using a predefined format string
    </h4>
    <!-- eslint-disable no-undef -->
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="at">morgan</span>(<span class="st">&#39;tiny&#39;</span>)</a></code></pre>
    </div>
    <h4 id="using-format-string-of-predefined-tokens">
      Using format string of predefined tokens
    </h4>
    <!-- eslint-disable no-undef -->
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="at">morgan</span>(<span class="st">&#39;:method :url :status :res[content-length] - :response-time ms&#39;</span>)</a></code></pre>
    </div>
    <h4 id="using-a-custom-format-function">Using a custom format function</h4>
    <!-- eslint-disable no-undef -->
    <div class="sourceCode" id="cb5">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="at">morgan</span>(<span class="kw">function</span> (tokens<span class="op">,</span> req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="cf">return</span> [</a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="va">tokens</span>.<span class="at">method</span>(req<span class="op">,</span> res)<span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="va">tokens</span>.<span class="at">url</span>(req<span class="op">,</span> res)<span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="va">tokens</span>.<span class="at">status</span>(req<span class="op">,</span> res)<span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="va">tokens</span>.<span class="at">res</span>(req<span class="op">,</span> res<span class="op">,</span> <span class="st">&#39;content-length&#39;</span>)<span class="op">,</span> <span class="st">&#39;-&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-7" title="7">    tokens[<span class="st">&#39;response-time&#39;</span>](req<span class="op">,</span> res)<span class="op">,</span> <span class="st">&#39;ms&#39;</span></a>
<a class="sourceLine" id="cb5-8" title="8">  ].<span class="at">join</span>(<span class="st">&#39; &#39;</span>)</a>
<a class="sourceLine" id="cb5-9" title="9"><span class="op">}</span>)</a></code></pre>
    </div>
    <h4 id="options">Options</h4>
    <p>Morgan accepts these properties in the options object.</p>
    <h5 id="immediate">immediate</h5>
    <p>
      Write log line on request instead of response. This means that a requests
      will be logged even if the server crashes,
      <em
        >but data from the response (like the response code, content length,
        etc.) cannot be logged</em
      >.
    </p>
    <h5 id="skip">skip</h5>
    <p>
      Function to determine if logging is skipped, defaults to
      <code>false</code>. This function will be called as
      <code>skip(req, res)</code>.
    </p>
    <!-- eslint-disable no-undef -->
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// EXAMPLE: only log error responses</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="at">morgan</span>(<span class="st">&#39;combined&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">skip</span><span class="op">:</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span> <span class="cf">return</span> <span class="va">res</span>.<span class="at">statusCode</span> <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="op">}</span>)</a></code></pre>
    </div>
    <h5 id="stream">stream</h5>
    <p>
      Output stream for writing log lines, defaults to
      <code>process.stdout</code>.
    </p>
    <h4 id="predefined-formats">Predefined Formats</h4>
    <p>There are various pre-defined formats provided:</p>
    <h5 id="combined">combined</h5>
    <p>Standard Apache combined log output.</p>
    <pre><code>:remote-addr - :remote-user [:date[clf]] &quot;:method :url HTTP/:http-version&quot; :status :res[content-length] &quot;:referrer&quot; &quot;:user-agent&quot;</code></pre>
    <h5 id="common">common</h5>
    <p>Standard Apache common log output.</p>
    <pre><code>:remote-addr - :remote-user [:date[clf]] &quot;:method :url HTTP/:http-version&quot; :status :res[content-length]</code></pre>
    <h5 id="dev">dev</h5>
    <p>
      Concise output colored by response status for development use. The
      <code>:status</code> token will be colored green for success codes, red
      for server error codes, yellow for client error codes, cyan for
      redirection codes, and uncolored for information codes.
    </p>
    <pre><code>:method :url :status :response-time ms - :res[content-length]</code></pre>
    <h5 id="short">short</h5>
    <p>Shorter than default, also including response time.</p>
    <pre><code>:remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms</code></pre>
    <h5 id="tiny">tiny</h5>
    <p>The minimal output.</p>
    <pre><code>:method :url :status :res[content-length] - :response-time ms</code></pre>
    <h4 id="tokens">Tokens</h4>
    <h5 id="creating-new-tokens">Creating new tokens</h5>
    <p>
      To define a token, simply invoke <code>morgan.token()</code> with the name
      and a callback function. This callback function is expected to return a
      string value. The value returned is then available as “:type” in this
      case:
    </p>
    <!-- eslint-disable no-undef -->
    <div class="sourceCode" id="cb12">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="va">morgan</span>.<span class="at">token</span>(<span class="st">&#39;type&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span> <span class="cf">return</span> <span class="va">req</span>.<span class="at">headers</span>[<span class="st">&#39;content-type&#39;</span>] <span class="op">}</span>)</a></code></pre>
    </div>
    <p>
      Calling <code>morgan.token()</code> using the same name as an existing
      token will overwrite that token definition.
    </p>
    <p>
      The token function is expected to be called with the arguments
      <code>req</code> and <code>res</code>, representing the HTTP request and
      HTTP response. Additionally, the token can accept further arguments of
      it’s choosing to customize behavior.
    </p>
    <h5 id="dateformat">:date[format]</h5>
    <p>The current date and time in UTC. The available formats are:</p>
    <ul>
      <li>
        <code>clf</code> for the common log format (<code
          >"10/Oct/2000:13:55:36 +0000"</code
        >)
      </li>
      <li>
        <code>iso</code> for the common ISO 8601 date time format
        (<code>2000-10-10T13:55:36.000Z</code>)
      </li>
      <li>
        <code>web</code> for the common RFC 1123 date time format (<code
          >Tue, 10 Oct 2000 13:55:36 GMT</code
        >)
      </li>
    </ul>
    <p>If no format is given, then the default is <code>web</code>.</p>
    <h5 id="http-version">:http-version</h5>
    <p>The HTTP version of the request.</p>
    <h5 id="method">:method</h5>
    <p>The HTTP method of the request.</p>
    <h5 id="referrer">:referrer</h5>
    <p>
      The Referrer header of the request. This will use the standard mis-spelled
      Referer header if exists, otherwise Referrer.
    </p>
    <h5 id="remote-addr">:remote-addr</h5>
    <p>
      The remote address of the request. This will use <code>req.ip</code>,
      otherwise the standard <code>req.connection.remoteAddress</code> value
      (socket address).
    </p>
    <h5 id="remote-user">:remote-user</h5>
    <p>The user authenticated as part of Basic auth for the request.</p>
    <h5 id="reqheader">:req[header]</h5>
    <p>
      The given <code>header</code> of the request. If the header is not
      present, the value will be displayed as <code>"-"</code> in the log.
    </p>
    <h5 id="resheader">:res[header]</h5>
    <p>
      The given <code>header</code> of the response. If the header is not
      present, the value will be displayed as <code>"-"</code> in the log.
    </p>
    <h5 id="response-timedigits">:response-time[digits]</h5>
    <p>
      The time between the request coming into <code>morgan</code> and when the
      response headers are written, in milliseconds.
    </p>
    <p>
      The <code>digits</code> argument is a number that specifies the number of
      digits to include on the number, defaulting to <code>3</code>, which
      provides microsecond precision.
    </p>
    <h5 id="status">:status</h5>
    <p>The status code of the response.</p>
    <p>
      If the request/response cycle completes before a response was sent to the
      client (for example, the TCP socket closed prematurely by a client
      aborting the request), then the status will be empty (displayed as
      <code>"-"</code> in the log).
    </p>
    <h5 id="total-timedigits">:total-time[digits]</h5>
    <p>
      The time between the request coming into <code>morgan</code> and when the
      response has finished being written out to the connection, in
      milliseconds.
    </p>
    <p>
      The <code>digits</code> argument is a number that specifies the number of
      digits to include on the number, defaulting to <code>3</code>, which
      provides microsecond precision.
    </p>
    <h5 id="url">:url</h5>
    <p>
      The URL of the request. This will use <code>req.originalUrl</code> if
      exists, otherwise <code>req.url</code>.
    </p>
    <h5 id="user-agent">:user-agent</h5>
    <p>The contents of the User-Agent header of the request.</p>
    <h3 id="morgan.compileformat">morgan.compile(format)</h3>
    <p>
      Compile a format string into a <code>format</code> function for use by
      <code>morgan</code>. A format string is a string that represents a single
      log line and can utilize token syntax. Tokens are references by
      <code>:token-name</code>. If tokens accept arguments, they can be passed
      using <code>[]</code>, for example: <code>:token-name[pretty]</code> would
      pass the string <code>'pretty'</code> as an argument to the token
      <code>token-name</code>.
    </p>
    <p>
      The function returned from <code>morgan.compile</code> takes three
      arguments <code>tokens</code>, <code>req</code>, and <code>res</code>,
      where <code>tokens</code> is object with all defined tokens,
      <code>req</code> is the HTTP request and <code>res</code> is the HTTP
      response. The function will return a string that will be the log line, or
      <code>undefined</code> / <code>null</code> to skip logging.
    </p>
    <p>
      Normally formats are defined using
      <code>morgan.format(name, format)</code>, but for certain advanced uses,
      this compile function is directly available.
    </p>
    <h2 id="examples">Examples</h2>
    <h3 id="expressconnect">express/connect</h3>
    <p>
      Sample app that will log all request in the Apache combined format to
      STDOUT
    </p>
    <div class="sourceCode" id="cb13">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb13-5" title="5"></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;combined&#39;</span>))</a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-9" title="9">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;hello, world!&#39;</span>)</a>
<a class="sourceLine" id="cb13-10" title="10"><span class="op">}</span>)</a></code></pre>
    </div>
    <h3 id="vanilla-http-server">vanilla http server</h3>
    <p>
      Sample app that will log all request in the Apache combined format to
      STDOUT
    </p>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">var</span> finalhandler <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;finalhandler&#39;</span>)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">var</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="co">// create &quot;middleware&quot;</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="kw">var</span> logger <span class="op">=</span> <span class="at">morgan</span>(<span class="st">&#39;combined&#39;</span>)</a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="va">http</span>.<span class="at">createServer</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-9" title="9">  <span class="kw">var</span> done <span class="op">=</span> <span class="at">finalhandler</span>(req<span class="op">,</span> res)</a>
<a class="sourceLine" id="cb14-10" title="10">  <span class="at">logger</span>(req<span class="op">,</span> res<span class="op">,</span> <span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-11" title="11">    <span class="cf">if</span> (err) <span class="cf">return</span> <span class="at">done</span>(err)</a>
<a class="sourceLine" id="cb14-12" title="12"></a>
<a class="sourceLine" id="cb14-13" title="13">    <span class="co">// respond to request</span></a>
<a class="sourceLine" id="cb14-14" title="14">    <span class="va">res</span>.<span class="at">setHeader</span>(<span class="st">&#39;content-type&#39;</span><span class="op">,</span> <span class="st">&#39;text/plain&#39;</span>)</a>
<a class="sourceLine" id="cb14-15" title="15">    <span class="va">res</span>.<span class="at">end</span>(<span class="st">&#39;hello, world!&#39;</span>)</a>
<a class="sourceLine" id="cb14-16" title="16">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb14-17" title="17"><span class="op">}</span>)</a></code></pre>
    </div>
    <h3 id="write-logs-to-a-file">write logs to a file</h3>
    <h4 id="single-file">single file</h4>
    <p>
      Sample app that will log all requests in the Apache combined format to the
      file <code>access.log</code>.
    </p>
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co">// create a write stream (in append mode)</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="kw">var</span> accessLogStream <span class="op">=</span> <span class="va">fs</span>.<span class="at">createWriteStream</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;access.log&#39;</span>)<span class="op">,</span> <span class="op">{</span> <span class="dt">flags</span><span class="op">:</span> <span class="st">&#39;a&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb15-10" title="10"></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">// setup the logger</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;combined&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">stream</span><span class="op">:</span> accessLogStream <span class="op">}</span>))</a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-15" title="15">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;hello, world!&#39;</span>)</a>
<a class="sourceLine" id="cb15-16" title="16"><span class="op">}</span>)</a></code></pre>
    </div>
    <h4 id="log-file-rotation">log file rotation</h4>
    <p>
      Sample app that will log all requests in the Apache combined format to one
      log file per day in the <code>log/</code> directory using the
      <a href="https://www.npmjs.com/package/rotating-file-stream"
        >rotating-file-stream module</a
      >.
    </p>
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw">var</span> rfs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;rotating-file-stream&#39;</span>) <span class="co">// version 2.x</span></a>
<a class="sourceLine" id="cb16-5" title="5"></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co">// create a rotating write stream</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="kw">var</span> accessLogStream <span class="op">=</span> <span class="va">rfs</span>.<span class="at">createStream</span>(<span class="st">&#39;access.log&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-10" title="10">  <span class="dt">interval</span><span class="op">:</span> <span class="st">&#39;1d&#39;</span><span class="op">,</span> <span class="co">// rotate daily</span></a>
<a class="sourceLine" id="cb16-11" title="11">  <span class="dt">path</span><span class="op">:</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;log&#39;</span>)</a>
<a class="sourceLine" id="cb16-12" title="12"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb16-13" title="13"></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="co">// setup the logger</span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;combined&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">stream</span><span class="op">:</span> accessLogStream <span class="op">}</span>))</a>
<a class="sourceLine" id="cb16-16" title="16"></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-18" title="18">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;hello, world!&#39;</span>)</a>
<a class="sourceLine" id="cb16-19" title="19"><span class="op">}</span>)</a></code></pre>
    </div>
    <h3 id="split-dual-logging">split / dual logging</h3>
    <p>
      The <code>morgan</code> middleware can be used as many times as needed,
      enabling combinations like:
    </p>
    <ul>
      <li>Log entry on request and one on response</li>
      <li>Log all requests to file, but errors to console</li>
      <li>… and more!</li>
    </ul>
    <p>
      Sample app that will log all requests to a file using Apache format, but
      error responses are logged to the console:
    </p>
    <div class="sourceCode" id="cb17">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb17-4" title="4"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb17-5" title="5"></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">// log only 4xx and 5xx responses to console</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;dev&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-10" title="10">  <span class="dt">skip</span><span class="op">:</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span> <span class="cf">return</span> <span class="va">res</span>.<span class="at">statusCode</span> <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="op">}</span>))</a>
<a class="sourceLine" id="cb17-12" title="12"></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co">// log all requests to access.log</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;common&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-15" title="15">  <span class="dt">stream</span><span class="op">:</span> <span class="va">fs</span>.<span class="at">createWriteStream</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;access.log&#39;</span>)<span class="op">,</span> <span class="op">{</span> <span class="dt">flags</span><span class="op">:</span> <span class="st">&#39;a&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-16" title="16"><span class="op">}</span>))</a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-19" title="19">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;hello, world!&#39;</span>)</a>
<a class="sourceLine" id="cb17-20" title="20"><span class="op">}</span>)</a></code></pre>
    </div>
    <h3 id="use-custom-token-formats">use custom token formats</h3>
    <p>
      Sample app that will use custom token formats. This adds an ID to all
      requests and displays it using the <code>:id</code> token.
    </p>
    <div class="sourceCode" id="cb18">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">var</span> morgan <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb18-3" title="3"><span class="kw">var</span> uuid <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;node-uuid&#39;</span>)</a>
<a class="sourceLine" id="cb18-4" title="4"></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="va">morgan</span>.<span class="at">token</span>(<span class="st">&#39;id&#39;</span><span class="op">,</span> <span class="kw">function</span> <span class="at">getId</span> (req) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-6" title="6">  <span class="cf">return</span> <span class="va">req</span>.<span class="at">id</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb18-8" title="8"></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb18-10" title="10"></a>
<a class="sourceLine" id="cb18-11" title="11"><span class="va">app</span>.<span class="at">use</span>(assignId)</a>
<a class="sourceLine" id="cb18-12" title="12"><span class="va">app</span>.<span class="at">use</span>(<span class="at">morgan</span>(<span class="st">&#39;:id :method :url :response-time&#39;</span>))</a>
<a class="sourceLine" id="cb18-13" title="13"></a>
<a class="sourceLine" id="cb18-14" title="14"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-15" title="15">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;hello, world!&#39;</span>)</a>
<a class="sourceLine" id="cb18-16" title="16"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb18-17" title="17"></a>
<a class="sourceLine" id="cb18-18" title="18"><span class="kw">function</span> <span class="at">assignId</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-19" title="19">  <span class="va">req</span>.<span class="at">id</span> <span class="op">=</span> <span class="va">uuid</span>.<span class="at">v4</span>()</a>
<a class="sourceLine" id="cb18-20" title="20">  <span class="at">next</span>()</a>
<a class="sourceLine" id="cb18-21" title="21"><span class="op">}</span></a></code></pre>
    </div>
    <h2 id="license">License</h2>
    <p><a href="LICENSE">MIT</a></p>
  </body>
</html>
