<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/samples-listmanager.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:04:48 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>List manager sample application for AWS Lambda - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="samples-listmanager" />
      <meta name="default_state" content="samples-listmanager" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/samples-listmanager.html" />
      <meta name="description" content="Deploy a sample application that uses Kinesis, Amazon RDS, Amazon VPC, and DynamoDB." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>List manager sample application for AWS Lambda - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#samples-listmanager" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/samples-listmanager.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/samples-listmanager.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/samples-listmanager.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/samples-listmanager.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-dg.pdf#samples-listmanager" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/samples-listmanager.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#samples-listmanager-architecture">Architecture and event structure</a><a href="#samples-listmanager-instrumentation">Instrumentation with AWS X-Ray</a><a href="#samples-listmanager-template">AWS CloudFormation templates and additional resources</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="samples-listmanager">List manager sample application for AWS Lambda</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The list manager sample application demonstrates the use of AWS Lambda to process
                                    records in an Amazon Kinesis data
                                    stream. A Lambda event source mapping reads records from the stream in batches and
                                    invokes a Lambda function. The
                                    function uses information from the records to update documents in Amazon DynamoDB
                                    and stores the records it processes in
                                    Amazon Relational Database Service (Amazon RDS).
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="https://docs.aws.amazon.com/lambda/latest/dg/images/sample-listmanager.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 <p>Clients send records to a Kinesis stream, which stores them and makes them available
                                    for processing. The Kinesis
                                    stream is used like a queue to buffer records until they can be processed. Unlike
                                    an Amazon SQS queue, records in a Kinesis
                                    stream are not deleted after they are processed, so multiple consumers can process
                                    the same data. Records in Kinesis
                                    are also processed in order, where queue items can be delivered out of order. Records
                                    are deleted from the stream
                                    after 7 days.
                                 </p>
                                 <p>In addition to the function that processes events, the application includes a second
                                    function for performing
                                    administrative tasks on the database. Function code is available in the following
                                    files:
                                 </p>
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Processor – <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/sample-apps/list-manager/processor/index.js" rel="noopener noreferrer" target="_blank"><span>processor/index.js</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Database admin – <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/sample-apps/list-manager/dbadmin/index.js" rel="noopener noreferrer" target="_blank"><span>dbadmin/index.js</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>You can deploy the sample in a few minutes with the AWS CLI and AWS CloudFormation.
                                    To download, configure, and deploy it
                                    in your account, follow the instructions in the <a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/sample-apps/list-manager" rel="noopener noreferrer" target="_blank"><span>README</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Sections</strong></p>
                                    <ul>
                                       <li><a href="#samples-listmanager-architecture">Architecture and event structure</a></li>
                                       <li><a href="#samples-listmanager-instrumentation">Instrumentation with AWS X-Ray</a></li>
                                       <li><a href="#samples-listmanager-template">AWS CloudFormation templates and additional resources</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="samples-listmanager-architecture">Architecture and event structure</h2>
                                 
                                 
                                 <p>The sample application uses the following AWS services:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Kinesis – Receives events from clients and stores them temporarily for processing.</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>AWS Lambda – Reads from the Kinesis stream and sends events to the function's handler
                                             code.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>DynamoDB – Stores lists generated by the application.</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Amazon RDS – Stores a copy of processed records in a relational database.</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>AWS Secrets Manager – Stores the database password.</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Amazon VPC – Provides a private local network for communication between the function
                                             and
                                             database.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Pricing</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Standard charges apply for each service.</p>
                                    </div>
                                 </div>
                                 
                                 
                                 <p>The application processes JSON documents from clients that contain information necessary
                                    to update a list. It
                                    supports two types of list: tally and ranking. A <em>tally</em> contains values that are
                                    added to the current value for key if it exists. Each entry processed for a user increases
                                    the value of a key in
                                    the specified table.
                                 </p>
                                 
                                 <p>The following example shows a document that increases the <code class="code">xp</code> (experience points) value for a
                                    user's <code class="code">stats</code> list.
                                 </p>
                                 
                                 
                                 <div class="example">
                                    <p class="title"><b>Example record – Tally type</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "title": "stats",
  "user": "bill",
  "type": "tally",
  "entries": <span>{</span>
    "xp": 83
  }
}</code></pre></div>
                                 </div>
                                 
                                 
                                 <p>A <em>ranking</em> contains a list of entries where the value is the order in which they are
                                    ranked. A ranking can be updated with different values that overwrite the current
                                    value, instead of incrementing
                                    it. The following example shows a ranking of favorite movies:
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example record – Ranking type</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "title": "favorite movies",
  "user": "mike",
  "type": "rank",
  "entries": <span>{</span>
    "blade runner": 1,
    "the empire strikes back": 2,
    "alien": 3
  }
}</code></pre></div>
                                 </div>
                                 
                                 
                                 <p>A Lambda <a href="https://docs.aws.amazon.com/lambda/latest/dg/invocation-eventsourcemapping.html">event source mapping</a> read records from the stream
                                    in batches and invokes the processor function. The event that the function handler
                                    received contains an array of
                                    objects that each contain details about a record, such as when it was received, details
                                    about the stream, and an
                                    encoded representation of the original record document.
                                 </p>
                                 
                                 
                                 <div class="example">
                                    <p class="title"><b>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/sample-apps/list-manager/events/kinesis.json" rel="noopener noreferrer" target="_blank"><span>events/kinesis.json</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> –
                                          Record</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
  "Records": [
    <span>{</span>
      "kinesis": <span>{</span>
        "kinesisSchemaVersion": "1.0",
        "partitionKey": "0",
        "sequenceNumber": "49598630142999655949899443842509554952738656579378741250",
        <code class="userinput">"data": "eyJ0aXRsZSI6ICJmYXZvcml0ZSBtb3ZpZXMiLCAidXNlciI6ICJyZGx5c2N0IiwgInR5cGUiOiAicmFuayIsICJlbnRyaWVzIjogeyJibGFkZSBydW5uZXIiOiAyLCAidGhlIGVtcGlyZSBzdHJpa2VzIGJhY2siOiAzLCAiYWxpZW4iOiAxfX0=",</code>
        "approximateArrivalTimestamp": 1570667770.615
      },
      "eventSource": "aws:kinesis",
      "eventVersion": "1.0",
      "eventID": "shardId-000000000000:49598630142999655949899443842509554952738656579378741250",
      "eventName": "aws:kinesis:record",
      "invokeIdentityArn": "arn:aws:iam::123456789012:role/list-manager-processorRole-7FYXMPLH7IUS",
      "awsRegion": "us-east-2",
      "eventSourceARN": "arn:aws:kinesis:us-east-2:123456789012:stream/list-manager-stream-87B3XMPLF1AZ"
    },
    ...</code></pre></div>
                                 </div>
                                 
                                 
                                 <p>When it's decoded, the data contains a record. The function uses the record to update
                                    the user's list and an
                                    aggregate list that stores accumulated values across all users. It also stores a copy
                                    of the event in the
                                    application's database.
                                 </p>
                                  
                                 
                                 <h2 id="samples-listmanager-instrumentation">Instrumentation with AWS X-Ray</h2>
                                 
                                 
                                 <p>The application uses <a href="https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html">AWS X-Ray</a> to trace function invocations and the
                                    calls that functions make to AWS services. X-Ray uses the trace data that it receives
                                    from functions to create a
                                    service map that helps you identify errors. The following service map shows the function
                                    communicating with two
                                    DynamoDB tables and a MySQL database.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="https://docs.aws.amazon.com/lambda/latest/dg/images/listmanager-servicemap.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 
                                 
                                 <p>The Node.js function is configured for active tracing in the template, and is instrumented
                                    with the
                                    AWS X-Ray SDK for Node.js in code. The X-Ray SDK records a subsegment for each call
                                    made with an AWS SDK or MySQL
                                    client.
                                 </p>
                                 
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="https://docs.aws.amazon.com/lambda/latest/dg/images/listmanager-trace.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 
                                 
                                 <p>The function uses the AWS SDK for JavaScript in Node.js to read and write to two tables
                                    for each record. The primary table stores the
                                    current state of each combination of list name and user. The aggregate table stores
                                    lists that combine data from
                                    multiple users.
                                 </p>
                                  
                                 
                                 <h2 id="samples-listmanager-template">AWS CloudFormation templates and additional resources</h2>
                                 
                                 <p>The application is implemented in Node.js modules and deployed with an AWS CloudFormation
                                    template and shell scripts.
                                    The application template creates two functions, a Kinesis stream, DynamoDB tables
                                    and the following supporting
                                    resources.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Application resources</b></p>
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Execution role – An IAM role that grants the functions permission to access other
                                             AWS
                                             services.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Lambda event source mapping – Reads records from the data stream and invokes the function.</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>View the <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/sample-apps/list-manager/template.yml" rel="noopener noreferrer" target="_blank"><span>application template</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on GitHub.
                                 </p>
                                 
                                 
                                 <p>A second template, <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/sample-apps/list-manager/template.yml" rel="noopener noreferrer" target="_blank"><span>template-vpcrds.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, creates
                                    the Amazon VPC and database resources. While it is possible to create all of the resources
                                    in one template, separating
                                    them makes it easier to clean up the application and allows the database to be reused
                                    with multiple
                                    applications.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Infrastructure resources</b></p>
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>VPC – A virtual private cloud network with private subnets, a route table, and a VPC
                                             endpoint that
                                             allows the function to communicate with DynamoDB without an internet connection.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Database – An Amazon RDS database instance and a subnet group that connects it to
                                             the VPC.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="https://docs.aws.amazon.com/lambda/latest/dg/samples-errorprocessor.html">Error processor</div>
                                    <div id="next" class="next-link" accesskey="n" href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-nodejs.html">Working with Node.js</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/samples-listmanager.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/samples-listmanager.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/samples-listmanager.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:04:48 GMT -->
</html>