<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/with-s3-example-deployment-pkg.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:04:52 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Sample Amazon S3 function code - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="with-s3-example-deployment-pkg" />
      <meta name="default_state" content="with-s3-example-deployment-pkg" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example-deployment-pkg.html" />
      <meta name="description" content="The following sample code is available for the ." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Sample Amazon S3 function code - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#with-s3-example-deployment-pkg" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/with-s3-example-deployment-pkg.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/with-s3-example-deployment-pkg.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/with-s3-example-deployment-pkg.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/with-s3-example-deployment-pkg.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-dg.pdf#with-s3-example-deployment-pkg" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/with-s3-example-deployment-pkg.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="https://docs.aws.amazon.com/lambda/latest/dg/welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#with-s3-example-deployment-pkg-nodejs">Node.js 12.x</a><a href="#with-s3-example-deployment-pkg-java">Java 11</a><a href="#with-s3-example-deployment-pkg-python">Python 3</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="with-s3-example-deployment-pkg">Sample Amazon S3 function code</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The following sample code is available for the <a href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example.html">Tutorial: Using AWS Lambda with Amazon S3</a>.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Topics</strong></p>
                                    <ul>
                                       <li><a href="#with-s3-example-deployment-pkg-nodejs">Node.js 12.x</a></li>
                                       <li><a href="#with-s3-example-deployment-pkg-java">Java 11</a></li>
                                       <li><a href="#with-s3-example-deployment-pkg-python">Python 3</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="with-s3-example-deployment-pkg-nodejs">Node.js 12.x</h2>
                                 
                                 <p>The following example code receives an Amazon S3 event input and processes the message
                                    that it contains. It resizes an image in the source bucket and saves the output to
                                    the target bucket.
                                 </p>
                                  
                                 
                                 <h3 id="with-s3-example-deployment-pkg-nodejs-functioncode">Create the function code</h3>
                                 
                                 <p>Copy the sample code into a file named <code>index.js</code> into a new folder named <code>lambda-s3</code>.
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example index.js</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">// dependencies
  const AWS = require('aws-sdk');
  const util = require('util');
  const sharp = require('sharp');

  // get reference to S3 client
  const s3 = new AWS.S3();

  exports.handler = async (event, context, callback) =&gt; <span>{</span>

      // Read options from the event parameter.
      console.log("Reading options from event:\n", util.inspect(event, <span>{</span>depth: 5}));
      const srcBucket = event.Records[0].s3.bucket.name;
      // Object key may have spaces or unicode non-ASCII characters.
      const srcKey    = decodeURIComponent(event.Records[0].s3.object.key.replace(/\+/g, " "));
      const dstBucket = srcBucket + "-resized";
      const dstKey    = "resized-" + srcKey;

      // Infer the image type from the file suffix.
      const typeMatch = srcKey.match(/\.([^.]*)$/);
      if (!typeMatch) <span>{</span>
          console.log("Could not determine the image type.");
          return;
      }

      // Check that the image type is supported  
      const imageType = typeMatch[1].toLowerCase();
      if (imageType != "jpg" &amp;&amp; imageType != "png") <span>{</span>
          console.log(`Unsupported image type: $<span>{</span>imageType}`);
          return;
      }

      // Download the image from the S3 source bucket. 

      try <span>{</span>
          const params = <span>{</span>
              Bucket: srcBucket,
              Key: srcKey
          };
          var origimage = await s3.getObject(params).promise();

      } catch (error) <span>{</span>
          console.log(error);
          return;
      }  

      // set thumbnail width. Resize will set the height automatically to maintain aspect ratio.
      const width  = 200;

      // Use the Sharp module to resize the image and save in a buffer.
      try <span>{</span> 
          var buffer = await sharp(origimage.Body).resize(width).toBuffer();
              
      } catch (error) <span>{</span>
          console.log(error);
          return;
      } 

      // Upload the thumbnail image to the destination bucket
      try <span>{</span>
          const destparams = <span>{</span>
              Bucket: dstBucket,
              Key: dstKey,
              Body: buffer,
              ContentType: "image"
          };

          const putResult = await s3.putObject(destparams).promise(); 
          
      } catch (error) <span>{</span>
          console.log(error);
          return;
      } 
          
      console.log('Successfully resized ' + srcBucket + '/' + srcKey +
          ' and uploaded to ' + dstBucket + '/' + dstKey);
  };
  </code></pre></div>
                                 </div>
                                 
                                 <div class="procedure">
                                    <ul>
                                       <li>
                                          
                                          <p>Review the preceding code and note the following:</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p>The function knows the source bucket name and the key name of the object from the
                                                      event data it
                                                      receives as parameters. If the object is a .jpg, the code creates a thumbnail and
                                                      saves it to the target
                                                      bucket. 
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>The code assumes that the destination bucket exists and its name is a concatenation
                                                      of the source
                                                      bucket name followed by the string <code class="code">-resized</code>. For example, if the source bucket identified in
                                                      the event data is <code class="code">examplebucket</code>, the code assumes you have an
                                                      <code class="code">examplebucket-resized</code> destination bucket.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p>For the thumbnail it creates, the code derives its key name as the concatenation of
                                                      the string
                                                      <code class="code">resized-</code> followed by the source object key name. For example, if the source object key is
                                                      <code class="code">sample.jpg</code>, the code creates a thumbnail object that has the key
                                                      <code class="code">resized-sample.jpg</code>.
                                                   </p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                    </ul>
                                 </div>  
                                  
                                  
                                 
                                 <h3 id="with-s3-example-deployment-pkg-nodejs-dependencies">Create the deployment package</h3>
                                 
                                 <p>A deployment package is a .zip file containing your Lambda function code and dependencies.
                                    The sample function code has the following dependencies:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Dependencies</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Sharp for node.js</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To create a deployment package</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>Install the Sharp library with npm. For Linux, use the following command.</p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">lambda-s3$ <code class="userinput">npm install sharp</code></code></pre>
                                          <p>For macOS, use the following command.</p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">lambda-s3$ <code class="userinput">npm install --arch=x64 --platform=linux --target=12.13.0 sharp</code></code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>After you complete this step, you should have the following folder structure:</p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">lambda-s3
|- index.js
|- /node_modules/sharp
└ /node_modules/...</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>Create a deployment package with the function code and dependencies.</p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">lambda-s3$ <code class="userinput">zip -r function.zip .</code></code></pre>
                                          </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>To create and test the function</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>After you have created a deployment package with your function code and your Lambda
                                             function, return to the S3 tutorial to <a href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example.html">Create the Lambda function</a>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="with-s3-example-deployment-pkg-java">Java 11</h2>
                                 
                                 <p>The following is example Java code that reads incoming Amazon S3 events and creates
                                    a thumbnail. Note that it
                                    implements the <code class="code">RequestHandler</code> interface provided in the <code class="code">aws-lambda-java-core</code> library.
                                    Therefore, at the time you create a Lambda function you specify the class as the handler
                                    (that is,
                                    <code class="code">example.handler</code>). For more information about using interfaces to provide a handler, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/java-handler.html#java-handler-interfaces">Handler interfaces</a>.
                                 </p>
                                 
                                 <p>The <code class="code">S3Event</code> type that the handler uses as the input type is one of the predefined classes in
                                    the
                                    <code class="code">aws-lambda-java-events</code>  library that provides methods for you to easily read information from the
                                    incoming Amazon S3 event. The handler returns a string as output.
                                 </p>
                                  
                                 
                                 <h3 id="with-s3-example-deployment-pkg-java-functioncode">Create the function code</h3>
                                 
                                 <p>Copy the sample code into a file named <code>Handler.java</code>.
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example Handler.java</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">package example;

import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.image.BufferedImage;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import javax.imageio.ImageIO;

import com.amazonaws.AmazonServiceException;
import com.amazonaws.services.lambda.runtime.Context;
import com.amazonaws.services.lambda.runtime.RequestHandler;
import com.amazonaws.services.lambda.runtime.events.S3Event;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.event.S3EventNotification.S3EventNotificationRecord;
import com.amazonaws.services.s3.model.GetObjectRequest;
import com.amazonaws.services.s3.model.ObjectMetadata;
import com.amazonaws.services.s3.model.S3Object;
import com.amazonaws.services.s3.AmazonS3ClientBuilder;

public class Handler implements
        RequestHandler&lt;S3Event, String&gt; <span>{</span>
    private static final float MAX_WIDTH = 100;
    private static final float MAX_HEIGHT = 100;
    private final String JPG_TYPE = (String) "jpg";
    private final String JPG_MIME = (String) "image/jpeg";
    private final String PNG_TYPE = (String) "png";
    private final String PNG_MIME = (String) "image/png";

    public String handleRequest(S3Event s3event, Context context) <span>{</span>
        try <span>{</span>
            S3EventNotificationRecord record = s3event.getRecords().get(0);

            String srcBucket = record.getS3().getBucket().getName();

            // Object key may have spaces or unicode non-ASCII characters.
            String srcKey = record.getS3().getObject().getUrlDecodedKey();

            String dstBucket = srcBucket + "-resized";
            String dstKey = "resized-" + srcKey;

            // Sanity check: validate that source and destination are different
            // buckets.
            if (srcBucket.equals(dstBucket)) <span>{</span>
                System.out
                        .println("Destination bucket must not match source bucket.");
                return "";
            }

            // Infer the image type.
            Matcher matcher = Pattern.compile(".*\\.([^\\.]*)").matcher(srcKey);
            if (!matcher.matches()) <span>{</span>
                System.out.println("Unable to infer image type for key "
                        + srcKey);
                return "";
            }
            String imageType = matcher.group(1);
            if (!(JPG_TYPE.equals(imageType)) &amp;&amp; !(PNG_TYPE.equals(imageType))) <span>{</span>
                System.out.println("Skipping non-image " + srcKey);
                return "";
            }

            // Download the image from S3 into a stream
            AmazonS3 s3Client = AmazonS3ClientBuilder.defaultClient();
            S3Object s3Object = s3Client.getObject(new GetObjectRequest(
                    srcBucket, srcKey));
            InputStream objectData = s3Object.getObjectContent();

            // Read the source image
            BufferedImage srcImage = ImageIO.read(objectData);
            int srcHeight = srcImage.getHeight();
            int srcWidth = srcImage.getWidth();
            // Infer the scaling factor to avoid stretching the image
            // unnaturally
            float scalingFactor = Math.min(MAX_WIDTH / srcWidth, MAX_HEIGHT
                    / srcHeight);
            int width = (int) (scalingFactor * srcWidth);
            int height = (int) (scalingFactor * srcHeight);

            BufferedImage resizedImage = new BufferedImage(width, height,
                    BufferedImage.TYPE_INT_RGB);
            Graphics2D g = resizedImage.createGraphics();
            // Fill with white before applying semi-transparent (alpha) images
            g.setPaint(Color.white);
            g.fillRect(0, 0, width, height);
            // Simple bilinear resize
            g.setRenderingHint(RenderingHints.KEY_INTERPOLATION,
                    RenderingHints.VALUE_INTERPOLATION_BILINEAR);
            g.drawImage(srcImage, 0, 0, width, height, null);
            g.dispose();

            // Re-encode image to target format
            ByteArrayOutputStream os = new ByteArrayOutputStream();
            ImageIO.write(resizedImage, imageType, os);
            InputStream is = new ByteArrayInputStream(os.toByteArray());
            // Set Content-Length and Content-Type
            ObjectMetadata meta = new ObjectMetadata();
            meta.setContentLength(os.size());
            if (JPG_TYPE.equals(imageType)) <span>{</span>
                meta.setContentType(JPG_MIME);
            }
            if (PNG_TYPE.equals(imageType)) <span>{</span>
                meta.setContentType(PNG_MIME);
            }

            // Uploading to S3 destination bucket
            System.out.println("Writing to: " + dstBucket + "/" + dstKey);
            try <span>{</span>
                s3Client.putObject(dstBucket, dstKey, is, meta);
            }
            catch(AmazonServiceException e)
            <span>{</span>
                System.err.println(e.getErrorMessage());
                System.exit(1);
            }
            System.out.println("Successfully resized " + srcBucket + "/"
                    + srcKey + " and uploaded to " + dstBucket + "/" + dstKey);
            return "Ok";
        } catch (IOException e) <span>{</span>
            throw new RuntimeException(e);
        }
    }
}</code></pre></div>
                                 </div>
                                 
                                 <p>Amazon S3 invokes your Lambda function using the <code class="code">Event</code> invocation type, where AWS Lambda runs the
                                    code asynchronously. What you return does not matter. However, in this case we are
                                    implementing an interface that
                                    requires us to specify a return type, so in this example the handler uses <code class="code">String</code> as the return type. 
                                 </p>
                                  
                                  
                                 
                                 <h3 id="with-s3-example-deployment-pkg-java-dependencies">Create the deployment package</h3>
                                  
                                 
                                 <p>A deployment package is a .zip file containing your Lambda function code and dependencies.
                                    The sample function code has the following dependencies:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    <p class="title"><b>Dependencies</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><code class="code">aws-lambda-java-core</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">aws-lambda-java-events</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">aws-java-sdk</code></p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>To create a deployment package</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          
                                          <p>Build the code with the Lambda library dependencies to create a deployment package.
                                             For instructions, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/java-package.html">Deploy Java Lambda functions with .zip or JAR file archives</a>.
                                          </p>
                                          
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>To create and test the function</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>After you have created a deployment package with your function code and your Lambda
                                             function, return to the S3 tutorial to <a href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example.html">Create the Lambda function</a>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                  
                                 
                                 <h2 id="with-s3-example-deployment-pkg-python">Python 3</h2>
                                 
                                 <p>The following example code receives an Amazon S3 event input and processes the message
                                    that it contains. It resizes an image in the source bucket and saves the output to
                                    the target bucket. 
                                 </p>
                                  
                                 
                                 <h3 id="with-s3-example-deployment-pkg-python-functioncode">Create the function code</h3>
                                 
                                 <p>Copy the sample code into a file named <code>lambda_function.py</code>.
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example lambda_function.py</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">import boto3
import os
import sys
import uuid
from urllib.parse import unquote_plus
from PIL import Image
import PIL.Image

s3_client = boto3.client('s3')

def resize_image(image_path, resized_path):
    with Image.open(image_path) as image:
        image.thumbnail(tuple(x / 2 for x in image.size))
        image.save(resized_path)

def lambda_handler(event, context):
    for record in event['Records']:
        bucket = record['s3']['bucket']['name']
        key = unquote_plus(record['s3']['object']['key'])
        tmpkey = key.replace('/', '')
        download_path = '/tmp/<span>{</span>}<span>{</span>}'.format(uuid.uuid4(), tmpkey)
        upload_path = '/tmp/resized-<span>{</span>}'.format(tmpkey)
        s3_client.download_file(bucket, key, download_path)
        resize_image(download_path, upload_path)
        s3_client.upload_file(upload_path, '<span>{</span>}-resized'.format(bucket), key)</code></pre></div>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="with-s3-example-deployment-pkg-python-dependencies">Create the deployment package</h3>
                                 
                                 <p>A deployment package is a .zip file containing your Lambda function code and dependencies.
                                    The sample function code has the following dependencies:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Dependencies</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="https://pypi.org/project/Pillow/" rel="noopener noreferrer" target="_blank"><span>Pillow</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>To create a deployment package</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          
                                          <p>We recommend using the AWS SAM CLI <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-using-build.html">sam build</a> command with the <code class="code">--use-container</code> option to create deployment packages that contain libraries written in C or C++,
                                             such as the <a href="https://pypi.org/project/Pillow/" rel="noopener noreferrer" target="_blank"><span>Pillow (PIL)</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> library.
                                          </p>
                                          
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>To create and test the function</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>After you have created a deployment package with your function code and your Lambda
                                             function, return to the S3 tutorial to <a href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example.html">Create the Lambda function</a>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                  
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example.html">Tutorial</div>
                                    <div id="next" class="next-link" accesskey="n" href="https://docs.aws.amazon.com/lambda/latest/dg/with-s3-example-use-app-spec.html">Sample template</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/with-s3-example-deployment-pkg.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/with-s3-example-deployment-pkg.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/with-s3-example-deployment-pkg.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:04:52 GMT -->
</html>