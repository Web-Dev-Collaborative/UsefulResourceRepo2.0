<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:03:48 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Configuring a Lambda function to access resources in a VPC - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="configuration-vpc" />
      <meta name="default_state" content="configuration-vpc" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="configuration-vpc.html" />
      <meta name="description" content="Learn how to configure a Lambda function to access Amazon VPC resources." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Configuring a Lambda function to access resources in a VPC - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#configuration-vpc" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/configuration-vpc.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#configuration-vpc" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/configuration-vpc.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#vpc-permissions">Execution role and user permissions</a><a href="#vpc-configuring">Configuring VPC access with the Lambda console</a><a href="#vpc-configuring-api">Configuring VPC access with the Lambda API</a><a href="#vpc-conditions">Using IAM condition keys for VPC settings</a><a href="#vpc-internet">Internet and service access for VPC-connected functions</a><a href="#vpc-tutorials">VPC tutorials</a><a href="#vpc-samples">Sample VPC configurations</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="configuration-vpc">Configuring a Lambda function to access resources in a VPC</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You can configure a Lambda function to connect to private subnets in a virtual private
                                    cloud (VPC) in your AWS
                                    account. Use Amazon Virtual Private Cloud (Amazon VPC) to create a private network
                                    for resources such as databases, cache instances, or
                                    internal services. Connect your function to the VPC to access private resources while
                                    the function is running.
                                 </p>
                                 <p>When you connect a function to a VPC, Lambda creates an <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_ElasticNetworkInterfaces.html">elastic network interface</a> for each subnet in
                                    your function's VPC configuration. This process can take about a minute.
                                 </p>
                                 <p>While Lambda creates a network interface, you can't perform additional operations
                                    that target the function, such
                                    as <a href="configuration-versions.html">creating versions</a> or updating the function's code. For new
                                    functions, you can't invoke the function until its state changes from <code class="code">Pending</code> to <code class="code">Active</code>.
                                    For existing functions, you can still invoke an earlier version while the update is
                                    in progress. For more
                                    information about function states, see  <a href="functions-states.html">Monitoring the state of a function with the Lambda API</a>.
                                 </p>
                                 <p>Multiple functions connected to the same subnets share network interfaces. Connecting
                                    additional functions to a
                                    subnet that has an existing Lambda-managed network interface is much quicker than
                                    having Lambda create additional
                                    network interfaces. However, if you have many functions or functions with high network
                                    usage, Lambda might still
                                    create additional network interfaces.
                                 </p>
                                 <p>If your functions aren't active for a long period of time, Lambda reclaims its network
                                    interfaces, and the
                                    functions become <code class="code">Idle</code>. To reactivate an idle function, invoke it. This invocation fails, and the
                                    function enters a <code class="code">Pending</code> state again until a network interface is available.
                                 </p>
                                 <p>Lambda functions can't connect directly to a VPC with <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/dedicated-instance.html"> dedicated instance tenancy</a>. To connect to resources
                                    in a dedicated VPC, <a href="https://aws.amazon.com/premiumsupport/knowledge-center/lambda-dedicated-vpc/" rel="noopener noreferrer" target="_blank"><span>peer it to a
                                          second VPC with default tenancy</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Sections</strong></p>
                                    <ul>
                                       <li><a href="#vpc-permissions">Execution role and user permissions</a></li>
                                       <li><a href="#vpc-configuring">Configuring VPC access with the Lambda console</a></li>
                                       <li><a href="#vpc-configuring-api">Configuring VPC access with the Lambda API</a></li>
                                       <li><a href="#vpc-conditions">Using IAM condition keys for VPC settings</a></li>
                                       <li><a href="#vpc-internet">Internet and service access for VPC-connected functions</a></li>
                                       <li><a href="#vpc-tutorials">VPC tutorials</a></li>
                                       <li><a href="#vpc-samples">Sample VPC configurations</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="vpc-permissions">Execution role and user permissions</h2>
                                 
                                 
                                 <p>Lambda uses your function's permissions to create and manage network interfaces. To
                                    connect to a VPC, your
                                    function's <a href="lambda-intro-execution-role.html">execution role</a> must have the following
                                    permissions:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Execution role permissions</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>ec2:CreateNetworkInterface</b></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>ec2:DescribeNetworkInterfaces</b></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>ec2:DeleteNetworkInterface</b></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>These permissions are included in the AWS managed policy
                                    <b>AWSLambdaVPCAccessExecutionRole</b>.
                                 </p>
                                 
                                 <p>When you configure VPC connectivity, Lambda uses your permissions to verify network
                                    resources. To configure a
                                    function to connect to a VPC, your AWS Identity and Access Management (IAM) user needs
                                    the following permissions:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>User permissions</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>ec2:DescribeSecurityGroups</b></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>ec2:DescribeSubnets</b></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>ec2:DescribeVpcs</b></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="vpc-configuring">Configuring VPC access with the Lambda console</h2>
                                 
                                 <p>If your <a href="#vpc-conditions">IAM permissions</a> allow you only to create Lambda functions that
                                    connect to your VPC, you must configure the VPC when you create the function. If your
                                    IAM permissions allow you
                                    to create functions that aren't connected to your VPC, you can add the VPC configuration
                                    after you create the
                                    function.
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To configure a VPC when you create a function</b></p>
                                    <ol>
                                       <li>
                                          <p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the Lambda console.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Create function</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Basic information</b>, for <b>Function name</b>, enter a name for
                                             your function.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Expand <b>Advanced settings</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Network</b>, choose a <b>VPC</b> for your function to access.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose subnets and security groups. When you choose a security group, the console
                                             displays the inbound and
                                             outbound rules for that security group.
                                          </p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>To access private resources, connect your function to private subnets. If your function
                                                   needs internet
                                                   access, use <a href="#vpc-internet">network address translation (NAT)</a>. Connecting a function to
                                                   a public subnet doesn't give it internet access or a public IP address.
                                                </p>
                                             </div>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Create function</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To configure a VPC for an existing function</b></p>
                                    <ol>
                                       <li>
                                          <p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the Lambda console.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>Choose a function.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>VPC</b>, choose <b>Edit</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose a VPC, subnets, and security groups.</p>
                                          
                                          <div class="awsdocs-note">
                                             <div class="awsdocs-note-title">
                                                <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                             <div class="awsdocs-note-text">
                                                <p>To access private resources, connect your function to private subnets. If your function
                                                   needs internet
                                                   access, use <a href="#vpc-internet">network address translation (NAT)</a>. Connecting a function to
                                                   a public subnet doesn't give it internet access or a public IP address.
                                                </p>
                                             </div>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Save</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="vpc-configuring-api">Configuring VPC access with the Lambda API</h2>
                                 
                                 <p>To connect a Lambda function to a VPC, you can use the following API operations:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="API_CreateFunction.html">CreateFunction</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>To create a function and connect it to a VPC using the AWS Command Line Interface
                                    (AWS CLI), you can use the
                                    <code class="code">create-function</code> command with the <code class="code">vpc-config</code> option. The following example creates a
                                    function with a connection to a VPC with two subnets and one security group.
                                 </p>
                                 
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda create-function --function-name my-function \
--runtime nodejs12.x --handler index.js --zip-file fileb://function.zip \
--role arn:aws:iam::<code class="replaceable">123456789012</code>:role/<code class="replaceable">lambda-role</code> \
--vpc-config SubnetIds=<code class="replaceable">subnet-071f712345678e7c8,subnet-07fd123456788a036</code>,SecurityGroupIds=<code class="replaceable">sg-085912345678492fb</code></code></code></pre>
                                 
                                 <p>To connect an existing function to a VPC, use the <code class="code">update-function-configuration</code> command with the
                                    <code class="code">vpc-config</code> option.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--vpc-config SubnetIds=<code class="replaceable">subnet-071f712345678e7c8,subnet-07fd123456788a036</code>,SecurityGroupIds=<code class="replaceable">sg-085912345678492fb</code></code></code></pre>
                                 
                                 <p>To disconnect your function from a VPC, update the function configuration with an
                                    empty list of subnets and
                                    security groups.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--vpc-config SubnetIds=[],SecurityGroupIds=[]</code></code></pre>
                                  
                                 <h2 id="vpc-conditions">Using IAM condition keys for VPC settings</h2>
                                 
                                 <p>You can use Lambda-specific condition keys for VPC settings to provide additional
                                    permission controls for your
                                    Lambda functions. For example, you can require that all functions in your organization
                                    are connected to a VPC. You
                                    can also specify the subnets and security groups that the function's users can and
                                    can't use.
                                 </p>
                                 
                                 <p>Lambda supports the following condition keys in IAM policies:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>lambda:VpcIds</b> – Allow or deny one or more VPCs.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>lambda:SubnetIds</b> – Allow or deny one or more subnets.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>lambda:SecurityGroupIds</b> – Allow or deny one or more security
                                             groups.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>The Lambda API operations <a href="API_CreateFunction.html">CreateFunction</a> and <a href="API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a> support these condition keys. For
                                    more information about using condition keys in IAM policies, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_condition.html">IAM JSON Policy Elements:
                                       Condition</a> in the <em>IAM User Guide</em>.
                                 </p>
                                 
                                 <div class="awsdocs-note awsdocs-tip">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Tip</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>If your function already includes a VPC configuration from a previous API request,
                                          you can send an
                                          <code class="code">UpdateFunctionConfiguration</code> request without the VPC configuration.
                                       </p>
                                    </div>
                                 </div>
                                  
                                 
                                 <h3 id="vpc-condition-examples">Example policies with condition keys for VPC settings</h3>
                                 
                                 <p>The following examples demonstrate how to use condition keys for VPC settings. After
                                    you create a policy
                                    statement with the desired restrictions, append the policy statement for the target
                                    IAM user or role.
                                 </p>
                                  
                                 
                                 <h4 id="vpc-condition-example-1">Ensure that users deploy only VPC-connected functions</h4>
                                 
                                 <p>To ensure that all users deploy only VPC-connected functions, you can deny function
                                    create and update
                                    operations that don't include a valid VPC ID. 
                                 </p>
                                 
                                 <p>Note that VPC ID is not an input parameter to the <code class="code">CreateFunction</code> or
                                    <code class="code">UpdateFunctionConfiguration</code> request. Lambda retrieves the VPC ID value based on the subnet and
                                    security group parameters.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "EnforceVPCFunction",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "Null": <span>{</span>
           "lambda:VpcIds": "true"
        }
      }
    }
  ]
}
        </code></pre>
                                  
                                  
                                 <h4 id="vpc-condition-example-2">Deny users access to specific VPCs, subnets, or security
                                    groups
                                 </h4>
                                 
                                 <p>To deny users access to specific VPCs, use <code class="code">StringEquals</code> to check the value of the
                                    <code class="code">lambda:VpcIds</code> condition. The following example denies users access to <code class="code">vpc-1</code> and
                                    <code class="code">vpc-2</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "EnforceOutOfVPC",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
            "lambda:VpcIds": ["vpc-1", "vpc-2"]
        }
      }
    } 
        </code></pre>
                                 <p>To deny users access to specific subnets, use <code class="code">StringEquals</code> to check the value of the
                                    <code class="code">lambda:SubnetIds</code> condition. The following example denies users access to <code class="code">subnet-1</code>
                                    and <code class="code">subnet-2</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceOutOfSubnet",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAnyValue:StringEquals": <span>{</span>
            "lambda:SubnetIds": ["subnet-1", "subnet-2"]
        }
      }
    }
       </code></pre>
                                 <p>To deny users access to specific security groups, use <code class="code">StringEquals</code> to check the value of the
                                    <code class="code">lambda:SecurityGroupIds</code> condition. The following example denies users access to
                                    <code class="code">sg-1</code> and <code class="code">sg-2</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceOutOfSecurityGroups",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Deny",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAnyValue:StringEquals": <span>{</span>
            "lambda:SecurityGroupIds": ["sg-1", "sg-2"]
        }
      }
    }
  ]
}
        </code></pre>
                                  
                                  
                                 <h4 id="vpc-condition-example-3">Allow users to create and update functions with specific VPC
                                    settings
                                 </h4>
                                 
                                 <p>To allow users to access specific VPCs, use <code class="code">StringEquals</code> to check the value of the
                                    <code class="code">lambda:VpcIds</code> condition. The following example allows users to access <code class="code">vpc-1</code> and
                                    <code class="code">vpc-2</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
  "Version": "2012-10-17",
  "Statement": [
    <span>{</span>
      "Sid": "EnforceStayInSpecificVpc",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Allow",
      "Resource": "*",
      "Condition": <span>{</span>
        "StringEquals": <span>{</span>
            "lambda:VpcIds": ["vpc-1", "vpc-2"]
        }
      }
    }
        </code></pre>
                                 <p>To allow users to access specific subnets, use <code class="code">StringEquals</code> to check the value of the
                                    <code class="code">lambda:SubnetIds</code> condition. The following example allows users to access <code class="code">subnet-1</code>
                                    and <code class="code">subnet-2</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceStayInSpecificSubnets",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Allow",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAllValues:StringEquals": <span>{</span>
            "lambda:SubnetIds": ["subnet-1", "subnet-2"]
        }
      }
    }
      </code></pre>
                                 <p>To allow users to access specific security groups, use <code class="code">StringEquals</code> to check the value of the
                                    <code class="code">lambda:SecurityGroupIds</code> condition. The following example allows users to access
                                    <code class="code">sg-1</code> and <code class="code">sg-2</code>.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
      "Sid": "EnforceStayInSpecificSecurityGroup",
      "Action": [
          "lambda:CreateFunction",
          "lambda:UpdateFunctionConfiguration"
       ],
      "Effect": "Allow",
      "Resource": "*",
      "Condition": <span>{</span>
        "ForAllValues:StringEquals": <span>{</span>
            "lambda:SecurityGroupIds": ["sg-1", "sg-2"]
        }
      }
    }
  ]
} 
        </code></pre>
                                  
                                  
                                  
                                 <h2 id="vpc-internet">Internet and service access for VPC-connected functions</h2>
                                 
                                 <p>By default, Lambda runs your functions in a secure VPC with access to AWS services
                                    and the internet. Lambda
                                    owns this VPC, which isn't connected to your account's <a href="https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html">default VPC</a>. When you connect a function to a VPC in your
                                    account, the function can't access the internet unless your VPC provides access.
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Several AWS services offer <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html">VPC
                                             endpoints</a>. You can use VPC endpoints to connect to AWS services from within a VPC without internet
                                          access.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p>Internet access from a private subnet requires network address translation (NAT).
                                    To give your function access
                                    to the internet, route outbound traffic to a <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html">NAT gateway</a> in a public subnet. The NAT gateway has a
                                    public IP address and can connect to the internet through the VPC's internet gateway.
                                    For more information, see
                                    <a href="https://aws.amazon.com/premiumsupport/knowledge-center/internet-access-lambda-function/" rel="noopener noreferrer" target="_blank"><span>How do I give
                                          internet access to my Lambda function in a VPC?</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a></p>
                                  
                                 
                                 <h2 id="vpc-tutorials">VPC tutorials</h2>
                                 
                                 <p>In the following tutorials, you connect a Lambda function to resources in your VPC.</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="services-rds-tutorial.html">Tutorial: Configuring a Lambda function to access Amazon RDS in an Amazon VPC</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="services-elasticache-tutorial.html">Tutorial: Configuring a Lambda function to access Amazon ElastiCache in an
                                                Amazon VPC</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="vpc-samples">Sample VPC configurations</h2>
                                 
                                 
                                 <p>You can use the following sample AWS CloudFormation templates to create VPC configurations
                                    to use with Lambda functions.
                                    There are two templates available in this guide's GitHub repository:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/main/templates/vpc-private.yaml" rel="noopener noreferrer" target="_blank"><span>vpc-private.yaml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – A VPC with
                                             two private subnets and VPC endpoints for Amazon Simple Storage Service (Amazon S3)
                                             and Amazon DynamoDB. Use this template to create a VPC for
                                             functions that don't need internet access. This configuration supports use of Amazon
                                             S3 and DynamoDB with the AWS
                                             SDKs, and access to database resources in the same VPC over a local network connection.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/main/templates/vpc-privatepublic.yaml" rel="noopener noreferrer" target="_blank"><span>vpc-privatepublic.yaml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>
                                             – A VPC with two private subnets, VPC endpoints, a public subnet with a NAT gateway,
                                             and an internet
                                             gateway. Internet-bound traffic from functions in the private subnets is routed to
                                             the NAT gateway using a
                                             route table.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>To create a VPC using a template, on the AWS CloudFormation console <a href="https://console.aws.amazon.com/cloudformation/home#/stacks" rel="noopener noreferrer" target="_blank"><span>Stacks page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, choose <b>Create
                                       stack</b>, and then follow the instructions in the <b>Create stack</b> wizard.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="configuration-memory.html">Memory</div>
                                    <div id="next" class="next-link" accesskey="n" href="configuration-vpc-endpoints.html">Interface VPC endpoints</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/configuration-vpc.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/configuration-vpc.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:03:48 GMT -->
</html>