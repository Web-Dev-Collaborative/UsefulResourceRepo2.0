<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/invocation-eventsourcemapping.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:01:57 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>AWS Lambda event source mappings - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="invocation-eventsourcemapping" />
      <meta name="default_state" content="invocation-eventsourcemapping" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="invocation-eventsourcemapping.html" />
      <meta name="description" content="An event source mapping is an AWS Lambda resource that reads from an event source and invokes a Lambda function. You can use event source mappings to process items from a stream or queue in services that don't invoke Lambda functions directly. Lambda provides event source mappings for the following services." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>AWS Lambda event source mappings - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#invocation-eventsourcemapping" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/invocation-eventsourcemapping.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-eventsourcemapping.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-eventsourcemapping.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-eventsourcemapping.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#invocation-eventsourcemapping" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/invocation-eventsourcemapping.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="invocation-eventsourcemapping">AWS Lambda event source mappings</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>An event source mapping is an AWS Lambda resource that reads from an event source
                                    and invokes a Lambda function.
                                    You can use event source mappings to process items from a stream or queue in services
                                    that don't invoke Lambda
                                    functions directly. Lambda provides event source mappings for the following services.
                                 </p>
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Services that Lambda reads events from</b></p>
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="with-ddb.html">Amazon DynamoDB</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="with-kinesis.html">Amazon Kinesis</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="with-mq.html">Amazon MQ</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="with-msk.html">Amazon Managed Streaming for Apache Kafka</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="kafka-smaa.html">Self-managed Apache Kafka</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="with-sqs.html">Amazon Simple Queue Service</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>An event source mapping uses permissions in the function's <a href="lambda-intro-execution-role.html">execution
                                       role</a> to read and manage items in the event source. Permissions, event structure, settings,
                                    and polling
                                    behavior vary by event source. For more information, see the linked topic for the
                                    service that you use as an event
                                    source.
                                 </p>
                                 <p>To manage an event source with the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a> or <a href="http://aws.amazon.com/getting-started/tools-sdks/" rel="noopener noreferrer" target="_blank"><span>AWS SDK</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>, you can use the following API operations:
                                 </p>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="API_CreateEventSourceMapping.html">CreateEventSourceMapping</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_ListEventSourceMappings.html">ListEventSourceMappings</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_GetEventSourceMapping.html">GetEventSourceMapping</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_UpdateEventSourceMapping.html">UpdateEventSourceMapping</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_DeleteEventSourceMapping.html">DeleteEventSourceMapping</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>The following example uses the AWS CLI to map a function named <code class="code">my-function</code> to a DynamoDB stream
                                    that is specified by its Amazon Resource Name (ARN), with a batch size of 500.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda create-event-source-mapping --function-name my-function --batch-size 500 --starting-position LATEST \
--event-source-arn arn:aws:dynamodb:<code class="replaceable">us-east-2:123456789012:table/my-table/stream/2019-06-10T19:26:16.525</code></code></code></pre><p>You should see the following output:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "UUID": "14e0db71-5d35-4eb5-b481-8945cf9d10c2",
    "BatchSize": 500,
    "MaximumBatchingWindowInSeconds": 0,
    "ParallelizationFactor": 1,
    "EventSourceArn": "arn:aws:dynamodb:us-east-2:123456789012:table/my-table/stream/2019-06-10T19:26:16.525",
    "FunctionArn": "arn:aws:lambda:us-east-2:123456789012:function:my-function",
    "LastModified": 1560209851.963,
    "LastProcessingResult": "No records processed",
    "State": "Creating",
    "StateTransitionReason": "User action",
    "DestinationConfig": <span>{</span>},
    "MaximumRecordAgeInSeconds": 604800,
    "BisectBatchOnFunctionError": false,
    "MaximumRetryAttempts": 10000
}</code></pre><p>Event source mappings read items from a stream or queue in batches. They include multiple
                                    items in the event
                                    that your function receives. You can configure the size of the batch that the event
                                    source mapping sends to your
                                    function, up to a maximum that varies by service. The number of items in the event
                                    can be smaller than the batch
                                    size if there aren't enough items available, or if the batch is too large to send
                                    in one event and has to be split
                                    up.
                                 </p>
                                 <p>The following example shows an event source mapping that reads from a Kinesis stream.
                                    If a batch of events fails
                                    all processing attempts, the event source mapping sends details about the batch to
                                    an SQS queue.
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/features-eventsourcemapping.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      An event source mapping reads from a Kinesis stream. It queues records locally before sending them to the&#xA;        function.&#xA;    " />
                                     
                                     
                                    
                                 </div>
                                 <p>The event batch is the event that Lambda sends to the function. It is a batch of records
                                    or messages compiled
                                    from the items that the event source mapping reads from a stream or queue. Batch size
                                    and other settings only apply
                                    to the event batch.
                                 </p>
                                 <p>For streams, an event source mapping creates an iterator for each shard in the stream
                                    and processes items in
                                    each shard in order. You can configure the event source mapping to read only new items
                                    that appear in the stream, or
                                    to start with older items. Processed items aren't removed from the stream and can
                                    be processed by other functions or
                                    consumers.
                                 </p>
                                 <p>By default, if your function returns an error, the entire batch is reprocessed until
                                    the function succeeds, or
                                    the items in the batch expire. To ensure in-order processing, processing for the affected
                                    shard is paused until the
                                    error is resolved. You can configure the event source mapping to discard old events,
                                    restrict the number of retries,
                                    or process multiple batches in parallel. If you process multiple batches in parallel,
                                    in-order processing is still
                                    guaranteed for each partition key, but multiple partition keys in the same shard are
                                    processed
                                    simultaneously.
                                 </p>
                                 <p>You can also configure the event source mapping to send an invocation record to another
                                    service when it discards
                                    an event batch. Lambda supports the following <a href="invocation-async.html#invocation-async-destinations">destinations</a> for
                                    event source mappings.
                                 </p>
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SQS</b> – An SQS queue.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SNS</b> – An SNS topic.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>The invocation record contains details about the failed event batch in JSON format.</p>
                                 <p>The following example shows an invocation record for a Kinesis stream.</p>
                                 <div class="example">
                                    <p class="title"><b>Example invocation Record</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
    "requestContext": <span>{</span>
        "requestId": "c9b8fa9f-5a7f-xmpl-af9c-0c604cde93a5",
        "functionArn": "arn:aws:lambda:us-east-2:123456789012:function:myfunction",
        "condition": "RetryAttemptsExhausted",
        "approximateInvokeCount": 1
    },
    "responseContext": <span>{</span>
        "statusCode": 200,
        "executedVersion": "$LATEST",
        "functionError": "Unhandled"
    },
    "version": "1.0",
    "timestamp": "2019-11-14T00:38:06.021Z",
    "KinesisBatchInfo": <span>{</span>
        "shardId": "shardId-000000000001",
        "startSequenceNumber": "49601189658422359378836298521827638475320189012309704722",
        "endSequenceNumber": "49601189658422359378836298522902373528957594348623495186",
        "approximateArrivalOfFirstRecord": "2019-11-14T00:38:04.835Z",
        "approximateArrivalOfLastRecord": "2019-11-14T00:38:05.580Z",
        "batchSize": 500,
        "streamArn": "arn:aws:kinesis:us-east-2:123456789012:stream/mystream"
    }
}</code></pre></div>
                                 </div>
                                 <p>Lambda also supports in-order processing for <a href="with-sqs.html">FIFO (first-in, first-out) queues</a>,
                                    scaling up to the number of active message groups. For standard queues, items aren't
                                    necessarily processed in order.
                                    Lambda scales up to process a standard queue as quickly as possible. When an error
                                    occurs, batches are returned to
                                    the queue as individual items and might be processed in a different grouping than
                                    the original batch. Occasionally,
                                    the event source mapping might receive the same item from the queue twice, even if
                                    no function error occurred. Lambda
                                    deletes items from the queue after they're processed successfully. You can configure
                                    the source queue to send items
                                    to a dead-letter queue if they can't be processed.
                                 </p>
                                 <p>For information about services that invoke Lambda functions directly, see <a href="lambda-services.html">Using AWS Lambda with other services</a>.
                                 </p>
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="invocation-async.html">Asynchronous invocation</div>
                                    <div id="next" class="next-link" accesskey="n" href="functions-states.html">Function states</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-eventsourcemapping.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-eventsourcemapping.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/invocation-eventsourcemapping.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:02:01 GMT -->
</html>