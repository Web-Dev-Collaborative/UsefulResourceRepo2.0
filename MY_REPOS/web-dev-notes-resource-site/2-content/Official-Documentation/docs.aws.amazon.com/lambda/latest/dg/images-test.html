<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/images-test.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:03:01 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Testing Lambda container images locally - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="images-test" />
      <meta name="default_state" content="images-test" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="images-test.html" />
      <meta name="description" content="Test the container image for your AWS Lambda function locally using the runtime interface emulator." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Testing Lambda container images locally - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#images-test" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/images-test.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/images-test.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/images-test.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/images-test.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#images-test" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/images-test.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#images-test-limitations">Guidelines for using the RIE</a><a href="#images-test-env">Environment variables</a><a href="#images-test-AWSbase">Test an image with RIE included in the image</a><a href="#images-test-alternative">Build RIE into your base image</a><a href="#images-test-add">Test an image without adding RIE to the image</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="images-test">Testing Lambda container images locally</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>The AWS Lambda Runtime Interface Emulator (RIE) is a proxy for the Lambda Runtime
                                    API that allows you to locally
                                    test your Lambda function packaged as a container image. The emulator is a lightweight
                                    web server that converts HTTP
                                    requests into JSON events to pass to the Lambda function in the container image. 
                                 </p>
                                 <p>The AWS base images for Lambda include the RIE component. If you use an alternate
                                    base image, you can test your
                                    image without adding RIE to the image. You can also build the RIE component into your
                                    base image. AWS provides an
                                    open-sourced RIE component on the AWS GitHub repository. 
                                 </p>
                                 <p>You can use the emulator to test whether your function code is compatible with the
                                    Lambda environment. Also use
                                    the emulator to test that your Lambda function runs to completion successfully and
                                    provides the expected output. If
                                    you build extensions and agents into your container image, you can use the emulator
                                    to test that the extensions and
                                    agents work correctly with the Lambda Extensions API.
                                 </p>
                                 <p>For examples of how to use the RIE, see
                                    <a href="http://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/" rel="noopener noreferrer" target="_blank"><span>Container image support for Lambda</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the AWS Blog.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Topics</strong></p>
                                    <ul>
                                       <li><a href="#images-test-limitations">Guidelines for using the RIE</a></li>
                                       <li><a href="#images-test-env">Environment variables</a></li>
                                       <li><a href="#images-test-AWSbase">Test an image with RIE included in the image</a></li>
                                       <li><a href="#images-test-alternative">Build RIE into your base image</a></li>
                                       <li><a href="#images-test-add">Test an image without adding RIE to the image</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="images-test-limitations">Guidelines for using the RIE</h2>
                                 
                                 <p>Note the following guidelines when using the Runtime Interface Emulator:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>The RIE does not emulate Lambda’s security and authentication configurations, or Lambda
                                             orchestration.
                                             
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          <p>The emulator supports only Linux x86-64 architectures.</p>
                                       </li>
                                       <li class="listitem">
                                          <p>The emulator does not support AWS X-Ray tracing or other Lambda integrations.</p>
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h2 id="images-test-env">Environment variables</h2>
                                 
                                 <p>The runtime interface emulator supports a subset of <a href="configuration-envvars.html">environment
                                       variables</a> for the Lambda function in the local running image.
                                 </p>
                                 
                                 <p>If your function uses security credentials, you can configure the credentials by setting
                                    the following
                                    environment variables:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><code class="code">AWS_ACCESS_KEY_ID</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_SECRET_ACCESS_KEY</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_SESSION_TOKEN</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_REGION</code></p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>To set the function timeout, configure <code class="code">AWS_LAMBDA_FUNCTION_TIMEOUT</code>. Enter the maximum number of
                                    seconds that you want to allow the function to run.
                                 </p>
                                 
                                 <p>The emulator does not populate the following Lambda environment variables. However,
                                    you can set them to match
                                    the values that you expect when the function runs in the Lambda service:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><code class="code">AWS_LAMBDA_FUNCTION_VERSION</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_LAMBDA_FUNCTION_NAME</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_LAMBDA_FUNCTION_MEMORY_SIZE</code></p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                  
                                 
                                 <h2 id="images-test-AWSbase">Test an image with RIE included in the image</h2>
                                 
                                 <p>The AWS base images for Lambda include the runtime interface emulator. You can also
                                    follow these steps if you
                                    built the RIE into your alternative base image. 
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To test your Lambda function with the emulator</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>Build your image locally using the <code class="code">docker build</code> command.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">docker build -t <code class="replaceable">myfunction</code>:latest .</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>Run your container image locally using the <code class="code">docker run</code> command.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">docker run -p 9000:8080  <code class="replaceable">myfunction</code>:latest </code></pre>
                                          <p>This command runs the image as a container and starts up an endpoint locally at
                                             <code class="code">localhost:9000/2015-03-31/functions/function/invocations</code>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>From a new terminal window, post an event to the following endpoint using a <code class="code">curl</code>
                                             command:
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">curl -XPOST "http://localhost:9000/2015-03-31/functions/function/invocations" -d '<span>{</span>}'</code></pre>
                                          <p>This command invokes the Lambda function running in the container image and returns
                                             a response.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="images-test-alternative">Build RIE into your base image</h2>
                                 
                                 <p>You can build RIE into a base image.  Download the RIE from GitHub to your local machine
                                    and update your
                                    Dockerfile to install RIE.   
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To build the emulator into your image</b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>Create a script and save it in your project directory. The following example shows
                                             a typical script for a
                                             Node.js function. The presence of the <code class="code">AWS_LAMBDA_RUNTIME_API</code> environment variable indicates the
                                             presence of the runtime API. If the runtime API is present, the script runs the <a href="runtimes-images.html#runtimes-api-client">runtime interface client</a>. Otherwise, the script runs the runtime
                                             interface emulator.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">#!/bin/sh
if [ -z "$<span>{</span>AWS_LAMBDA_RUNTIME_API}" ]; then
  exec /usr/local/bin/aws-lambda-rie /usr/bin/npx aws-lambda-ric
else
  exec /usr/bin/npx aws-lambda-ric
fi     </code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>Download the <a href="https://github.com/aws/aws-lambda-runtime-interface-emulator/releases/latest/download/aws-lambda-rie" rel="noopener noreferrer" target="_blank"><span>runtime interface emulator</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> from GitHub into your project directory.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Install the emulator package and change <code class="code">ENTRYPOINT</code> to run the new script by adding the
                                             following lines to your Dockerfile:
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">ADD aws-lambda-rie /usr/local/bin/aws-lambda-rie
ENTRYPOINT [ “/entry_script.sh” ]</code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>Build your image locally using the <code class="code">docker build</code> command.
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">docker build -t <code class="replaceable">myfunction</code>:latest .</code></pre>
                                          </li>
                                    </ol>
                                 </div>
                                  
                                 
                                 <h2 id="images-test-add">Test an image without adding RIE to the image</h2>
                                 
                                 <p>You install the runtime interface emulator to your local machine. When you run the
                                    container image, you set
                                    the entry point to be the emulator. 
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To test an image without adding RIE to the image  </b></p>
                                    <ol>
                                       <li>
                                          
                                          <p>From your project directory, run the following command to download the RIE from GitHub
                                             and install it on your local machine.
                                          </p>     
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">mkdir -p ~/.aws-lambda-rie &amp;&amp; curl -Lo ~/.aws-lambda-rie/aws-lambda-rie \
 https://github.com/aws/aws-lambda-runtime-interface-emulator/releases/latest/download/aws-lambda-rie \
   &amp;&amp; chmod +x ~/.aws-lambda-rie/aws-lambda-rie               </code></pre>
                                          </li>
                                       <li>
                                          
                                          <p>Run your Lambda function using the <code class="code">docker run</code> command. 
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">docker run -d -v ~/.aws-lambda-rie:/aws-lambda -p 9000:8080 \ 
  --entrypoint /aws-lambda/aws-lambda-rie myfunction:latest &lt;image entrypoint&gt; \
          &lt;(optional) image command&gt;
        </code></pre>
                                          <p>This runs the image as a container and starts up an endpoint locally at
                                             <code class="code">localhost:9000/2015-03-31/functions/function/invocations</code>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Post an event to the following endpoint using a <code class="code">curl</code> command:
                                          </p>
                                          <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">curl -XPOST "http://localhost:9000/2015-03-31/functions/function/invocations" -d '<span>{</span>}'</code></pre>
                                          <p>This command invokes the function running in the container image and returns a response.</p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="images-create.html">Creating images</div>
                                    <div id="next" class="next-link" accesskey="n" href="lambda-services.html">Working with other services</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/images-test.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/images-test.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/images-test.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:03:01 GMT -->
</html>