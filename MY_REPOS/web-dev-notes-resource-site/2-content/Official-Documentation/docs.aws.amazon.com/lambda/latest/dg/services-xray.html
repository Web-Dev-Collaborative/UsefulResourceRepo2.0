<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/services-xray.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:02:54 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Using AWS Lambda with AWS X-Ray - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="services-xray" />
      <meta name="default_state" content="services-xray" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="services-xray.html" />
      <meta name="description" content="You can use AWS X-Ray to visualize the components of your application, identify performance bottlenecks, and troubleshoot requests that resulted in an error. Your Lambda functions send trace data to X-Ray, and X-Ray processes the data to generate a service map and searchable trace summaries." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Using AWS Lambda with AWS X-Ray - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#services-xray" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/services-xray.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-xray.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-xray.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/services-xray.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#services-xray" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/services-xray.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#services-xray-permissions">Execution role permissions</a><a href="#services-xray-daemon">The AWS X-Ray daemon</a><a href="#services-xray-api">Enabling active tracing with the Lambda API</a><a href="#services-xray-cloudformation">Enabling active tracing with AWS CloudFormation</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="services-xray">Using AWS Lambda with AWS X-Ray</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You can use AWS X-Ray to visualize the components of your application, identify performance
                                    bottlenecks, and
                                    troubleshoot requests that resulted in an error. Your Lambda functions send trace
                                    data to X-Ray, and X-Ray
                                    processes the data to generate a service map and searchable trace summaries.
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/sample-errorprocessor-servicemap.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      Service map showing nodes for Lambda functions, X-Ray, Amazon S3 and CloudWatch Logs&#xA;    " />
                                     
                                     
                                    
                                 </div>
                                 <p>If you've enabled X-Ray tracing in a service that invokes your function, Lambda sends
                                    traces to X-Ray
                                    automatically. The upstream service, such as Amazon API Gateway, or an application
                                    hosted on Amazon EC2 that is instrumented with
                                    the X-Ray SDK, samples incoming requests and adds a tracing header that tells Lambda
                                    to send traces or not.
                                 </p>
                                 <p>To trace requests that don't have a tracing header, enable active tracing in your
                                    function's
                                    configuration.
                                 </p>
                                 <div class="procedure">
                                    <p class="title"><b>To enable active tracing</b></p>
                                    <ol>
                                       <li>
                                          <p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the Lambda console.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>Choose a function.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Monitoring tools</b>, choose <b>Edit</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Active tracing</b> on the <b>AWS X-Ray</b> pane.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Save</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Pricing</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>X-Ray has a perpetual free tier. Beyond the free tier threshold, X-Ray charges for
                                          trace storage and
                                          retrieval. For details, see <a href="https://aws.amazon.com/xray/pricing/" rel="noopener noreferrer" target="_blank"><span>AWS X-Ray pricing</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                       </p>
                                    </div>
                                 </div>
                                 <p>Your function needs permission to upload trace data to X-Ray. When you enable active
                                    tracing in the Lambda
                                    console, Lambda adds the required permissions to your function's <a href="lambda-intro-execution-role.html">execution role</a>. Otherwise, add the <a href="https://console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess" rel="noopener noreferrer" target="_blank"><span>AWSXRayDaemonWriteAccess</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> policy to the execution role.
                                 </p>
                                 <p>X-Ray applies a sampling algorithm to ensure that tracing is efficient, while still
                                    providing a representative
                                    sample of the requests that your application serves. The default sampling rule is
                                    1 request per second and 5 percent
                                    of additional requests. This sampling rate cannot be configured for Lambda functions.
                                 </p>
                                 <p>In X-Ray, a <em>trace</em> records information about a request that is processed by one or more
                                    <em>services</em>. Services record <em>segments</em> that contain layers of
                                    <em>subsegments</em>. Lambda records a segment for the Lambda service that handles the invocation
                                    request, and one for the work done by the function. The function segment comes with
                                    subsegments for
                                    <code class="code">Initialization</code>, <code class="code">Invocation</code> and <code class="code">Overhead</code>.
                                 </p>
                                 <p>The following example shows a trace with 2 segments. Both are named <b>my-function</b>, but one is
                                    type <code class="code">AWS::Lambda</code> and the other is <code class="code">AWS::Lambda::Function</code>. The function segment is expanded
                                    to show its subsegments.
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/nodejs-xray-timeline.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 <div class="awsdocs-note awsdocs-important">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-warning" variant="error"></awsui-icon><span>Important</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>In Lambda, you can use the X-Ray SDK to extend the <code class="code">Invocation</code> subsegment with additional
                                          subsegments for downstream calls, annotations, and metadata. You can't access the
                                          function segment directly or
                                          record work done outside of the handler invocation scope.
                                       </p>
                                    </div>
                                 </div>
                                 <p>See the following topics for a language-specific introduction to tracing in Lambda:</p>
                                 <div class="itemizedlist">
                                    
                                     
                                    
                                     
                                    
                                     
                                    
                                     
                                    
                                     
                                    
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="nodejs-tracing.html">Instrumenting Node.js code in AWS Lambda</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="python-tracing.html">Instrumenting Python code in AWS Lambda</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="ruby-tracing.html">Instrumenting Ruby code in AWS Lambda</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="java-tracing.html">Instrumenting Java code in AWS Lambda</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="golang-tracing.html">Instrumenting Go code in AWS Lambda</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="csharp-tracing.html">Instrumenting C# code in AWS Lambda</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>For a full list of services that support active instrumentation, see <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-usage.html#xray-usage-codechanges">Supported AWS services</a> in the
                                    AWS X-Ray Developer Guide.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Sections</strong></p>
                                    <ul>
                                       <li><a href="#services-xray-permissions">Execution role permissions</a></li>
                                       <li><a href="#services-xray-daemon">The AWS X-Ray daemon</a></li>
                                       <li><a href="#services-xray-api">Enabling active tracing with the Lambda API</a></li>
                                       <li><a href="#services-xray-cloudformation">Enabling active tracing with AWS CloudFormation</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="services-xray-permissions">Execution role permissions</h2>
                                 
                                 <p>Lambda needs the following permissions to send trace data to X-Ray. Add them to your
                                    function's <a href="lambda-intro-execution-role.html">execution role</a>.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="https://docs.aws.amazon.com/xray/latest/api/API_PutTraceSegments.html">xray:PutTraceSegments</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="https://docs.aws.amazon.com/xray/latest/api/API_PutTelemetryRecords.html">xray:PutTelemetryRecords</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>These permissions are included in the <a href="https://console.aws.amazon.com/iam/home?#/policies/arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess" rel="noopener noreferrer" target="_blank"><span>AWSXRayDaemonWriteAccess</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> managed policy.
                                 </p>
                                  
                                 
                                 <h2 id="services-xray-daemon">The AWS X-Ray daemon</h2>
                                 
                                 
                                 <p>Instead of sending trace data directly to the X-Ray API, the X-Ray SDK uses a daemon
                                    process. The AWS X-Ray
                                    daemon is an application that runs in the Lambda environment and listens for UDP traffic
                                    that contains segments and
                                    subsegments. It buffers incoming data and writes it to X-Ray in batches, reducing
                                    the processing and memory
                                    overhead required to trace invocations.
                                 </p>
                                 
                                 
                                 <p>The Lambda runtime allows the daemon to up to 3 percent of your function's configured
                                    memory or 16 MB,
                                    whichever is greater. If your function runs out of memory during invocation, the runtime
                                    terminates the daemon
                                    process first to free up memory.
                                 </p>
                                 
                                 
                                 <p>The daemon process is fully managed by Lambda and cannot be configured by the user.
                                    All segments generated by function invocations are recorded in the same account as
                                    the Lambda function. The
                                    daemon cannot be configured to redirect them to any other account.
                                 </p>
                                 
                                 
                                 <p>For more information, see <a href="https://docs.aws.amazon.com/xray/latest/devguide/xray-daemon.html">The X-Ray daemon</a> in the X-Ray
                                    Developer Guide.
                                 </p>
                                  
                                 
                                 <h2 id="services-xray-api">Enabling active tracing with the Lambda API</h2>
                                 
                                 
                                 <p>To manage tracing configuration with the AWS CLI or AWS SDK, use the following API
                                    operations:
                                 </p>
                                  
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><a href="API_UpdateFunctionConfiguration.html">UpdateFunctionConfiguration</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="API_GetFunctionConfiguration.html">GetFunctionConfiguration</a></p>
                                       </li>
                                       <li class="listitem">
                                          <p><a href="API_CreateFunction.html">CreateFunction</a></p>
                                       </li>
                                    </ul>
                                 </div>
                                  
                                 <p>The following example AWS CLI command enables active tracing on a function named my-function.</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-configuration --function-name my-function \
--tracing-config Mode=Active</code></code></pre>
                                 <p>Tracing mode is part of the version-specific configuration that is locked when you
                                    publish a version of your
                                    function. You can't change the tracing mode on a published version.
                                 </p>
                                 
                                  
                                 
                                 <h2 id="services-xray-cloudformation">Enabling active tracing with AWS CloudFormation</h2>
                                  
                                 <p>To enable active tracing on an <code class="code">AWS::Lambda::Function</code> resource in an AWS CloudFormation template, use the
                                    <code class="code">TracingConfig</code> property.
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/templates/function-inline.yml" rel="noopener noreferrer" target="_blank"><span>function-inline.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> –
                                          Tracing configuration</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html">AWS::Lambda::Function</a>
    Properties:
      <code class="userinput">TracingConfig:
        Mode: Active</code>
      ...</code></pre></div>
                                 </div>
                                 
                                 <p>For an AWS Serverless Application Model (AWS SAM) <code class="code">AWS::Serverless::Function</code> resource, use the <code class="code">Tracing</code>
                                    property.
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example <a href="https://github.com/awsdocs/aws-lambda-developer-guide/blob/master/sample-apps/blank-nodejs/template.yml" rel="noopener noreferrer" target="_blank"><span>template.yml</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> – Tracing
                                          configuration</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">Resources:
  function:
    Type: <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html">AWS::Serverless::Function</a>
    Properties:
      <code class="userinput">Tracing: Active</code>
      ...</code></pre></div>
                                 </div>
                                 
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="with-sqs-example-use-app-spec.html">Sample template</div>
                                    <div id="next" class="next-link" accesskey="n" href="lambda-stepfunctions.html">Orchestrating functions</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/services-xray.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/services-xray.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/services-xray.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:03:00 GMT -->
</html>