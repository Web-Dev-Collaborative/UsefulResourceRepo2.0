<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:00:22 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Lambda Extensions API - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="runtimes-extensions-api" />
      <meta name="default_state" content="runtimes-extensions-api" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="runtimes-extensions-api.html" />
      <meta name="description" content="You use the Extensions API to create Lambda extensions. Extensions provide a method for monitoring, security, and other tools to integrate with the Lambda execution environment . For more information, see Introducing AWS Lambda Extensions on the AWS Compute Blog." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Lambda Extensions API - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#runtimes-extensions-api" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/runtimes-extensions-api.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#runtimes-extensions-api" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/runtimes-extensions-api.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#runtimes-extensions-api-lifecycle">Lambda execution environment lifecycle</a><a href="#extensions-images">Adding extensions to container images</a><a href="#runtimes-extensions-registration-api">Extensions API reference</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="runtimes-extensions-api">Lambda Extensions API</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>You use the Extensions API to create Lambda extensions. Extensions provide a method
                                    for monitoring, security, and
                                    other tools to integrate with the Lambda <a href="runtimes-context.html">execution environment</a>. For more
                                    information, see <a href="http://aws.amazon.com/blogs/compute/introducing-aws-lambda-extensions-in-preview/" rel="noopener noreferrer" target="_blank"><span>Introducing
                                          AWS Lambda Extensions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the AWS Compute Blog.
                                 </p>
                                 <p>The Extensions API builds on the existing <a href="runtimes-api.html">Runtime API</a>, which provides an
                                    HTTP API for custom runtimes to receive invocation events from Lambda. As an extension
                                    author, you can use the
                                    Extensions API to register for function and execution environment lifecycle events.
                                    In response to these events, you
                                    can start new processes or run logic.
                                 </p>
                                 <p>Lambda supports internal and external extensions. <em>Internal extensions</em> allow you to configure
                                    the runtime environment and modify the startup of the runtime process. Internal extensions
                                    use language-specific
                                    <a href="runtimes-modify.html">environment variables and wrapper scripts</a>, and start and shut down within
                                    the runtime process. Internal extensions run as separate threads within the runtime
                                    process, which starts and stops
                                    them.
                                 </p>
                                 <p>An <em>external extension</em> runs as an independent process in the execution environment and
                                    continues to run after the function invoke is fully processed. An external extension
                                    must register for the
                                    <code class="code">Shutdown</code> event, which triggers the extension to shut down. Because external extensions run
                                    as
                                    processes, you can write them in a different language than the function.
                                 </p>
                                 <p>The following <a href="lambda-runtimes.html">Lambda runtimes</a> support external extensions:
                                 </p>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>.NET Core 3.1 (C#/PowerShell) (<code class="code">dotnetcore3.1</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Custom runtime (<code class="code">provided</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Custom runtime on Amazon Linux 2 (<code class="code">provided.al2</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Java 11 (Corretto) (<code class="code">java11</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Java 8 (Corretto) (<code class="code">java8.al2</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Node.js 14.x (<code class="code">nodejs14.x</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Node.js 12.x (<code class="code">nodejs12.x</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Node.js 10.x (<code class="code">nodejs10.x</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Python 3.8 (<code class="code">python3.8</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Python 3.7 (<code class="code">python3.7</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Ruby 2.7 (<code class="code">ruby2.7</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Ruby 2.5 (<code class="code">ruby2.5</code>)
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>We recommend that you implement external extensions using a compiled language. In
                                    this case, the extension is a
                                    self-contained binary that is compatible with all of the supported runtimes. If you
                                    use a non-compiled language,
                                    ensure that you include a compatible runtime in the extension.
                                 </p>
                                 <p>You share your extension as a <a href="configuration-layers.html">Lambda layer</a> to make it available
                                    within your organization or to the entire community of Lambda developers. Function
                                    developers can find, manage, and
                                    install extensions through layers.
                                 </p>
                                 <p>You can install and manage extensions using the Lambda console, the AWS Command Line
                                    Interface (AWS CLI), or infrastructure as code
                                    (IaC) services and tools such as AWS CloudFormation, AWS Serverless Application Model
                                    (AWS SAM), and Terraform.
                                 </p>
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>For example extensions and wrapper scripts, see <a href="https://github.com/aws-samples/aws-lambda-extensions" rel="noopener noreferrer" target="_blank"><span>AWS Lambda Extensions</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the AWS Samples
                                          GitHub repository.
                                       </p>
                                    </div>
                                 </div>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Topics</strong></p>
                                    <ul>
                                       <li><a href="#runtimes-extensions-api-lifecycle">Lambda execution environment lifecycle</a></li>
                                       <li><a href="#extensions-images">Adding extensions to container images</a></li>
                                       <li><a href="#runtimes-extensions-registration-api">Extensions API reference</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="runtimes-extensions-api-lifecycle">Lambda execution environment lifecycle</h2>
                                 
                                 
                                 <p>The lifecycle of the execution environment includes the following phases:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><code class="code"><b>Init</b></code>: In this phase, Lambda creates or
                                             unfreezes an execution environment with the configured resources, downloads the code
                                             for the function and
                                             all layers, initializes any extensions, initializes the runtime, and then runs the
                                             function’s initialization
                                             code (the code outside the main handler). The <code class="code">Init</code> phase happens either during the first
                                             invocation, or in advance of function invocations if you have enabled <a href="configuration-concurrency.html#configuration-concurrency-provisioned">provisioned concurrency</a>.
                                          </p>
                                          
                                          <p>The <code class="code">Init</code> phase is split into three sub-phases: <code class="code">Extension init</code>, <code class="code">Runtime
                                                init</code>, and <code class="code">Function init</code>. These sub-phases ensure that all extensions and the runtime
                                             complete their setup tasks before the function code runs.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><code class="code"><b>Invoke</b></code>: In this phase, Lambda invokes the function handler.
                                             After the function runs to completion, Lambda prepares to handle another function
                                             invocation.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><code class="code"><b>Shutdown</b></code>: This phase is triggered if the Lambda function does not
                                             receive any invocations for a period of time. In the <code class="code">Shutdown</code> phase, Lambda terminates
                                             the runtime, alerts the extensions to let them stop cleanly, and then removes the
                                             environment. Lambda
                                             sends a <code class="code">Shutdown</code> event to each extension, which tells the extension that the environment is about
                                             to be shut down.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 
                                 <p>Each phase starts with an event from the Lambda service to the runtime and to all
                                    registered extensions. The
                                    runtime and each extension signal completion by sending a <code class="code">Next</code> API request. Lambda freezes the
                                    execution environment when each process has completed and there are no pending events.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Overview-Full-Sequence.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 
                                 <p> </p>
                                 
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Topics</strong></p>
                                    <ul>
                                       <li><a href="#runtimes-extensions-api-reg">Init phase</a></li>
                                       <li><a href="#runtimes-lifecycle-invoke">Invoke phase</a></li>
                                       <li><a href="#runtimes-lifecycle-shutdown">Shutdown phase</a></li>
                                       <li><a href="#runtimes-extensions-registration-api-e">Permissions and configuration</a></li>
                                       <li><a href="#runtimes-extensions-api-failure">Failure handling</a></li>
                                       <li><a href="#runtimes-extensions-api-trbl">Troubleshooting extensions</a></li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h3 id="runtimes-extensions-api-reg">Init phase</h3>
                                 
                                 <p>During the <code class="code">Extension init</code> phase, each extension needs to register with Lambda to receive events.
                                    Lambda uses the full file name of the extension to validate that the extension has
                                    completed the bootstrap
                                    sequence. Therefore, each <code class="code">Register</code> API call must include the <code class="code">Lambda-Extension-Name</code>
                                    header with the full file name of the extension.
                                 </p>
                                 
                                 <p>You can register up to 10 extensions for a function. This limit is enforced through
                                    the
                                    <code class="code">Register</code> API call.
                                 </p>
                                 
                                 <p>After each extension registers, Lambda starts the <code class="code">Runtime init</code> phase. The runtime process calls
                                    <code class="code">functionInit</code> to start the <code class="code">Function init</code> phase.
                                 </p>
                                 
                                 <p>The <code class="code">Init</code> phase completes after the runtime and each registered extension indicate completion
                                    by
                                    sending a <code class="code">Next</code> API request.
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Extensions can complete their initialization at any point in the <code class="code">Init</code> phase.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Init-Phase.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                  
                                  
                                 
                                 <h3 id="runtimes-lifecycle-invoke">Invoke phase</h3>
                                 
                                 <p>When a Lambda function is invoked in response to a <code class="code">Next</code> API request, Lambda sends an
                                    <code class="code">Invoke</code> event to the runtime and to each extension that is registered for the <code class="code">Invoke</code>
                                    event.
                                 </p>
                                 
                                 <p>During the invocation, external extensions run in parallel with the function. They
                                    also continue running
                                    after the function has completed. This enables you to capture diagnostic information
                                    or send logs, metrics, and
                                    traces to a location of your choice.
                                 </p>
                                 
                                 <p>The <code class="code">Invoke</code> phase ends after the runtime and all extensions signal that they are done by sending
                                    a <code class="code">Next</code> API request. 
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Invoke-Phase.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 
                                 <p><b>Event payload</b>: The event sent to the runtime (and the Lambda function)
                                    carries the entire request, headers (such as <code class="code">RequestId</code>), and payload. The event sent to each
                                    extension contains metadata that describes the event content. This lifecycle event
                                    includes the type of the
                                    event, the time that the function times out (<code class="code">deadlineMs</code>), the <code class="code">requestId</code>, the invoked
                                    function's Amazon Resource Name (ARN), and tracing headers.
                                 </p>
                                 
                                 <p>Extensions that want to access the function event body can use an in-runtime SDK that
                                    communicates with the
                                    extension. Function developers use the in-runtime SDK to send the payload to the extension
                                    when the function is
                                    invoked.
                                 </p>
                                 
                                 <p>Here is an example payload:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "eventType": "INVOKE",
    "deadlineMs": 676051,
    "requestId": "3da1f2dc-3222-475e-9205-e2e6c6318895",
    "invokedFunctionArn": "arn:aws:lambda:us-east-1:123456789012:function:ExtensionTest",
    "tracing": <span>{</span>
        "type": "X-Amzn-Trace-Id",
        "value": "Root=1-5f35ae12-0c0fec141ab77a00bc047aa2;Parent=2be948a625588e32;Sampled=1"
    }
 }       
      </code></pre>
                                 <p><b>Duration limit</b>: The function's <a href="configuration-console.html">timeout setting</a> limits the duration of the entire <code class="code">Invoke</code> phase. For example, if you set
                                    the function timeout as 360 seconds, the function and all extensions need to complete
                                    within 360 seconds. Note
                                    that there is no independent post-invoke phase. The duration is the sum of all invocation
                                    time (runtime +
                                    extensions) and is not calculated until the function and all extensions have finished
                                    executing.
                                 </p>
                                 
                                 <p><b>Performance impact and extension overhead</b>: Extensions can impact function
                                    performance. As an extension author, you have control over the performance impact
                                    of your extension. For
                                    example, if your extension performs compute-intensive operations, the function's duration
                                    increases because the
                                    extension and the function code share the same CPU resources. In addition, if your
                                    extension performs extensive
                                    operations after the function invocation completes, the function duration increases
                                    because the
                                    <code class="code">Invoke</code> phase continues until all extensions signal that they are completed.
                                 </p>
                                 
                                 <p>To help identify the performance impact introduced by extensions on the <code class="code">Invoke</code> phase, Lambda
                                    outputs the <code class="code">PostRuntimeExecutionDuration</code> metric. This metric measures the cumulative time spent
                                    between the runtime <code class="code">Next</code> API request and the last extension <code class="code">Next</code> API request. To
                                    measure the increase in memory used, use the <code class="code">MaxMemoryUsed</code> metric. For more information about
                                    function metrics, see <a href="monitoring-metrics.html">Working with AWS Lambda function metrics</a>.
                                 </p>
                                 
                                 <p>Function developers can run different versions of their functions side by side to
                                    understand the impact of a
                                    specific extension. We recommend that extension authors publish expected resource
                                    consumption to make it easier
                                    for function developers to choose a suitable extension.
                                 </p>
                                  
                                  
                                 
                                 <h3 id="runtimes-lifecycle-shutdown">Shutdown phase</h3>
                                 
                                 <p>When Lambda is about to terminate the runtime, it sends a <code class="code">Shutdown</code> event to the runtime and then
                                    to each registered external extension. Extensions can use this time for final cleanup
                                    tasks. The
                                    <code class="code">Shutdown</code> event is sent in response to a <code class="code">Next</code> API request.
                                 </p>
                                 
                                 <p><b>Duration limit</b>: The maximum duration of the <code class="code">Shutdown</code> phase
                                    depends on the configuration of registered extensions:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p>300 ms – A function with no registered extensions</p>
                                       </li>
                                       <li class="listitem">
                                          <p>500 ms – A function with a registered internal extension</p>
                                       </li>
                                       <li class="listitem">
                                          <p>2,000 ms – A function with one or more registered external extensions</p>
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>For a function with external extensions, Lambda reserves up to 300 ms (500 ms for
                                    a runtime with an internal
                                    extension) for the runtime process to perform a graceful shutdown. Lambda allocates
                                    the remainder of the 2,000 ms
                                    limit for external extensions to shut down.
                                 </p>
                                 
                                 <p>If the runtime or an extension does not respond to the <code class="code">Shutdown</code> event within the limit, Lambda
                                    terminates the process using a <code class="code">SIGKILL</code> signal.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Shutdown-Phase.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 
                                 <p><b>Event payload</b>: The <code class="code">Shutdown</code> event contains the reason for the
                                    shutdown and the time remaining in milliseconds.
                                 </p>
                                 
                                 <p> The <code class="code">shutdownReason</code> includes the following values:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>SPINDOWN – Normal shutdown</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>TIMEOUT – Duration limit timed out</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>FAILURE – Error condition, such as an <code class="code">out-of-memory</code> event
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
<span>{</span> 
  "eventType": "SHUTDOWN", 
  "shutdownReason": "reason for shutdown", 
  "deadlineMs": "the time and date that the function times out in Unix time milliseconds" 
}        
      </code></pre>
                                  
                                  
                                 <h3 id="runtimes-extensions-registration-api-e">Permissions and configuration</h3>
                                 
                                 <p>Extensions run in the same execution environment as the Lambda function. Extensions
                                    also share resources with
                                    the function, such as CPU, memory, and <code class="code">/tmp</code> disk storage. In addition, extensions use the same
                                    AWS Identity and Access Management (IAM) role and security context as the function.
                                 </p>
                                 
                                 <p><b>File system and network access permissions</b>: Extensions run in the same file
                                    system and network name namespace as the function runtime. This means that extensions
                                    need to be compatible with
                                    the associated operating system. If an extension requires any additional network egress
                                    rules, you must apply
                                    these rules to the function configuration.
                                 </p>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Because the function code directory is read-only, extensions cannot modify the function
                                          code.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p><b>Environment variables</b>: Extensions can access the function's <a href="configuration-envvars.html">environment variables</a>, except for the following variables
                                    that are specific to the runtime process:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                          
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          <p><code class="code">AWS_EXECUTION_ENV</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_LAMBDA_LOG_GROUP_NAME</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_LAMBDA_LOG_STREAM_NAME</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_XRAY_CONTEXT_MISSING</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">AWS_XRAY_DAEMON_ADDRESS</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">LAMBDA_RUNTIME_DIR</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">LAMBDA_TASK_ROOT</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">_AWS_XRAY_DAEMON_ADDRESS</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">_AWS_XRAY_DAEMON_PORT</code></p>
                                       </li>
                                       <li class="listitem">
                                          <p><code class="code">_HANDLER</code></p>
                                       </li>
                                    </ul>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="runtimes-extensions-api-failure">Failure handling</h3>
                                 
                                 <p><b>Initialization failures</b>: If an extension fails, Lambda restarts the
                                    execution environment to enforce consistent behavior and to encourage fail fast for
                                    extensions. Also, for some
                                    customers, the extensions must meet mission-critical needs such as logging, security,
                                    governance, and telemetry
                                    collection.
                                 </p>
                                 
                                 <p><b>Invoke failures</b> (such as out of memory, function timeout): Because
                                    extensions share resources with the runtime, memory exhaustion affects them. When
                                    the runtime fails, all
                                    extensions and the runtime itself participate in the <code class="code">Shutdown</code> phase. In addition, the runtime is
                                    restarted—either automatically as part of the current invocation, or via a deferred
                                    re-initialization
                                    mechanism.
                                 </p>
                                 
                                 <p>If there is a failure (such as a function timeout or runtime error) during <code class="code">Invoke</code>, the Lambda
                                    service performs a reset. The reset behaves like a <code class="code">Shutdown</code> event. First, Lambda shuts down the
                                    runtime, then it sends a <code class="code">Shutdown</code> event to each registered external extension. The event includes
                                    the reason for the shutdown. If this environment is used for a new invocation, the
                                    extension and runtime are
                                    re-initialized as part of the next invocation.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Overview-Invoke-with-Error.png" class="aws-docs-img-whiteBg aws-docs-img-padding" />
                                     
                                    
                                 </div>
                                 
                                 <div class="awsdocs-note">
                                    <div class="awsdocs-note-title">
                                       <awsui-icon name="status-info" variant="link"></awsui-icon><span>Note</span></div>
                                    <div class="awsdocs-note-text">
                                       <p>Lambda does not automatically shut down extensions that repeatedly fail. However,
                                          Lambda reports these
                                          errors through Amazon CloudWatch metrics and logs so that function developers and
                                          extension authors can understand and
                                          diagnose such failures.
                                       </p>
                                    </div>
                                 </div>
                                 
                                 <p><b>Extension logs</b>: Lambda sends the log output of extensions to CloudWatch Logs. Lambda
                                    also generates an additional log event for each extension during <code class="code">Init</code>. The log event records the
                                    name and registration preference (event, config) on success, or the failure reason
                                    on failure.
                                 </p>
                                  
                                  
                                 
                                 <h3 id="runtimes-extensions-api-trbl">Troubleshooting extensions</h3>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>If a <code class="code">Register</code> request fails, make sure that the <code class="code">Lambda-Extension-Name</code> header
                                             in the <code class="code">Register</code> API call contains the full file name of the extension.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>If the <code class="code">Register</code> request fails for an internal extension, make sure that the request does
                                             not register for the <code class="code">Shutdown</code> event.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                  
                                 
                                 <h2 id="extensions-images">Adding extensions to container images</h2>
                                 
                                 <p>You can add extensions to your <a href="lambda-images.html">container image</a>. The ENTRYPOINT <a href="images-create.html#images-parms">container image setting</a> specifies the main process for the container. Configure
                                    the ENTRYPOINT and CMD settings in the Dockerfile, or as an override in the function
                                    configuration.  
                                 </p>
                                 
                                 <p>You can run multiple processes within a container. Lambda provides a built-in server
                                    that manages the lifecycle
                                    of the main process and any additional processes. The server uses the Extensions API
                                    to communicate with each
                                    external extension.
                                 </p>
                                 
                                  
                                 
                                 <h2 id="runtimes-extensions-registration-api">Extensions API reference</h2>
                                 
                                 <p>The OpenAPI specification for the extensions API version <b>2020-01-01</b> is
                                    available here: <a href="samples/extensions-api.zip" rel="noopener noreferrer" target="_blank">extensions-api.zip</a></p>
                                 
                                 <p>You can retrieve the value of the API endpoint from the <code class="code">AWS_LAMBDA_RUNTIME_API</code> environment
                                    variable. To send a <code class="code">Register</code> request, use the prefix <code class="code">2020-01-01/</code> before each API path.
                                    For example:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
http://$<span>{</span>AWS_LAMBDA_RUNTIME_API}/2020-01-01/extension/register
    </code></pre>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>API methods</strong></p>
                                    <ul>
                                       <li><a href="#extensions-registration-api-a">Register</a></li>
                                       <li><a href="#extensions-api-next">Next</a></li>
                                       <li><a href="#runtimes-extensions-init-error">Init error</a></li>
                                       <li><a href="#runtimes-extensions-exit-error">Exit error</a></li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h3 id="extensions-registration-api-a">Register</h3>
                                 
                                 <p>During <code class="code">Extension init</code>, all extensions need to register with Lambda to receive events. Lambda uses
                                    the full file name of the extension to validate that the extension has completed the
                                    bootstrap sequence.
                                    Therefore, each <code class="code">Register</code> API call must include the <code class="code">Lambda-Extension-Name</code> header with
                                    the full file name of the extension.
                                 </p>
                                 
                                 <p>Internal extensions are started and stopped by the runtime process, so they are not
                                    permitted to register
                                    for the <code class="code">Shutdown</code> event.
                                 </p>
                                 
                                 <p><b>Path</b> – <code class="code">/extension/register</code></p>
                                 
                                 <p><b>Method</b> – <b>POST</b></p>
                                 
                                 <p><b>Headers</b></p>
                                 
                                 <p><code class="code">Lambda-Extension-Name</code> – The full file name of the extension. Required: yes. Type:
                                    string.
                                 </p>
                                 
                                 <p><b>Body parameters </b></p>
                                 
                                 <p><code class="code">events</code> – Array of the events to register for. Required: no. Type: array of strings.
                                    Valid strings: <code class="code">INVOKE</code>, <code class="code">SHUTDOWN</code>.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response headers</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><code class="code">Lambda-Extension-Identifier</code> – Generated unique agent identifier (UUID string) that is
                                             required for all subsequent requests.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response codes</b></p>
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>200 – Response body contains the function name, function version, and handler name.</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>400 – Bad Request</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>403 – Forbidden</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>500 – Container error. Non-recoverable state. Extension should exit promptly.</p>       
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example request body</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
<span>{</span>
    'events': [ 'INVOKE', 'SHUTDOWN']
}      
        </code></pre></div>
                                 </div>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example response body</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="">
<span>{</span>
    "functionName": "helloWorld",
    "functionVersion": "$LATEST",
    "handler": "lambda_function.lambda_handler"
}       
        </code></pre></div>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="extensions-api-next">Next</h3>
                                 
                                 <p>Extensions send a <code class="code">Next</code> API request to receive the next event, which can be an
                                    <code class="code">Invoke</code> event or a <code class="code">Shutdown</code> event. The response body contains the payload, which is a
                                    JSON document that contains event data.
                                 </p>
                                 
                                 <p>The extension sends a <code class="code">Next</code> API request to signal that it is ready to receive new events. This
                                    is a blocking call.
                                 </p>
                                 
                                 <p>Do not set a timeout on the GET call, as the extension can be suspended for a period
                                    of time until there is
                                    an event to return.
                                 </p>
                                 
                                 <p><b>Path</b> – <code class="code">/extension/event/next</code></p>
                                 
                                 <p><b>Method</b> – <b>GET</b></p>
                                 
                                 <p><b>Parameters</b></p>
                                 
                                 <p><code class="code">Lambda-Extension-Identifier</code> – Unique identifier for extension (UUID string). Required:
                                    yes. Type: UUID string.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response header</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><code class="code">Lambda-Extension-Identifier</code> – Unique agent identifier (UUID string).
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response codes</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>200 – Response contains information about the next event (<code class="code">EventInvoke</code> or
                                             <code class="code">EventShutdown</code>).
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>403 – Forbidden</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>500 – Container error. Non-recoverable state. Extension should exit promptly.</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="runtimes-extensions-init-error">Init error</h3>
                                 
                                 <p>The extension uses this method to report an initialization error to Lambda. Call it
                                    when the extension fails
                                    to initialize after it has registered. After Lambda receives the error, no further
                                    API calls succeed. The
                                    extension should exit.
                                 </p>
                                 
                                 <p><b>Path</b> – <code class="code">/extension/init/error</code></p>
                                 
                                 <p><b>Method</b> – <b>POST</b></p>
                                 
                                 <p><b>Headers</b></p>
                                 
                                 <p><code class="code">Lambda-Extension-Identifier</code> – Unique identifier for extension. Required: yes. Type: UUID
                                    string.
                                 </p>
                                 
                                 <p><code class="code">Lambda-Extension-Function-Error-Type</code> – Error enum. Required: yes. Type: String error
                                    enum (for example, Fatal.ConnectFailed).
                                 </p>
                                 
                                 <p><b>Body parameters</b></p>
                                 
                                 <p><code class="code">ErrorRequest</code> – JSON object with the error type, error message, and stack trace.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response body</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><code class="code">Lambda-Extension-Identifier</code> – Unique agent identifier (UUID string).
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response codes</b></p>
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>202 – Accepted</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>400 – Bad Request</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>403 – Forbidden</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>500 – Container error. Non-recoverable state. Extension should exit promptly.</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                  
                                  
                                 
                                 <h3 id="runtimes-extensions-exit-error">Exit error</h3>
                                 
                                 <p>The extension uses this method to report an error to Lambda before exiting. Call it
                                    when you encounter an
                                    unexpected failure. After Lambda receives the error, no further API calls succeed.
                                    The extension should
                                    exit.
                                 </p>
                                 
                                 <p><b>Path</b> – <code class="code">/extension/exit/error</code></p>
                                 
                                 <p><b>Method</b> – <b>POST</b></p>
                                 
                                 <p><b>Headers</b></p>
                                 
                                 <p><code class="code">Lambda-Extension-Identifier</code> – Unique identifier for extension. Required: yes. Type: UUID
                                    string.
                                 </p>
                                 
                                 <p><code class="code">Lambda-Extension-Function-Error-Type</code> – Error enum. Required: yes. Type: String error
                                    enum (for example, Fatal.ConnectFailed).
                                 </p>
                                 
                                 <p><b>Body parameters</b></p>
                                 
                                 <p><code class="code">ErrorRequest</code> – JSON object with the error type, error message, and stack trace.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response body</b></p>
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><code class="code">Lambda-Extension-Identifier</code> – Unique agent identifier (UUID string).
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Response codes</b></p>
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>202 – Accepted</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>400 – Bad Request</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>403 – Forbidden</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>500 – Container error. Non-recoverable state. Extension should exit promptly.</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p> </p>
                                  
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="runtimes-api.html">Runtime API</div>
                                    <div id="next" class="next-link" accesskey="n" href="runtimes-modify.html">Runtime modifications</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-extensions-api.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:00:28 GMT -->
</html>