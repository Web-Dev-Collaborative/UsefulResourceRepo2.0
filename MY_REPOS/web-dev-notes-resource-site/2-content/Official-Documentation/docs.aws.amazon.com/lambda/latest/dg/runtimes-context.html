<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/runtimes-context.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:00:11 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>AWS Lambda execution environment - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="runtimes-context" />
      <meta name="default_state" content="runtimes-context" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="runtimes-context.html" />
      <meta name="description" content="Lambda invokes your function in an execution environment, which provides a secure and isolated runtime environment. The execution environment manages the resources required to run your function. The execution environment also provides lifecycle support for the function's runtime and any" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>AWS Lambda execution environment - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#runtimes-context" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/runtimes-context.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-context.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-context.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-context.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#runtimes-context" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/runtimes-context.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#runtimes-lifecycle">Runtime lifecycle</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="runtimes-context">AWS Lambda execution environment</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>Lambda invokes your function in an execution environment, which provides a secure
                                    and isolated runtime
                                    environment. The execution environment manages the resources required to run your
                                    function. The execution
                                    environment also provides lifecycle support for the function's runtime and any <a href="using-extensions.html">external extensions</a> associated with your function.
                                 </p>
                                 <p>The function's runtime communicates with Lambda using the <a href="runtimes-api.html">Runtime API</a>.
                                    Extensions communicate with Lambda using the <a href="runtimes-extensions-api.html">Extensions API</a>.
                                    Extensions can also receive log messages from the function by subscribing to logs
                                    using the <a href="runtimes-logs-api.html">Logs API</a>.
                                 </p>
                                 <p></p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/logs-api-concept-diagram.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      Architecture diagram of the execution environment.&#xA;    " style="max-width:80%" />
                                     
                                     
                                    
                                 </div>
                                 <p>When you create your Lambda function, you specify configuration information, such
                                    as the amount of memory
                                    available and the maximum execution time allowed for your function. Lambda uses this
                                    information to set up the
                                    execution environment.
                                 </p>
                                 <p>The function's runtime and each external extension are processes that run within the
                                    execution environment.
                                    Permissions, resources, credentials, and environment variables are shared between
                                    the function and the
                                    extensions.
                                 </p>
                                 
                                 <h2 id="runtimes-lifecycle">Lambda execution environment lifecycle</h2>
                                 
                                 
                                 
                                 <p>The lifecycle of the execution environment includes the following phases:</p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><code class="code"><b>Init</b></code>: In this phase, Lambda creates or
                                             unfreezes an execution environment with the configured resources, downloads the code
                                             for the function and
                                             all layers, initializes any extensions, initializes the runtime, and then runs the
                                             function’s initialization
                                             code (the code outside the main handler). The <code class="code">Init</code> phase happens either during the first
                                             invocation, or in advance of function invocations if you have enabled <a href="configuration-concurrency.html#configuration-concurrency-provisioned">provisioned concurrency</a>.
                                          </p>
                                          
                                          <p>The <code class="code">Init</code> phase is split into three sub-phases: <code class="code">Extension init</code>, <code class="code">Runtime
                                                init</code>, and <code class="code">Function init</code>. These sub-phases ensure that all extensions and the runtime
                                             complete their setup tasks before the function code runs.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><code class="code"><b>Invoke</b></code>: In this phase, Lambda invokes the function handler.
                                             After the function runs to completion, Lambda prepares to handle another function
                                             invocation.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><code class="code"><b>Shutdown</b></code>: This phase is triggered if the Lambda function does not
                                             receive any invocations for a period of time. In the <code class="code">Shutdown</code> phase, Lambda terminates
                                             the runtime, alerts the extensions to let them stop cleanly, and then removes the
                                             environment. Lambda
                                             sends a <code class="code">Shutdown</code> event to each extension, which tells the extension that the environment is about
                                             to be shut down.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Overview-Successful-Invokes.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        The Init  phase is followed by one or more function invocations. When there are no&#xA;          invocation requests, Lambda  initiates the SHutdown phase.&#xA;      " style="max-width:80%" />
                                     
                                     
                                    
                                 </div>
                                 
                                 <p>Each phase starts with an event that Lambda sends to the runtime and to all registered
                                    extensions. The
                                    runtime and each extension indicate completion by sending a <code class="code">Next</code> API request. Lambda freezes the
                                    execution environment when the runtime and each extension have completed and there
                                    are no pending events.
                                 </p>
                                 
                                 
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Topics</strong></p>
                                    <ul>
                                       <li><a href="#runtimes-lifecycle-ib">Init phase</a></li>
                                       <li><a href="#runtimes-lifecycle-invoke">Invoke phase</a></li>
                                       <li><a href="#runtimes-lifecycle-shutdown">Shutdown phase</a></li>
                                    </ul>
                                 </div>
                                  
                                 
                                 <h3 id="runtimes-lifecycle-ib">Init phase</h3>
                                 
                                 <p>In the <code class="code">Init</code> phase, Lambda performs three tasks:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Start all extensions (<code class="code">Extension init</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Bootstrap the runtime (<code class="code">Runtime init</code>)
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Run the function's static code (<code class="code">Function init</code>)
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>The <code class="code">Init</code> phase ends when the runtime and all extensions signal that they are ready by sending
                                    a
                                    <code class="code">Next</code> API request. The <code class="code">Init</code> phase is limited to 10 seconds. If all three tasks do not
                                    complete within 10 seconds, Lambda retries the <code class="code">Init</code> phase at the time of the first function
                                    invocation.
                                 </p>
                                  
                                  
                                 
                                 <h3 id="runtimes-lifecycle-invoke">Invoke phase</h3>
                                 
                                 <p>When a Lambda function is invoked in response to a <code class="code">Next</code> API request, Lambda sends an
                                    <code class="code">Invoke</code> event to the runtime and to each extension.
                                 </p>
                                 
                                 <p>The function's timeout setting limits the duration of the entire <code class="code">Invoke</code> phase. For example, if
                                    you set the function timeout as 360 seconds, the function and all extensions need
                                    to complete within 360
                                    seconds. Note that there is no independent post-invoke phase. The duration is the
                                    sum of all invocation time
                                    (runtime + extensions) and is not calculated until the function and all extensions
                                    have finished
                                    executing.
                                 </p>
                                 
                                 <p>The invoke phase ends after the runtime and all extensions signal that they are done
                                    by sending a
                                    <code class="code">Next</code> API request.
                                 </p>
                                 
                                 <p>If there is a failure during <code class="code">Invoke</code>, Lambda resets the execution environment. The reset behaves
                                    like a <code class="code">Shutdown</code> event. First, Lambda shuts down the runtime. Then Lambda sends a
                                    <code class="code">Shutdown</code> event to each registered external extension. The event includes the reason for the
                                    shutdown. If another <code class="code">Invoke</code> event results in this execution environment being reused, Lambda
                                    initializes the runtime and extensions as part of the next invocation.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/Overview-Invoke-with-Error.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;          This is my image.&#xA;        " style="max-width:80%" />
                                     
                                     
                                    
                                 </div>
                                  
                                  
                                 
                                 <h3 id="runtimes-lifecycle-shutdown">Shutdown phase</h3>
                                 
                                 <p>When Lambda is about to shut down the runtime, it sends a <code class="code">Shutdown</code> event to the runtime and to
                                    each external extension. Extensions can use this time for final cleanup tasks. The
                                    <code class="code">Shutdown</code> event
                                    is a response to a <code class="code">Next</code> API request.
                                 </p>
                                 
                                 <p><b>Duration</b>: The entire <code class="code">Shutdown</code> phase is capped at 2 seconds. If
                                    the runtime or any extension does not respond, Lambda terminates it via a signal (<code class="code">SIGKILL</code>). 
                                 </p>
                                 
                                 <p>After the function and all extensions have completed, Lambda maintains the execution
                                    environment for some
                                    time in anticipation of another function invocation. In effect, Lambda freezes the
                                    execution environment. When
                                    the function is invoked again, Lambda thaws the environment for reuse. Reusing the
                                    execution environment has the
                                    following implications: 
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Objects declared outside of the function's handler method remain initialized, providing
                                             additional
                                             optimization when the function is invoked again. For example, if your Lambda function
                                             establishes a database
                                             connection, instead of reestablishing the connection, the original connection is used
                                             in subsequent
                                             invocations. We recommend adding logic in your code to check if a connection exists
                                             before creating a new
                                             one.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Each execution environment provides 512 MB of disk space in the <code>/tmp</code>
                                             directory. The directory content remains when the execution environment is frozen,
                                             providing a transient
                                             cache that can be used for multiple invocations. You can add extra code to check if
                                             the cache has the data
                                             that you stored. For more information on deployment size limits, see <a href="gettingstarted-limits.html">Lambda quotas</a>.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Background processes or callbacks that were initiated by your Lambda function and
                                             did not complete when
                                             the function ended resume if Lambda reuses the execution environment. Make sure that
                                             any background processes
                                             or callbacks in your code are complete before the code exits.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>When you write your function code, do not assume that Lambda automatically reuses
                                    the execution environment
                                    for subsequent function invocations. Other factors may dictate a need for Lambda to
                                    create a new execution
                                    environment, which can lead to unexpected results, such as database connection failures.
                                 </p>
                                  
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="runtime-support-policy.html">Runtime support policy</div>
                                    <div id="next" class="next-link" accesskey="n" href="runtimes-images.html">Container images</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-context.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/runtimes-context.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/runtimes-context.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:00:14 GMT -->
</html>