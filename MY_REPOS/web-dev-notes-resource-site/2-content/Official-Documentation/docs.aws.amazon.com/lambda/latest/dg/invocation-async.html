<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" ng-app="AWSDocsDocPageApp">
   
<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/invocation-async.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:02:40 GMT -->
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Asynchronous invocation - AWS Lambda</title>
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <meta name="assets_root" content="/assets" />
      <meta name="target_state" content="invocation-async" />
      <meta name="default_state" content="invocation-async" />
      <link rel="icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="https://docs.aws.amazon.com/assets/images/favicon.ico" />
      <link rel="canonical" href="invocation-async.html" />
      <meta name="description" content="Several AWS services, such as Amazon Simple Storage Service (Amazon S3) and Amazon Simple Notification Service (Amazon SNS), invoke functions asynchronously to process events. When you invoke a function asynchronously, you don't wait for a response from the function code. You hand off the event to Lambda and Lambda handles the rest. You can configure how Lambda handles errors, and can send invocation records to a downstream resource to chain together components of your application." />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="AWS Lambda" />
      <meta name="guide" content="Developer Guide" />
      <meta name="locales" content="de_de:Deutsch/en_us:English/es_es:Español/fr_fr:Français/it_it:Italiano/ja_jp:日本語/ko_kr:한국어/pt_br:Português/zh_cn:中文 (简体)/zh_tw:中文 (繁體)" />
      <meta name="abstract" content="" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <meta name="feedback-item" content="Lambda" />
      <meta name="this_doc_product" content="AWS Lambda" />
      <meta name="this_doc_guide" content="Developer Guide" />
      <link href="https://docs.aws.amazon.com/assets/css/vendor4.css?version=2020.09.30" rel="stylesheet" />
      <link href="https://docs.aws.amazon.com/assets/css/awsdocs-common.css?version=2020.09.30" rel="stylesheet" /><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor3.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor4.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/vendor1.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-common.js?version=2020.09.30" defer=""></script><script type="text/javascript" src="https://docs.aws.amazon.com/assets/js/awsdocs-doc-app.js?version=2020.09.30" defer=""></script></head>
   <body class="awsdocs awsui">
      <div class="awsdocs-container">
         <awsdocs-header></awsdocs-header>
         <awsui-app-layout id="app-layout" class="awsui-util-no-gutters" ng-controller="ContentController as $ctrl" header-selector="awsdocs-header" navigation-hide="false" navigation-width="$ctrl.navWidth" navigation-open="$ctrl.navOpen" navigation-change="$ctrl.onNavChange($event)" tools-hide="$ctrl.hideTools" tools-width="$ctrl.toolsWidth" tools-open="$ctrl.toolsOpen" tools-change="$ctrl.onToolsChange($event)">
            <div id="guide-toc" dom-region="navigation">
               <awsdocs-toc></awsdocs-toc>
            </div>
            <div id="main-column" dom-region="content" tabindex="-1">
               <awsdocs-view class="awsdocs-view">
                  <div id="awsdocs-content">
                     <head>
                        <title>Asynchronous invocation - AWS Lambda</title>
                        <meta name="pdf" content="lambda-dg.pdf#invocation-async" />
                        <meta name="kindle" content="https://www.amazon.com/dp/B07GFJLN6D" />
                        <meta name="github" content="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/invocation-async.md" />
                        <meta name="rss" content="lambda-updates.rss" />
                        <meta name="forums" content="http://forums.aws.amazon.com/forum.jspa?forumID=186" />
                        <meta name="feedback" content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-async.html" />
                        <meta name="feedback-yes" content="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-async.html" />
                        <meta name="feedback-no" content="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-async.html" />
                        <meta name="keywords" content="Lambda,AWS Lambda,serverless,serverless applications,cloud computing" />
                     </head>
                     <body>
                        <div id="main">
                           <div style="display: none"><a href="lambda-dg.pdf#invocation-async" target="_blank" title="Open PDF"></a><a target="_blank" href="https://www.amazon.com/dp/B07GFJLN6D" title="Open Kindle"></a><a href="https://github.com/awsdocs/aws-lambda-developer-guide/tree/main/doc_source/invocation-async.md" target="_blank" title="Edit this page on GitHub"></a></div>
                           <div id="breadcrumbs" class="breadcrumb"><a href="http://aws.amazon.com/">AWS</a><a href="https://docs.aws.amazon.com/index.html">Documentation</a><a href="https://docs.aws.amazon.com/lambda/index.html">AWS Lambda</a><a href="welcome.html">Developer Guide</a></div>
                           <div id="page-toc-src"><a href="#invocation-async-errors">Configuring error handling for asynchronous invocation</a><a href="#invocation-async-destinations">Configuring destinations for asynchronous invocation</a><a href="#invocation-async-api">Asynchronous invocation configuration API</a><a href="#dlq">Dead-letter queues</a></div>
                           <div id="main-content" class="awsui-util-container">
                              <div id="main-col-body">
                                 <awsdocs-language-banner data-service="$ctrl.pageService"></awsdocs-language-banner>
                                 <h1 class="topictitle" id="invocation-async">Asynchronous invocation</h1>
                                 <div class="awsdocs-page-header-container">
                                    <awsdocs-page-header></awsdocs-page-header>
                                    <awsdocs-filter-selector id="awsdocs-filter-selector"></awsdocs-filter-selector>
                                 </div>
                                 <p>Several AWS services, such as Amazon Simple Storage Service (Amazon S3) and Amazon
                                    Simple Notification Service (Amazon SNS), invoke functions asynchronously to
                                    process events. When you invoke a function asynchronously, you don't wait for a response
                                    from the function code. You
                                    hand off the event to Lambda and Lambda handles the rest. You can configure how Lambda
                                    handles errors, and can send
                                    invocation records to a downstream resource to chain together components of your application.
                                 </p>
                                 <p>The following diagram shows clients invoking a Lambda function asynchronously. Lambda
                                    queues the events before
                                    sending them to the function.
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/features-async.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      Clients invoke a function asynchronously. Lambda queues the events before sending them to the&#xA;        function.&#xA;    " />
                                     
                                     
                                    
                                 </div>
                                 <p>For asynchronous invocation, Lambda places the event in a queue and returns a success
                                    response without additional
                                    information. A separate process reads events from the queue and sends them to your
                                    function. To invoke a function
                                    asynchronously, set the invocation type parameter to <code class="code">Event</code>.
                                 </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda invoke --function-name my-function  --invocation-type Event --payload '<span>{</span> "key": "value" }' response.json</code></code></pre><p>You should see the following output:</p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "StatusCode": 202
}</code></pre><p>The output file (<code class="code">response.json</code>) doesn't contain any information, but is still created when you run
                                    this command. If Lambda isn't able to add the event to the queue, the error message
                                    appears in the command
                                    output.
                                 </p>
                                 <p>Lambda manages the function's asynchronous event queue and attempts to retry on errors.
                                    If the function returns
                                    an error, Lambda attempts to run it two more times, with a one-minute wait between
                                    the first two attempts, and two
                                    minutes between the second and third attempts. Function errors include errors returned
                                    by the function's code and
                                    errors returned by the function's runtime, such as timeouts.
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/invocation-types-retries.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      Lambda records each attempt in a subsegment.&#xA;    " />
                                     
                                     
                                    
                                 </div>
                                 <p>If the function doesn't have enough concurrency available to process all events, additional
                                    requests are
                                    throttled. For throttling errors (429) and system errors (500-series), Lambda returns
                                    the event to the queue and
                                    attempts to run the function again for up to 6 hours. The retry interval increases
                                    exponentially from 1 second after
                                    the first attempt to a maximum of 5 minutes. However, it might be longer if the queue
                                    is backed up. Lambda also
                                    reduces the rate at which it reads events from the queue.
                                 </p>
                                 <p>The following example shows an event that was successfully added to the queue, but
                                    is still pending one hour
                                    later due to throttling.
                                 </p>
                                 <div class="mediaobject">
                                     
                                    <img src="images/invocation-types-throttle.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      Throttled requests appear as pending in AWS X-Ray.&#xA;    " />
                                     
                                     
                                    
                                 </div>
                                 <p>Even if your function doesn't return an error, it's possible for it to receive the
                                    same event from Lambda
                                    multiple times because the queue itself is eventually consistent. If the function
                                    can't keep up with incoming
                                    events, events might also be deleted from the queue without being sent to the function.
                                    Ensure that your function
                                    code gracefully handles duplicate events, and that you have enough concurrency available
                                    to handle all
                                    invocations.
                                 </p>
                                 <p>When the queue is backed up, new events might age out before Lambda has a chance to
                                    send them to your function.
                                    When an event expires or fails all processing attempts, Lambda discards it. You can
                                    <a href="#invocation-async-errors">configure error handling</a> for a function to reduce the number of retries
                                    that Lambda performs, or to discard unprocessed events more quickly.
                                 </p>
                                 <p>You can also configure Lambda to send an invocation record to another service. Lambda
                                    supports the following <a href="#invocation-async-destinations">destinations</a> for asynchronous invocation.
                                 </p>
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SQS</b> – A standard SQS queue.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SNS</b> – An SNS topic.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>AWS Lambda</b> – A Lambda function.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>Amazon EventBridge</b> – An EventBridge event bus.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 <p>The invocation record contains details about the request and response in JSON format.
                                    You can configure separate
                                    destinations for events that are processed successfully, and events that fail all
                                    processing attempts.
                                    Alternatively, you can configure an SQS queue or SNS topic as a <a href="#dlq">dead-letter queue</a> for
                                    discarded events. For dead-letter queues, Lambda only sends the content of the event,
                                    without details about the
                                    response.
                                 </p>
                                 <div class="highlights" id="inline-topiclist">
                                    <p><strong>Sections</strong></p>
                                    <ul>
                                       <li><a href="#invocation-async-errors">Configuring error handling for asynchronous invocation</a></li>
                                       <li><a href="#invocation-async-destinations">Configuring destinations for asynchronous invocation</a></li>
                                       <li><a href="#invocation-async-api">Asynchronous invocation configuration API</a></li>
                                       <li><a href="#dlq">AWS Lambda function dead-letter queues</a></li>
                                    </ul>
                                 </div>
                                 
                                 <h2 id="invocation-async-errors">Configuring error handling for asynchronous invocation</h2>
                                 
                                 
                                 <p>Use the Lambda console to configure error handling settings on a function, a version,
                                    or an alias.
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To configure error handling</b></p>
                                    <ol>
                                       <li>
                                          <p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the Lambda console.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>Choose a function.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Asynchronous invocation</b>, choose <b>Edit</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Configure the following settings.</p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p><b>Maximum age of event</b> – The maximum amount of time Lambda retains an event
                                                      in the asynchronous event queue, up to 6 hours.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><b>Retry attempts</b> – The number of times Lambda retries when the function
                                                      returns an error, between 0 and 2.
                                                   </p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Save</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>When an invocation event exceeds the maximum age or fails all retry attempts, Lambda
                                    discards it. To retain a
                                    copy of discarded events, configure a failed-event destination.
                                 </p>
                                  
                                 
                                 <h2 id="invocation-async-destinations">Configuring destinations for asynchronous invocation</h2>
                                 
                                 
                                 <p>To send records of asynchronous invocations to another service, add a destination
                                    to your function. You can
                                    configure separate destinations for events that fail processing and events that are
                                    successfully processed. Like
                                    error handling settings, you can configure destinations on a function, a version,
                                    or an alias.
                                 </p>
                                 
                                 
                                 <p>The following example shows a function that is processing asynchronous invocations.
                                    When the function returns
                                    a success response or exits without throwing an error, Lambda sends a record of the
                                    invocation to an EventBridge event
                                    bus. When an event fails all processing attempts, Lambda sends an invocation record
                                    to an Amazon SQS queue.
                                 </p>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/features-destinations.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;        Lambda sends invocation records to a queue or event bus destination, depending on the result.&#xA;      " />
                                     
                                     
                                    
                                 </div>
                                 
                                 
                                 <p>To send events to a destination, your function needs additional permissions. Add a
                                    policy with the required
                                    permissions to your function's <a href="lambda-intro-execution-role.html">execution role</a>. Each destination
                                    service requires a different permission, as follows:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SQS</b> – <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html">sqs:SendMessage</a>
                                             
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SNS</b> – <a href="https://docs.aws.amazon.com/sns/latest/api/API_Publish.html">sns:Publish</a>
                                             
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>Lambda</b> – <a href="API_Invoke.html">lambda:InvokeFunction</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>EventBridge</b> – <a href="https://docs.aws.amazon.com/eventbridge/latest/APIReference/API_PutEvents.html">events:PutEvents</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>Add destinations to your function in the Lambda console's function designer.</p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To configure a destination for asynchronous invocation records</b></p>
                                    <ol>
                                       <li>
                                          <p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the Lambda console.
                                          </p>
                                       </li>
                                       <li>
                                          
                                          <p>Choose a function.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Designer</b>, choose <b>Add destination</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For <b>Source</b>, choose <b>Asynchronous invocation</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For <b>Condition</b>, choose from the following options:
                                          </p>
                                          
                                          <div class="itemizedlist">
                                              
                                              
                                             
                                             <ul class="itemizedlist" type="disc">
                                                <li class="listitem">
                                                   
                                                   <p><b>On failure</b> – Send a record when the event fails all processing attempts or
                                                      exceeds the maximum age.
                                                   </p>
                                                   
                                                </li>
                                                <li class="listitem">
                                                   
                                                   <p><b>On success</b> – Send a record when the function successfully processes an
                                                      asynchronous invocation.
                                                   </p>
                                                   
                                                </li>
                                             </ul>
                                          </div>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For <b>Destination type</b>, choose the type of resource that receives the invocation
                                             record.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>For <b>Destination</b>, choose a resource.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Save</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>When an invocation matches the condition, Lambda sends a JSON document with details
                                    about the invocation to the
                                    destination. The following example shows an invocation record for an event that failed
                                    three processing attempts
                                    due to a function error.
                                 </p>
                                 
                                 <div class="example">
                                    <p class="title"><b>Example invocation record</b></p>
                                    <div class="example-contents"><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
    "version": "1.0",
    "timestamp": "2019-11-14T18:16:05.568Z",
    "requestContext": <span>{</span>
        "requestId": "e4b46cbf-b738-xmpl-8880-a18cdf61200e",
        "functionArn": "arn:aws:lambda:us-east-2:123456789012:function:my-function:$LATEST",
        "condition": "RetriesExhausted",
        "approximateInvokeCount": 3
    },
    "requestPayload": <span>{</span>
        "ORDER_IDS": [
            "9e07af03-ce31-4ff3-xmpl-36dce652cb4f",
            "637de236-e7b2-464e-xmpl-baf57f86bb53",
            "a81ddca6-2c35-45c7-xmpl-c3a03a31ed15"
        ]
    },
    "responseContext": <span>{</span>
        "statusCode": 200,
        "executedVersion": "$LATEST",
        "functionError": "Unhandled"
    },
    "responsePayload": <span>{</span>
        "errorMessage": "RequestId: e4b46cbf-b738-xmpl-8880-a18cdf61200e Process exited before completing request"
    }
}</code></pre></div>
                                 </div>
                                 
                                 <p>The invocation record contains details about the event, the response, and the reason
                                    that the record was
                                    sent.
                                 </p>
                                  
                                 
                                 <h2 id="invocation-async-api">Asynchronous invocation configuration API</h2>
                                 
                                 
                                 <p>To manage asynchronous invocation settings with the AWS CLI or AWS SDK, use the following
                                    API
                                    operations.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="API_PutFunctionEventInvokeConfig.html">PutFunctionEventInvokeConfig</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_GetFunctionEventInvokeConfig.html">GetFunctionEventInvokeConfig</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_UpdateFunctionEventInvokeConfig.html">UpdateFunctionEventInvokeConfig</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_ListFunctionEventInvokeConfigs.html">ListFunctionEventInvokeConfigs</a></p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="API_DeleteFunctionEventInvokeConfig.html">DeleteFunctionEventInvokeConfig</a></p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <p>To configure asynchronous invocation with the AWS CLI, use the <code class="code">put-function-event-invoke-config</code>
                                    command. The following example configures a function with a maximum event age of 1
                                    hour and no retries.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda put-function-event-invoke-config --function-name error \
--maximum-event-age-in-seconds 3600 --maximum-retry-attempts 0</code></code></pre>
                                 <p>You should see the following output:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class=""><span>{</span>
    "LastModified": 1573686021.479,
    "FunctionArn": "arn:aws:lambda:us-east-2:123456789012:function:error:$LATEST",
    "MaximumRetryAttempts": 0,
    "MaximumEventAgeInSeconds": 3600,
    "DestinationConfig": <span>{</span>
        "OnSuccess": <span>{</span>},
        "OnFailure": <span>{</span>}
    }
}</code></pre>
                                 <p>The <code class="code">put-function-event-invoke-config</code> command overwrites any existing configuration on the
                                    function, version, or alias. To configure an option without resetting others, use
                                    <code class="code">update-function-event-invoke-config</code>. The following example configures Lambda to send a record to an
                                    SQS queue named <code class="code">destination</code> when an event can't be processed.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><code class="userinput">aws lambda update-function-event-invoke-config --function-name error \
--destination-config '<span>{</span>"OnFailure":<span>{</span>"Destination": "arn:aws:sqs:us-east-2:123456789012:destination"}}'</code></code></pre>
                                 <p>You should see the following output:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight"><span>{</span>
    "LastModified": 1573687896.493,
    "FunctionArn": "arn:aws:lambda:us-east-2:123456789012:function:error:$LATEST",
    "MaximumRetryAttempts": 0,
    "MaximumEventAgeInSeconds": 3600,
    "DestinationConfig": <span>{</span>
        "OnSuccess": <span>{</span>},
        <code class="userinput">"OnFailure": <span>{</span>
            "Destination": "arn:aws:sqs:us-east-2:123456789012:destination"
        }</code>
    }
}</code></pre>
                                  
                                 <h2 id="dlq">AWS Lambda function dead-letter queues</h2>
                                 
                                 
                                 <p>As an alternative to an <a href="#invocation-async-destinations">on-failure destination</a>, you can
                                    configure your function with a dead-letter queue to save discarded events for further
                                    processing. A dead-letter
                                    queue acts the same as an on-failure destination in that it is used when an event
                                    fails all processing attempts or
                                    expires without being processed. However, a dead-letter queue is part of a function's
                                    version-specific
                                    configuration, so it is locked in when you publish a version. On-failure destinations
                                    also support additional
                                    targets and include details about the function's response in the invocation record.
                                 </p>
                                 
                                 
                                 <p>If you don't have a queue or topic, create one. Choose the target type that matches
                                    your use case.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-create-queue.html">Amazon SQS queue</a> – A queue holds failed events
                                             until they're retrieved. You can retrieve events manually, or you can <a href="with-sqs.html">configure Lambda
                                                to read from the queue</a> and invoke a function.
                                          </p>
                                          
                                          <p>Create a queue in the <a href="https://console.aws.amazon.com/sqs" rel="noopener noreferrer" target="_blank"><span>Amazon SQS console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><a href="https://docs.aws.amazon.com/sns/latest/gsg/CreateTopic.html">Amazon SNS topic</a> – A topic relays failed events to one
                                             or more destinations. You can configure a topic to send events to an email address,
                                             a Lambda function, or an HTTP
                                             endpoint.
                                          </p>
                                          
                                          <p>Create a topic in the <a href="https://console.aws.amazon.com/sns/home" rel="noopener noreferrer" target="_blank"><span>Amazon SNS console</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a>.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 
                                 <p>To send events to a queue or topic, your function needs additional permissions. Add
                                    a policy with the required
                                    permissions to your function's <a href="lambda-intro-execution-role.html">execution role</a>.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SQS</b> – <a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_SendMessage.html">sqs:SendMessage</a>
                                             
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>Amazon SNS</b> – <a href="https://docs.aws.amazon.com/sns/latest/api/API_Publish.html">sns:Publish</a>
                                             
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 
                                 <p>If the target queue or topic is encrypted with a customer managed key, the execution
                                    role must also be a user in
                                    the key's <a href="https://docs.aws.amazon.com/kms/latest/developerguide/key-policies.html">resource-based policy</a>.
                                 </p>
                                 
                                 
                                 <p>After creating the target and updating your function's execution role, add the dead-letter
                                    queue to your
                                    function. You can configure multiple functions to send events to the same target.
                                 </p>
                                 
                                 <div class="procedure">
                                    <p class="title"><b>To configure a dead-letter queue</b></p>
                                    <ol>
                                       <li> 
                                          <p>Open the <a href="https://console.aws.amazon.com/lambda/home#/functions" rel="noopener noreferrer" target="_blank"><span>Functions page</span><awsui-icon class="awsdocs-link-icon" name="external"></awsui-icon></a> on the Lambda console.
                                          </p> 
                                       </li>
                                       <li>
                                          
                                          <p>Choose a function.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Under <b>Asynchronous invocation</b>, choose <b>Edit</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Set <b>DLQ resource</b> to <b>Amazon SQS</b> or <b>Amazon SNS</b>.
                                          </p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose the target queue or topic.</p>
                                          
                                       </li>
                                       <li>
                                          
                                          <p>Choose <b>Save</b>.
                                          </p>
                                          
                                       </li>
                                    </ol>
                                 </div>
                                 
                                 <p>To configure a dead-letter queue with the AWS CLI, use the <code class="code">update-function-configuration</code>
                                    command.
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><code class="nohighlight">$ <code class="userinput">aws lambda update-function-configuration --function-name my-function \
--dead-letter-config TargetArn=<code class="replaceable">arn:aws:sns:us-east-2:123456789012:my-topic</code></code></code></pre>
                                 
                                 <p>Lambda sends the event to the dead-letter queue as-is, with additional information
                                    in attributes. You can use
                                    this information to identify the error that the function returned, or to correlate
                                    the event with logs or an
                                    AWS X-Ray trace.
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    <p class="title"><b>Dead-letter queue message attributes</b></p>
                                     
                                     
                                     
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p><b>RequestID</b> (String) – The ID of the invocation request. Request IDs
                                             appear in function logs. You can also use the X-Ray SDK to record the request ID on
                                             an attribute in the trace.
                                             You can then search for traces by request ID in the X-Ray console. For an example,
                                             see the <a href="samples-errorprocessor.html">error processor sample</a>.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>ErrorCode</b> (Number) – The HTTP status code.
                                          </p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p><b>ErrorMessage</b> (String) – The first 1 KB of the error message.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <div class="mediaobject">
                                     
                                    <img src="images/invocation-dlq-attributes.png" class="aws-docs-img-whiteBg aws-docs-img-padding" alt="&#xA;      Dead-letter queue event attributes in the Amazon SQS console.&#xA;    " />
                                     
                                     
                                    
                                 </div>
                                 
                                 
                                 <p>If Lambda can't send a message to the dead-letter queue, it deletes the event and
                                    emits the <a href="monitoring-metrics.html">DeadLetterErrors</a> metric. This can happen because of lack of permissions, or if
                                    the total size of the message exceeds the limit for the target queue or topic. For
                                    example, if an Amazon SNS notification
                                    with a body close to 256 KB triggers a function that results in an error, the additional
                                    event data
                                    added by Amazon SNS, combined with the attributes added by Lambda, can cause the message
                                    to exceed the maximum size
                                    allowed in the dead-letter queue. 
                                 </p>
                                 
                                 <p>If you're using Amazon SQS as an event source, configure a dead-letter queue on the
                                    Amazon SQS queue itself and not on the
                                    Lambda function. For more information, see <a href="with-sqs.html">Using AWS Lambda with Amazon SQS</a>.
                                 </p>
                                 
                                 <awsdocs-copyright class="copyright-print"></awsdocs-copyright>
                                 <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}"></awsdocs-thumb-feedback>
                              </div>
                              <noscript>
                                 <div>
                                    <div>
                                       <div>
                                          <div id="js_error_message">
                                             <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                                   browser.</strong></p>
                                             <p>To use the AWS Documentation, Javascript must be
                                                enabled. Please refer to your browser's Help pages for instructions.
                                             </p>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </noscript>
                              <div id="main-col-footer" class="awsui-util-font-size-0">
                                 <div id="doc-conventions"><a target="_top" href="https://docs.aws.amazon.com/general/latest/gr/docconventions.html">Document Conventions</a></div>
                                 <div class="prev-next">
                                    <div id="previous" class="prev-link" accesskey="p" href="invocation-sync.html">Synchronous invocation</div>
                                    <div id="next" class="next-link" accesskey="n" href="invocation-eventsourcemapping.html">Event source mapping</div>
                                 </div>
                              </div>
                              <awsdocs-page-utilities></awsdocs-page-utilities>
                           </div>
                           <div id="quick-feedback-yes" style="display: none;">
                              <div class="title">Did this page help you? - Yes</div>
                              <div class="content">
                                 <p>Thanks for letting us know we're doing a good
                                    job!
                                 </p>
                                 <p>If you've got a moment, please tell us what we did right
                                    so we can do more of it.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-async.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                           <div id="quick-feedback-no" style="display: none;">
                              <div class="title">Did this page help you? - No</div>
                              <div class="content">
                                 <p>Thanks for letting us know this page needs work. We're
                                    sorry we let you down.
                                 </p>
                                 <p>If you've got a moment, please tell us how we can make
                                    the documentation better.
                                 </p>
                                 <p>
                                    <awsui-button id="fblink" target="_blank" text="Feedback" click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Lambda&amp;topic_url=https://docs.aws.amazon.com/en_us/lambda/latest/dg/invocation-async.html"></awsui-button>
                                 </p>
                              </div>
                           </div>
                        </div>
                     </body>
                  </div>
               </awsdocs-view>
               <div class="page-loading-indicator" id="page-loading-indicator">
                  <awsui-spinner size="large"></awsui-spinner>
               </div>
            </div>
            <div id="tools-panel" dom-region="tools">
               <awsdocs-tools-panel id="awsdocs-tools-panel"></awsdocs-tools-panel>
            </div>
         </awsui-app-layout>
         <awsdocs-cookie-banner class="doc-cookie-banner"></awsdocs-cookie-banner>
         <!--
                SiteCatalyst code version: H.25.2.
                Copyright 1996-2012 Adobe, Inc. All Rights Reserved
                More info available at http://www.omniture.com
            --><script language="JavaScript" type="text/javascript">
var awsdocs = awsdocs || {};
awsdocs.prop66 = 'AWS Lambda';
awsdocs.prop65 =  'Developer Guide';
            </script><script src="https://a0.awsstatic.com/s_code/js/3.0/awshome_s_code.js" language="JavaScript" type="text/javascript"></script>
         <!--/DO NOT REMOVE/-->
         <!--End SiteCatalyst code version: H.25.2.--></div>
   </body>

<!-- Mirrored from docs.aws.amazon.com/lambda/latest/dg/invocation-async.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 21 Feb 2021 15:02:47 GMT -->
</html>