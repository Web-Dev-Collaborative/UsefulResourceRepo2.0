<h2 id="why-in-busboy-i-am-making-use-of-stream-for-uploading-files">Why in busboy I am making use of stream for uploading files</h2>
<p><a href="https://gist.github.com/shobhitg/5b367f01b6daf46a0287">An example of file upload with busboy and express</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// accept POST request on the homepage</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">app</span>.<span class="at">post</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">var</span> busboy <span class="op">=</span> <span class="kw">new</span> <span class="at">Busboy</span>(<span class="op">{</span> <span class="dt">headers</span><span class="op">:</span> <span class="va">req</span>.<span class="at">headers</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="va">busboy</span>.<span class="at">on</span>(<span class="st">&#39;file&#39;</span><span class="op">,</span> <span class="kw">function</span>(fieldname<span class="op">,</span> file<span class="op">,</span> filename<span class="op">,</span> encoding<span class="op">,</span> mimetype) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-5" title="5">      <span class="kw">var</span> saveTo <span class="op">=</span> <span class="va">path</span>.<span class="at">join</span>(<span class="st">&#39;.&#39;</span><span class="op">,</span> filename)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" title="6">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Uploading: &#39;</span> <span class="op">+</span> saveTo)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" title="7">      <span class="va">file</span>.<span class="at">pipe</span>(<span class="va">fs</span>.<span class="at">createWriteStream</span>(saveTo))<span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="va">busboy</span>.<span class="at">on</span>(<span class="st">&#39;finish&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb1-10" title="10">      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Upload complete&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-11" title="11">      <span class="va">res</span>.<span class="at">writeHead</span>(<span class="dv">200</span><span class="op">,</span> <span class="op">{</span> <span class="st">&#39;Connection&#39;</span><span class="op">:</span> <span class="st">&#39;close&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-12" title="12">      <span class="va">res</span>.<span class="at">end</span>(<span class="st">&quot;That&#39;s all folks!&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="cf">return</span> <span class="va">req</span>.<span class="at">pipe</span>(busboy)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Handling file uploads in Node.js may seem at first glance like a simple task. Modules like multer allow you to easily handle file uploads as part of an express route. This works great for small files that don’t leave a significant memory footprint. But what happens when you upload very large files and load them into memory?</p>
<p>Imagine you want to download very large file and upload it to a destination. In this example, we’ll use the request module to both handle the download and the upload as a stream.</p>
<p>First, we need to create a read stream when we download the file. Request automatically does this when you do a GET:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> request <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;request&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> readStream <span class="op">=</span> <span class="at">request</span>(<span class="st">&#39;https://dummydomain.com/some-very-large-file&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Once we have a read stream, we can simply pipe it into a POST request that will in turn upload the file to our destination:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">readStream</span>.<span class="at">pipe</span>(<span class="va">request</span>.<span class="at">post</span>(<span class="st">&#39;https://dummydomain.com/some-destination&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>Rather than loading the large file into memory, this sends chunks of data to the destination as soon as they’re downloaded, leaving a small memory footprint. Streams are great for handling chunks of data at a time and reducing memory use. In some cases, the expected memory usage of handling some kinds of data may not require the use of streams, but when memory usage is expected to be a bottleneck, then streams are extremely valuable for optimizing performance.</p>
<p>https://carlosrymer.com/using-node-streams-to-handle-large-file-uploads-24c1a0141b9c</p>
