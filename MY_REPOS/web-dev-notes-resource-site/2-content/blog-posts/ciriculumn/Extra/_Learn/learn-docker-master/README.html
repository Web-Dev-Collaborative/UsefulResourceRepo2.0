<h1 id="docker-believe-the-hype">Docker: Believe the Hype!</h1>
<figure>
<img src="http://i.imgur.com/KgdWLdh.png" alt="Docker Logo" /><figcaption>Docker Logo</figcaption>
</figure>
<p>Learn how to use docker.io containers to consistently deploy your apps on any infrastructure.</p>
<h2 id="why">Why?</h2>
<p>Have you ever struggled to get your developer environment set up as a new user on an existing project? Or have you ever had difficulty reproducing a bug or error that another team member is experiencing? Or that only exists in your production environment but not in your development environment? If you have, then you have encountered some of the difficulties that can arise when code is run in different environments. Docker is the solution to these problems as well as offering a host of other benefits.</p>
<p>Docker containers offer the isolated environment advantages of running a virtual machine, but are more lightweight, portable, scalable and have less overhead/hassle. - reduce the delay between writing code and running it in production - automation of the environment set up saves time setting up new users and time trying to reproduce bugs/errors - easily create <a href="https://en.wikipedia.org/wiki/Sandbox_%28computer_security%29">sandboxes</a> - reduces ‘dependency hell’ - easy to perform deployment rollbacks - Good for legacy, native, Linux and Windows based apps</p>
<h2 id="what">What?</h2>
<ul>
<li>Docker’s official definition is that it’s ‘an open platform for developing, shipping, and running applications’.</li>
<li>It provides you with the ability to package and run an application in a loosely isolated environment called a container.</li>
<li>Your defined environment (dependency versions and environment variables) can then be run by whomever is working on / viewing the application. This means that everyone can have the same experience.</li>
<li>To create this isolated environment for your application put it into a ‘container’ (a standardised unit of software):</li>
</ul>
<p><a href="https://www.docker.com/resources/what-container"><strong>Container</strong></a> &gt; A container is a standard unit of software that packages up code and all its dependencies so the application runs quickly and reliably from one computing environment to another.</p>
<p><strong>Container image</strong> &gt; A Docker container image is a lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries and settings. Container images become containers at runtime and in the case of Docker containers - images become containers when they run on <a href="https://www.docker.com/products/docker-engine">Docker Engine</a>. </p>
<ul>
<li>Read the <em>official</em> “Docker overview” (10 minute read): https://docs.docker.com/engine/docker-overview/</li>
<li>Watch this 12 minute video on what Docker is and a simple example of how to use it: https://youtu.be/YFl2mCHdv24. Follow along with the example if you want to test it out for yourself!</li>
</ul>
<h2 id="how">How?</h2>
<h3 id="installation">Installation</h3>
<ul>
<li>Mac: https://docs.docker.com/docker-for-mac/install/</li>
<li>Windows: https://docs.docker.com/docker-for-windows/install/</li>
<li>Linux: you already have LXC but can install a native docker package by clicking “Linux” and selecting your distro from the list or installing a binary: https://docs.docker.com/install/linux/docker-ce/binaries/</li>
</ul>
<p>Mac example walk through:</p>
<ol type="1">
<li><p>Create a Docker Hub account: https://hub.docker.com/ You need an account to be able to download Docker Desktop. Docker Hub lets you store your docker files (public &amp; private) so you can share these with people and deploy them anywhere.</p></li>
<li><p>Download Docker Desktop for Mac: https://hub.docker.com/editions/community/docker-ce-desktop-mac The file is <strong>546.8MB</strong> and you need Mac OS Sierra or later, and to have at least 4GB of RAM.</p></li>
<li><p>Install Docker Desktop on your Mac. Open the <code>docker.dmg</code> file you downloaded, and drag the Docker app’s whale icon into your Applications folder.</p></li>
</ol>
<figure>
<img src="https://user-images.githubusercontent.com/16775804/54625627-8bdb4200-4a67-11e9-9b9d-891d20ea359c.png" alt="drag-docker-to-applications" /><figcaption>drag-docker-to-applications</figcaption>
</figure>
<ol start="4" type="1">
<li>Open and run Docker When you run the Docker app, a little whale icon will appear on the right-hand side of the menu bar at the top of your screen. It might take a few minutes to get running, and Docker may ask your permission to use services on your computer. The app will also prompt you to enter your Docker Hub account details.</li>
</ol>
<h2 id="once-installed">Once installed</h2>
<p>Once you’ve installed Docker, opened it and signed in to your account you can now open a command-line terminal, and try out some Docker commands.</p>
<ul>
<li><p>Try <code>docker version</code> to check that you have the latest release installed.</p></li>
<li><p>Or run <code>docker run hello-world</code> to verify that Docker is pulling images and running as expected.</p></li>
</ul>
<p>You should see something like this in your terminal:</p>
<figure>
<img src="https://user-images.githubusercontent.com/16775804/54629658-f2645e00-4a6f-11e9-8ce0-139243a022d6.png" alt="docker-configured" /><figcaption>docker-configured</figcaption>
</figure>
<p>As it suggests, next try to run an ubuntu container (<em>only do this on a fast internet connection as its going to download 65mb ubuntu image</em>)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">docker</span> run -it ubuntu bash</a></code></pre></div>
<figure>
<img src="https://user-images.githubusercontent.com/16775804/54629793-39eaea00-4a70-11e9-91c3-328132251a00.png" alt="download ubuntu" /><figcaption>download ubuntu</figcaption>
</figure>
<p>This will boot the Ubuntu image and log you into the container’s bash. You can confirm that you are in a Linux bash by running the following command: <code>cat /etc/os-release</code></p>
<figure>
<img src="https://user-images.githubusercontent.com/16775804/54629885-69015b80-4a70-11e9-976d-c25b34373a6a.png" alt="confirm-running-ubuntu" /><figcaption>confirm-running-ubuntu</figcaption>
</figure>
<p>List the containers:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">docker</span> container ls</a></code></pre></div>
<p>Which shows:</p>
<figure>
<img src="https://user-images.githubusercontent.com/16775804/54669601-b241c180-4ae9-11e9-9bf5-e246b1cfa6aa.png" alt="docker-container-ls" /><figcaption>docker-container-ls</figcaption>
</figure>
<p>See: https://docs.docker.com/engine/reference/commandline/container_ls/ for ways to make this command more specific.</p>
<p>And for even more detail, run <code>docker info</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="ex">Containers</span>: 2</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ex">Images</span>: 6</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="ex">Storage</span> Driver: aufs</a>
<a class="sourceLine" id="cb3-4" title="4"> <span class="ex">Root</span> Dir: /mnt/sda1/var/lib/docker/aufs</a>
<a class="sourceLine" id="cb3-5" title="5"> <span class="ex">Backing</span> Filesystem: extfs</a>
<a class="sourceLine" id="cb3-6" title="6"> <span class="ex">Dirs</span>: 10</a>
<a class="sourceLine" id="cb3-7" title="7"> <span class="ex">Dirperm1</span> Supported: true</a>
<a class="sourceLine" id="cb3-8" title="8"><span class="ex">Execution</span> Driver: native-0.2</a>
<a class="sourceLine" id="cb3-9" title="9"><span class="ex">Logging</span> Driver: json-file</a>
<a class="sourceLine" id="cb3-10" title="10"><span class="ex">Kernel</span> Version: 4.0.9-boot2docker</a>
<a class="sourceLine" id="cb3-11" title="11"><span class="ex">Operating</span> System: Boot2Docker 1.8.1 (TCL 6.3); <span class="ex">master</span> : 7f12e95 - Thu Aug 13 03:24:56 UTC 2015</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="ex">CPUs</span>: 1</a>
<a class="sourceLine" id="cb3-13" title="13"><span class="ex">Total</span> Memory: 1.956 GiB</a>
<a class="sourceLine" id="cb3-14" title="14"><span class="ex">Name</span>: default</a>
<a class="sourceLine" id="cb3-15" title="15"><span class="ex">ID</span>: VIPW:LYBS:LT7I:KWTS:DU5U:W2NG:MWMH:EQNS:PFTF:4ZLN:STYL:4HG2</a>
<a class="sourceLine" id="cb3-16" title="16"><span class="ex">Debug</span> mode (server)<span class="bu">:</span> true</a>
<a class="sourceLine" id="cb3-17" title="17"><span class="ex">File</span> Descriptors: 9</a>
<a class="sourceLine" id="cb3-18" title="18"><span class="ex">Goroutines</span>: 20</a>
<a class="sourceLine" id="cb3-19" title="19"><span class="ex">System</span> Time: 2015-08-16T22:27:21.593654583Z</a>
<a class="sourceLine" id="cb3-20" title="20"><span class="ex">EventsListeners</span>: 0</a>
<a class="sourceLine" id="cb3-21" title="21"><span class="ex">Init</span> SHA1:</a>
<a class="sourceLine" id="cb3-22" title="22"><span class="ex">Init</span> Path: /usr/local/bin/docker</a>
<a class="sourceLine" id="cb3-23" title="23"><span class="ex">Docker</span> Root Dir: /mnt/sda1/var/lib/docker</a>
<a class="sourceLine" id="cb3-24" title="24"><span class="ex">Labels</span>:</a>
<a class="sourceLine" id="cb3-25" title="25"> <span class="va">provider=</span>virtualbox</a></code></pre></div>
<h3 id="run-the-dockerfile-in-this-repo">Run the <code>Dockerfile</code> in this repo</h3>
<p>First build the image:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">docker</span> build -t learn-docker .</a></code></pre></div>
<p>Then run the image as a container:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">docker</span> run -it -p 8888:8888 learn-docker bash</a></code></pre></div>
<blockquote>
<p>https://docs.docker.com/v17.09/engine/reference/commandline/run/</p>
</blockquote>
<p>Exec (for running a command in a running container)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">docker</span> exec -it learn-docker bash</a></code></pre></div>
<blockquote>
<p>https://docs.docker.com/v17.09/engine/reference/commandline/exec/</p>
</blockquote>
<h3 id="list-locally-available-images">List (<em>Locally Available</em>) Images</h3>
<p>View the current (<em>locally</em>) available docker images:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="ex">docker</span> images</a></code></pre></div>
<p>You should see:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="ex">REPOSITORY</span>          TAG                 IMAGE ID            CREATED                  VIRTUAL SIZE</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ex">learn-docker</span>        latest              0c495aa0e6dc        Less than a second ago   261.6 MB</a>
<a class="sourceLine" id="cb8-3" title="3"><span class="ex">ubuntu</span>              14.04               8251da35e7a7        8 days ago               188.4 MB</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="ex">ubuntu</span>              latest              8251da35e7a7        8 days ago               188.4 MB</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="ex">hello-world</span>         latest              af340544ed62        9 days ago               960 B</a></code></pre></div>
<h3 id="docker-ps"><code>docker ps</code></h3>
<p>To list all the running docker containers, use:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="ex">docker</span> ps -a</a></code></pre></div>
<blockquote>
<p>https://docs.docker.com/v17.09/engine/reference/commandline/ps/</p>
</blockquote>
<h3 id="more-info-on-a-specific-container">More info on a specific container</h3>
<p>To get more detail on a container type: <code>docker inspect {imageid}</code></p>
<p>e.g: in our case the container we are interested in has the id: <strong>a205fc3a096f</strong> so we run:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">docker</span> inspect a205fc3a096f</a></code></pre></div>
<p>The complete output of this command is in: <a href="https://github.com/dwyl/learn-docker/blob/e8769347940dc13d8197742b9e232e3efd85ca8d/sample-docker-inspect.txt">/<strong>sample-docker-inspect.txt</strong></a></p>
<h4 id="just-the-ip-address">Just the IP address</h4>
<p>If all we want is the container’s IP address we run:<br />
<code>docker inspect --format '{{ .NetworkSettings.IPAddress }}' a205fc3a096f</code><br />
where the last argument is the container (image) id.<br />
<small>Courtesy of: http://stackoverflow.com/a/20686101/1148249</small></p>
<h3 id="kill-a-container-by-id">Kill a Container by ID</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="ex">docker</span> stop a205fc3a096f</a></code></pre></div>
<blockquote>
<p>https://docs.docker.com/v17.09/engine/reference/commandline/stop/</p>
</blockquote>
<h2 id="help">Help!</h2>
<p>For some reason I’m unable to access the <strong>nginx</strong> server running inside the docker container … looked at: + http://stackoverflow.com/questions/31324981/how-to-access-host-port-from-docker-container + http://stackoverflow.com/questions/31448249/how-to-deploy-web-service-on-docker-container + http://stackoverflow.com/questions/27714900/nginx-on-docker-daemonize-and-attach-to-bash</p>
<h3 id="is-nginx-working">is nginx working?</h3>
<ul>
<li>http://askubuntu.com/questions/443775/nginx-failing-to-reload-how-to-track-down-why</li>
</ul>
<p>Test that your nginx configuration is valid (doesn’t have errors)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">sudo</span> nginx -t</a></code></pre></div>
<p>expect the following output:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">nginx</span>: the configuration file /etc/nginx/nginx.conf syntax is ok</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="ex">nginx</span>: configuration file /etc/nginx/nginx.conf test is successful</a></code></pre></div>
<h2 id="docker-and-pete-stack">Docker and <a href="https://github.com/dwyl/technology-stack#the-pete-stack">“PETE” stack</a></h2>
<p>You can create or run a Phoenix application by using the following Dockerfile:</p>
<pre><code>FROM elixir:1.7.3

RUN mix local.hex --force \
  &amp;&amp; mix archive.install hex phx_new 1.4.0 --force \
  &amp;&amp; apt-get update \
  &amp;&amp; curl -sL https://deb.nodesource.com/setup_8.x | bash \
  &amp;&amp; apt-get install -y apt-utils \
  &amp;&amp; apt-get install -y nodejs \
  &amp;&amp; apt-get install -y build-essential \
  &amp;&amp; apt-get install -y inotify-tools \
  &amp;&amp; mix local.rebar --force \
  &amp;&amp; wget &quot;https://github.com/elm/compiler/releases/download/0.19.0/binaries-for-linux.tar.gz&quot; \
  &amp;&amp; tar xzf binaries-for-linux.tar.gz \
  &amp;&amp; mv elm /usr/local/bin/

ENV APP_HOME /app
WORKDIR $APP_HOME


CMD [&quot;mix&quot;, &quot;phx.server&quot;]</code></pre>
<p>This will create a container with Elixir, Node.js, Elm.</p>
<p>You can then use the following <code>docker-compose.yml</code> file to use Postgres with your application:</p>
<pre><code>version: &#39;3&#39;
services:
  app:
    build: .
    ports:
      - &quot;4000:4000&quot;
    volumes:
      - .:/app
    depends_on:
      - db
    env_file:
      - ./.env
  db:
    image: postgres:10.5
    ports:
        - &quot;5432:5432&quot;</code></pre>
<p>You can then create a new Phoenix application with: <code>docker-compose run --rm app mix phx.new . --app name_of_the_app</code></p>
<p>Make sure to update the database configuration in the Phoenix application to reference the Postgres service name (ie db), for example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode elixir"><code class="sourceCode elixir"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># Configure your database</span></a>
<a class="sourceLine" id="cb16-2" title="2">config <span class="va">:app_name</span>, <span class="cn">AppName</span><span class="op">.</span><span class="cn">Repo</span>,</a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="va">username:</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="va">password:</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="va">database:</span> <span class="st">&quot;app_name_dev&quot;</span>,</a>
<a class="sourceLine" id="cb16-6" title="6">  <span class="va">hostname:</span> <span class="st">&quot;db&quot;</span>,</a>
<a class="sourceLine" id="cb16-7" title="7">  <span class="va">pool_size:</span> <span class="dv">10</span></a></code></pre></div>
<p>Use <code>docker-compose</code> if you want to run commands, for example to create the database:</p>
<p><code>docker-compose run web mix ecto.create</code></p>
<h2 id="docker-swarm-vs.-kubernetes">Docker Swarm vs. Kubernetes</h2>
<p>This repo has walked through the basic set up of Docker containers. To deal with managing multiple containers there are container management facilities or container orchestration platforms. These facilities are useful for:</p>
<ul>
<li>Running containers across many different machines</li>
<li>Scaling up or down by adding or removing containers when demand changes</li>
<li>Keeping storage consistent with multiple instances of an application</li>
<li>Distributing load between the containers</li>
<li>Launching new containers on different machines if something fails</li>
</ul>
<p>Docker offers its own such facility called <a href="https://docs.docker.com/engine/swarm/">Docker Swarm</a>. Another popular open source platform is <a href="http://kubernetes.io/">Kubernetes</a>. Kubernetes must be used in conjunction with Docker containers, it is not a complete alternative.</p>
<p>Docker Swarm and Kubernetes both have their pros and cons. Deciding which one to use comes down to what is best for your project. But as a very brief summary, Docker Swarm is considered easier to adopt with better usability than Kubernetes. Whilst slower to initially learn, Kubernetes receives praise for its ability to scale at speed for larger projects and its flexibility.</p>
<p>To find out more see: - https://blog.containership.io/k8svsdocker - https://technologyadvice.com/blog/information-technology/kubernetes-vs-docker/</p>
<h2 id="useful-links">Useful Links</h2>
<h3 id="about-docker">About Docker</h3>
<ul>
<li>Light-hearted Slideshow (with adequate detail to read through it) about what Docker is and how it is useful: https://www.slideshare.net/jpetazzo/docker-automation-for-the-rest-of-us</li>
</ul>
<h3 id="cheat-sheet">Cheat Sheet</h3>
<ul>
<li>Command Line Reference: https://docs.docker.com/engine/reference/commandline/cli/</li>
<li>Cheat Sheet: https://github.com/wsargent/docker-cheat-sheet</li>
</ul>
<h3 id="videos">Videos</h3>
<ul>
<li>Introduction to Docker - (Twitter University): https://www.youtube.com/watch?v=Q5POuMHxW-0 47mins - 2mins of <em>content</em>!</li>
<li>Be a happier developer with Docker: https://www.youtube.com/watch?v=XCVOxht34Hs 25mins - relevant to developers</li>
</ul>
<h3 id="tutorials">Tutorials</h3>
<ul>
<li>https://www.imore.com/how-run-docker-your-mac</li>
<li>http://blog.xebia.com/2014/06/18/deploying-a-node-js-app-to-docker-on-coreos-using-deis/</li>
</ul>
