<h1 id="linode-setup">Linode Setup</h1>
<figure>
<img src="https://user-images.githubusercontent.com/194400/28843865-8f8c1808-76fa-11e7-80f3-a8c7f66fdde1.png" alt="linode-logo" /><figcaption>linode-logo</figcaption>
</figure>
<p>If you are new to Linode, <em>please</em> signup using the following link<sup>1</sup>: https://www.linode.com/?r=5b426b2a0a026ebcf71261b824fa3a0ff3a6f82d and use promo code <code>DOCS10</code> for <strong>$10 credit</strong> on your new account.</p>
<p>Signed up: <img src="https://user-images.githubusercontent.com/194400/28494556-052afe86-6f2a-11e7-8b89-e5a456d36c50.png" alt="image" /> <img src="https://user-images.githubusercontent.com/194400/28494569-657beba6-6f2a-11e7-8ea6-e626dae58c83.png" alt="image" /></p>
<h2 id="create-a-virtual-machine-instance">Create a Virtual Machine “Instance”</h2>
<p>There are <em>two</em> options for creating a Virtual Machine (VM): (A) Manually and (B) Automated.</p>
<h3 id="a.-manual-click-to-create">A. Manual (Click-to-Create)</h3>
<p>#### Step 1: Select an instance type</p>
<figure>
<img src="https://user-images.githubusercontent.com/194400/28494574-773c877e-6f2a-11e7-8e5d-c6bff04fb5dc.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>Once you’ve <em>launched</em> the instance, you should see the Linode Manager: <img src="https://user-images.githubusercontent.com/194400/28494579-86556488-6f2a-11e7-8c8f-b3059ca1dc09.png" alt="image" /></p>
<h4 id="step-2-select-the-operating-system">Step 2: Select the Operating System</h4>
<p>Select an Operating System (<em>we tend to use the most recent Ubuntu “LTS” version</em>): <br /> <img src="https://user-images.githubusercontent.com/194400/28494609-3fb1b21a-6f2b-11e7-9448-7a11ebcd6c3b.png" alt="image" /></p>
<h4 id="step-3-boot-the-new-instance">Step 3: Boot the New Instance</h4>
<p>Remember to click on <code>[Boot]</code> button to actually <em>run</em> the instance: <img src="https://user-images.githubusercontent.com/194400/28494633-079559c6-6f2c-11e7-94d4-3e5e94d00b8a.png" alt="image" /></p>
<h4 id="step-4-add-your-ssh-key-to-the-linode">Step 4: Add your SSH Key to the Linode</h4>
<p>Click on the “<strong>Dashboard</strong>” link for your VM: <img src="https://user-images.githubusercontent.com/194400/28655621-ef1d191c-7294-11e7-84ee-1f75ce16c52f.png" alt="04-linode-manager-click-dashboard" /></p>
<p>Click on “<strong>Remote Access</strong>” then click on “<strong>Launch Lish Console</strong>”: <img src="https://user-images.githubusercontent.com/194400/28655707-86518052-7295-11e7-9ab4-96cb4b323c4f.png" alt="05-linode-manager-dashboard-remote-access-click-lish" /></p>
<p>Use “Lish Console” to add <code>public</code> ssh key to the node: <img src="https://user-images.githubusercontent.com/194400/28494679-53a9c292-6f2d-11e7-910f-55a3a6a31b12.png" alt="image" /></p>
<p>Now can login from localhost using ssh using public key: <img src="https://user-images.githubusercontent.com/194400/28494687-a2e9b524-6f2d-11e7-8cdb-b6d4af9dd514.png" alt="image" /></p>
<blockquote>
<p>SSH using RSA Key: https://www.linode.com/docs/security/use-public-key-authentication-with-ssh</p>
</blockquote>
<h3 id="b.-automated-virtual-machine-provisioning-using-vagrant">B. <em>Automated</em> Virtual Machine Provisioning using Vagrant</h3>
<blockquote>
<p>For the next section we are using <code>Vagrant</code> to (<em>automate</em>) “<em>provisioning</em>” a VM. If you are new to <code>Vagrant</code>, please see: <a href="https://github.com/dwyl/learn-vagrant">github.com/dwyl/<strong>learn-vagrant</strong></a></p>
</blockquote>
<h4 id="step-1-create-a-linode-api-key">Step 1: Create a Linode API Key</h4>
<p>Login to your Linode account and visit <code>My Profile &gt; API Keys</code> then create a new key:</p>
<figure>
<img src="https://user-images.githubusercontent.com/194400/28654772-d8e4b2dc-728e-11e7-9dfe-925f20d8ff11.png" alt="02-linode-profile-api-keys-named" /><figcaption>02-linode-profile-api-keys-named</figcaption>
</figure>
<p>You should see something like this:</p>
<figure>
<img src="https://user-images.githubusercontent.com/194400/28655427-cbea2094-7293-11e7-8c37-109dc7d06ad3.png" alt="03-linode-profile-api-keys-named-display" /><figcaption>03-linode-profile-api-keys-named-display</figcaption>
</figure>
<blockquote>
<p>Don’t worry, this is not a “epic security fail” … the key is not active, it’s just for illustrative purposes.</p>
</blockquote>
<h4 id="step-2-copy-the-api-key-to-a-safe-place-and-export-as-environment-variable">Step 2: Copy the API Key (to a Safe Place) and Export as Environment Variable</h4>
<p>Copy the newly created <strong>API Key</strong> to a <strong><em>safe</em> place</strong> (<em>your choice of key storage</em>) and then <code>export</code> it as an <strong>Environment Variable</strong>:</p>
<p>In your terminal window type <code>export LINODE_API_KEY=</code> and <em>paste</em> your API Key:</p>
<pre><code>export LINODE_API_KEY=aKiuRAOe5WEgnIaGouhWz19jJSInnwQzx8wOdSlAIEMkk4Z8cXGQQHQBdB2MSaRk</code></pre>
<p><em>confirm</em> that Environment Variable was set by running <code>printenv</code> and checking the output.</p>
<blockquote>
<p><em>Note: if you are new to using Environment Variables, please see:</em> <a href="https://github.com/dwyl/learn-environment-variables">github.com/dwyl/<strong>learn-environment-variables</strong></a></p>
</blockquote>
<p>#### Step 3: Install the Linode Vagrant Plugin</p>
<p>Once you have installed Vagrant you will need to install the <code>vagrant-linode</code> plugin:</p>
<pre><code>vagrant plugin install vagrant-linode</code></pre>
<p>you should see:</p>
<pre><code>Installing the &#39;vagrant-linode&#39; plugin. This can take a few minutes...
Installed the plugin &#39;vagrant-linode (0.2.8)&#39;!</code></pre>
<p>Following this guide: https://www.linode.com/docs/applications/configuration-management/vagrant-linode-environments</p>
<h4 id="step-4-create-a-vagrantfile">Step 4: Create a <code>Vagrantfile</code></h4>
<p>Create a <code>Vagrantfile</code> for your project and <em>copy-paste</em> the contents of the <em>sample</em>:</p>
<h4 id="step-5-launch-a-linode-vm-using-vagrant">Step 5: Launch a Linode VM using Vagrant</h4>
<pre><code>vagrant up --debug &amp;&gt; vagrant.log</code></pre>
<blockquote>
<p>Note: that command will output the steps the <code>vagrant up</code> command to <code>vagrant.log</code> so you can monitor it’s progress (eventual success/failure). Rememver to add the <code>vagrant.log</code> to your <code>.gitignore</code> file as it’s <strong>thousands of lines</strong> which change each time an instance is created. e.g:</p>
</blockquote>
<pre><code>echo &quot;vagrant.log &gt;&gt; .gitignore&quot;</code></pre>
<p>You should see something similar to: <img src="https://user-images.githubusercontent.com/194400/28662379-e1fd97bc-72b1-11e7-9226-372f95edefb5.png" alt="vagrant-up" /> Once the <code>vagrant up</code> command has completed provisioning the Linode VM, <em>login</em> to the VM using the command:</p>
<pre><code>vagrant ssh</code></pre>
<p>that will give you the IP Address of the Vagrant Box, which in our case is: <strong>213.168.248.157</strong></p>
<p>If you visit the IP address in a browser you will see a <code>502</code> error:</p>
<figure>
<img src="https://user-images.githubusercontent.com/194400/28662539-67d6a608-72b2-11e7-810c-0098edb2396c.png" alt="nginx-502-error" /><figcaption>nginx-502-error</figcaption>
</figure>
<p>That is a <em>good</em> thing because it tells you that NGiNX is working! (<em>the <code>502</code> is because we don’t have a Phoenix app running on port <code>4000</code>, yet!</em>)</p>
<h4 id="step-6-build-deploy-start-a-phoenix-app-using-edeliver">Step 6: Build, Deploy &amp; Start a Phoenix App using Edeliver</h4>
<pre><code>git clone git@github.com:nelsonic/hello_world_edeliver.git
cd hello_world_edeliver</code></pre>
<p>Open the <code>.deliver/config</code> file and update: + <code>BUILD_HOST</code> (IP Address) + <code>BUILD_USER</code> + <code>PRODUCTION_USER</code></p>
<p>to the values you need. In our case I updated the values to:</p>
<pre><code>BUILD_HOST=&quot;213.168.248.157&quot;
BUILD_USER=&quot;ubuntu&quot;
BUILD_AT=&quot;/home/ubuntu/hello_world_edeliver/builds&quot;

PRODUCTION_HOSTS=&quot;213.168.248.157&quot;
PRODUCTION_USER=&quot;ubuntu&quot;
DELIVER_TO=&quot;/home/ubuntu&quot;</code></pre>
<p>see: <a href="https://github.com/nelsonic/hello_world_edeliver/blob/fd65c19118509f06177d58c145dae18669e04479/.deliver/config#L3-L9">.deliver/config#L3-L9</a></p>
<p>Now run the <code>edeliver</code> commands to <code>build</code>, <code>deploy</code> and <code>start</code></p>
<pre><code>mix edeliver build release --verbose --branch=continuous-delivery
mix edeliver deploy release to production --verbose
mix edeliver start production</code></pre>
<p>You should see: <img src="https://user-images.githubusercontent.com/194400/28664767-61cacf4e-72b9-11e7-8274-40543cd08c0a.png" alt="edeliver-deploy-start" /></p>
<p>And when you refresh the browser page you should see the Phoenix App! <img src="https://user-images.githubusercontent.com/194400/28665164-ab3f5e28-72ba-11e7-90a5-2a59511932fd.png" alt="phoenix-linode-working" /></p>
<p>So now we have a working server running a Phoenix App on Linode!</p>
<!--
## Notes

Re-sizing a VM appears to be pretty straightforward:
![image](https://user-images.githubusercontent.com/194400/28494605-2807bc9a-6f2b-11e7-976b-80d58416e17d.png)
-->
