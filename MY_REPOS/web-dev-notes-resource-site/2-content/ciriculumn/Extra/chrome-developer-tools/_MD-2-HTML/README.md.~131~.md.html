<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<link rel="stylesheet" href="./prism.css">
<script async defer src="./prism.js"></script>
</head>
<body>;
<h1 id="multi-table-queries-and-database-helpers">Multi-Table Queries and Database Helpers</h1>
<h2 id="topics">Topics</h2>
<ul>
<li>Joins</li>
<li>Database Queries</li>
<li>Knex Queries</li>
<li>Modular Code</li>
</ul>
<h2 id="assignment">Assignment</h2>
<p>For this lab you will</p>
<ul>
<li>[X] write SQL statements against the <code>northwind.db3</code> database. Once you have the correct SQL Statement for each query, write it inside the <em>queries.sql</em> file under the corresponding comment.</li>
<li>[X] write the db helper methods for the <code>schemes</code> resource in <code>./schemes/scheme-model.js</code></li>
</ul>
<h3 id="multi-table-queries">Multi Table Queries</h3>
<p>Use a graphical tool like <code>SQLite Studio</code> to open <code>./data/northwind.db3</code> and execute the following queries:</p>
<ul>
<li>[X] Display the ProductName and CategoryName for all products in the database. Returns 77 records.</li>
<li>[X] Display the order Id and shipper CompanyName for all orders placed before August 9 2012. Returns 429 records.</li>
<li>[X] Display the name and quantity of the products ordered in order with Id 10251. Sort by ProductName. Returns 3 records.</li>
<li>[X] Display the OrderID, customer’s Company Name and the employee’s Last Name for every order. All columns should be labeled clearly. Returns 16,789 records.</li>
</ul>
<h3 id="database-methods">Database Methods</h3>
<p>Write helpers methods in <code>./schemes/scheme-model.js</code> that match the following specifications:</p>
<ul>
<li>[X] <code>find()</code>:
<ul>
<li>Calling find returns a promise that resolves to an array of all schemes in the database.</li>
<li>No steps are included.</li>
</ul></li>
<li>[X] <code>findById(id)</code>:
<ul>
<li>Expects a scheme <code>id</code> as its only parameter.</li>
<li>Resolve to a single scheme object.</li>
<li>On an invalid <code>id</code>, resolves to <code>null</code>.</li>
</ul></li>
<li>[X] <code>findSteps(id)</code>:
<ul>
<li>Expects a scheme <code>id</code>.</li>
<li>Resolves to an array of all correctly ordered step for the given scheme: <code>[ { id: 17, scheme_name: 'Find the Holy Grail', step_number: 1, instructions: 'quest'}, { id: 18, scheme_name: 'Find the Holy Grail', step_number: 2, instructions: '...and quest'}, etc. ]</code>.</li>
<li>This array should include the <code>scheme_name</code> <em>not</em> the <code>scheme_id</code>.</li>
</ul></li>
<li>[X] <code>add(scheme)</code>:
<ul>
<li>Expects a scheme object.</li>
<li>Inserts scheme into the database.</li>
<li>Resolves to the newly inserted scheme, including <code>id</code>.</li>
</ul></li>
<li>[X] <code>update(changes, id)</code>:
<ul>
<li>Expects a changes object and an <code>id</code>.</li>
<li>Updates the scheme with the given id.</li>
<li>Resolves to the newly updated scheme object.</li>
</ul></li>
<li>[X] <code>remove(id)</code>:
<ul>
<li>Removes the scheme object with the provided id.</li>
<li>Resolves to the removed scheme</li>
<li>Resolves to <code>null</code> on an invalid id.</li>
<li>(Hint: Only worry about removing the <code>scheme</code>. The database is configured to automatically remove all associated steps.)</li>
</ul></li>
</ul>
<h4 id="schemes-schema">Schemes Schema</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">field</th>
<th style="text-align: left;">data type</th>
<th style="text-align: left;">metadata</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">id</td>
<td style="text-align: left;">unsigned integer</td>
<td style="text-align: left;">primary key, auto-increments, generated by database</td>
</tr>
<tr class="even">
<td style="text-align: left;">scheme_name</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">required, unique</td>
</tr>
</tbody>
</table>
<h4 id="steps-schema">Steps Schema</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">field</th>
<th style="text-align: left;">data type</th>
<th style="text-align: left;">metadata</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">id</td>
<td style="text-align: left;">unsigned integer</td>
<td style="text-align: left;">primary key, auto-increments, generated by database</td>
</tr>
<tr class="even">
<td style="text-align: left;">scheme_id</td>
<td style="text-align: left;">unsigned integer</td>
<td style="text-align: left;">foreign key referencing scheme.id, required</td>
</tr>
<tr class="odd">
<td style="text-align: left;">step_number</td>
<td style="text-align: left;">unsigned integer</td>
<td style="text-align: left;">required</td>
</tr>
<tr class="even">
<td style="text-align: left;">instructions</td>
<td style="text-align: left;">string</td>
<td style="text-align: left;">required</td>
</tr>
</tbody>
</table>
<h4 id="api">API</h4>
<p>The following endpoints are available to test the functionality of the model methods.</p>
<ul>
<li><code>GET /api/schemes/</code> - gets master list of schemes (without steps)</li>
<li><code>GET /api/schemes/:id</code> - gets a single scheme</li>
<li><code>GET /api/schemes/:id/steps</code> - gets all steps for a given scheme, ordered correctly</li>
<li><code>POST /api/schemes</code> - adds a new scheme</li>
<li><code>PUT /api/schemes:id</code> - updates a given scheme</li>
<li><code>DELETE /api/schemes/:id</code> - removes a given scheme and all associated steps</li>
</ul>
<h2 id="stretch-problems">Stretch Problems</h2>
<ul>
<li>In <a href="https://www.w3schools.com/Sql/tryit.asp?filename=trysql_select_top">SQL Try Editor at W3Schools.com</a>:
<ul>
<li>[X] Displays CategoryName and a new column called Count that shows how many products are in each category. Shows 8 records.</li>
<li>[X] Display OrderID and a column called ItemCount that shows the total number of products placed on the order. Shows 196 records.</li>
</ul></li>
<li>Add the following method to your API
<ul>
<li><code>addStep(step, scheme_id)</code>: This method expects a step object and a scheme id. It inserts the new step into the database, correctly linking it to the intended scheme.</li>
<li>You may use <code>POST /api/schemes/:id/addStep</code> to test this method.</li>
</ul></li>
</ul>
</body></html>
