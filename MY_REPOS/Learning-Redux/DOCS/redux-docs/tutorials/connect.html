<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Tutorial: Connect API</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Tutorial: Connect API</h1>
    </header>
    <p>¬†</p>
    <h1 id="tutorial-using-the-connect-api">
      Tutorial: Using the <code>connect</code> API
    </h1>
    <div class="tip">
      <p>
        We now recommend using
        <a href="../api/hooks.md">the React-Redux hooks API as the default</a>.
        However, the <code>connect</code> API still works fine.
      </p>
      <p>
        This tutorial also shows some older practices we no longer recommend,
        like separating Redux logic into folders by type. We‚Äôve kept this
        tutorial as-is for completeness, but recommend reading through
        <a
          href="https://redux.js.org/tutorials/essentials/part-1-overview-concepts"
          >the ‚ÄúRedux Essentials‚Äù tutorial</a
        >
        and the
        <a href="https://redux.js.org/style-guide/style-guide"
          >Redux Style Guide</a
        >
        in the Redux docs for our current best practices.
      </p>
      <p>
        We‚Äôre working on a new tutorial that will introduce the hooks APIs.
        Until then, we suggest reading
        <a href="https://redux.js.org/tutorials/fundamentals/part-5-ui-react"
          ><strong>Redux Fundamentals, Part 5: UI and React</strong></a
        >
        for a hooks tutorial.
      </p>
    </div>
    <p>
      To see how to use React Redux in practice, we‚Äôll show a step-by-step
      example by creating a todo list app.
    </p>
    <h2 id="a-todo-list-example">A Todo List Example</h2>
    <p><strong>Jump to</strong></p>
    <ul>
      <li>
        ü§û
        <a href="https://codesandbox.io/s/9on71rvnyo">Just show me the code</a>
      </li>
      <li>üëÜ <a href="#providing-the-store">Providing the store</a></li>
      <li>
        ‚úåÔ∏è <a href="#connecting-the-components">Connecting the Component</a>
      </li>
    </ul>
    <p><strong>The React UI Components</strong></p>
    <p>We have implemented our React UI components as follows:</p>
    <ul>
      <li>
        <code>TodoApp</code> is the entry component for our app. It renders the
        header, the <code>AddTodo</code>, <code>TodoList</code>, and
        <code>VisibilityFilters</code> components.
      </li>
      <li>
        <code>AddTodo</code> is the component that allows a user to input a todo
        item and add to the list upon clicking its ‚ÄúAdd Todo‚Äù button:
        <ul>
          <li>
            It uses a controlled input that sets state upon
            <code>onChange</code>.
          </li>
          <li>
            When the user clicks on the ‚ÄúAdd Todo‚Äù button, it dispatches the
            action (that we will provide using React Redux) to add the todo to
            the store.
          </li>
        </ul>
      </li>
      <li>
        <code>TodoList</code> is the component that renders the list of todos:
        <ul>
          <li>
            It renders the filtered list of todos when one of the
            <code>VisibilityFilters</code> is selected.
          </li>
        </ul>
      </li>
      <li>
        <code>Todo</code> is the component that renders a single todo item:
        <ul>
          <li>
            It renders the todo content, and shows that a todo is completed by
            crossing it out.
          </li>
          <li>
            It dispatches the action to toggle the todo‚Äôs complete status upon
            <code>onClick</code>.
          </li>
        </ul>
      </li>
      <li>
        <code>VisibilityFilters</code> renders a simple set of filters:
        <em>all</em>, <em>completed</em>, and <em>incomplete.</em> Clicking on
        each one of them filters the todos:
        <ul>
          <li>
            It accepts an <code>activeFilter</code> prop from the parent that
            indicates which filter is currently selected by the user. An active
            filter is rendered with an underscore.
          </li>
          <li>
            It dispatches the <code>setFilter</code> action to update the
            selected filter.
          </li>
        </ul>
      </li>
      <li><code>constants</code> holds the constants data for our app.</li>
      <li>And finally <code>index</code> renders our app to the DOM.</li>
    </ul>
    <p><br /></p>
    <p><strong>The Redux Store</strong></p>
    <p>
      The Redux portion of the application has been set up using the
      <a href="https://redux.js.org">patterns recommended in the Redux docs</a>:
    </p>
    <ul>
      <li>
        Store
        <ul>
          <li>
            <code>todos</code>: A normalized reducer of todos. It contains a
            <code>byIds</code> map of all todos and a <code>allIds</code> that
            contains the list of all ids.
          </li>
          <li>
            <code>visibilityFilters</code>: A simple string <code>all</code>,
            <code>completed</code>, or <code>incomplete</code>.
          </li>
        </ul>
      </li>
      <li>
        Action Creators
        <ul>
          <li>
            <code>addTodo</code> creates the action to add todos. It takes a
            single string variable <code>content</code> and returns an
            <code>ADD_TODO</code> action with <code>payload</code> containing a
            self-incremented <code>id</code> and <code>content</code>
          </li>
          <li>
            <code>toggleTodo</code> creates the action to toggle todos. It takes
            a single number variable <code>id</code> and returns a
            <code>TOGGLE_TODO</code> action with <code>payload</code> containing
            <code>id</code> only
          </li>
          <li>
            <code>setFilter</code> creates the action to set the app‚Äôs active
            filter. It takes a single string variable <code>filter</code> and
            returns a <code>SET_FILTER</code> action with
            <code>payload</code> containing the <code>filter</code> itself
          </li>
        </ul>
      </li>
      <li>
        Reducers
        <ul>
          <li>
            The <code>todos</code> reducer
            <ul>
              <li>
                Appends the <code>id</code> to its <code>allIds</code> field and
                sets the todo within its <code>byIds</code> field upon receiving
                the <code>ADD_TODO</code> action
              </li>
              <li>
                Toggles the <code>completed</code> field for the todo upon
                receiving the <code>TOGGLE_TODO</code> action
              </li>
            </ul>
          </li>
          <li>
            The <code>visibilityFilters</code> reducer sets its slice of store
            to the new filter it receives from the
            <code>SET_FILTER</code> action payload
          </li>
        </ul>
      </li>
      <li>
        Action Types
        <ul>
          <li>
            We use a file <code>actionTypes.js</code> to hold the constants of
            action types to be reused
          </li>
        </ul>
      </li>
      <li>
        Selectors
        <ul>
          <li>
            <code>getTodoList</code> returns the <code>allIds</code> list from
            the <code>todos</code> store
          </li>
          <li>
            <code>getTodoById</code> finds the todo in the store given by
            <code>id</code>
          </li>
          <li>
            <code>getTodos</code> is slightly more complex. It takes all the
            <code>id</code>s from <code>allIds</code>, finds each todo in
            <code>byIds</code>, and returns the final array of todos
          </li>
          <li>
            <code>getTodosByVisibilityFilter</code> filters the todos according
            to the visibility filter
          </li>
        </ul>
      </li>
    </ul>
    <p>
      You may check out
      <a href="https://codesandbox.io/s/6vwyqrpqk3">this CodeSandbox</a> for the
      source code of the UI components and the unconnected Redux store described
      above.
    </p>
    <p><br /></p>
    <p>
      We will now show how to connect this store to our app using React Redux.
    </p>
    <h3 id="providing-the-store">Providing the Store</h3>
    <p>
      First we need to make the <code>store</code> available to our app. To do
      this, we wrap our app with the <code>&lt;Provider /&gt;</code> API
      provided by React Redux.
    </p>
    <pre class="jsx"><code>// index.js
import React from &#39;react&#39;
import ReactDOM from &#39;react-dom&#39;
import TodoApp from &#39;./TodoApp&#39;

import { Provider } from &#39;react-redux&#39;
import store from &#39;./redux/store&#39;

const rootElement = document.getElementById(&#39;root&#39;)
ReactDOM.render(
  &lt;Provider store={store}&gt;
    &lt;TodoApp /&gt;
  &lt;/Provider&gt;,
  rootElement
)</code></pre>
    <p>
      Notice how our <code>&lt;TodoApp /&gt;</code> is now wrapped with the
      <code>&lt;Provider /&gt;</code> with <code>store</code> passed in as a
      prop.
    </p>
    <p><img src="https://i.imgur.com/LV0XvwA.png" /></p>
    <h3 id="connecting-the-components">Connecting the Components</h3>
    <p>
      React Redux provides a <code>connect</code> function for you to read
      values from the Redux store (and re-read the values when the store
      updates).
    </p>
    <p>The <code>connect</code> function takes two arguments, both optional:</p>
    <ul>
      <li>
        <p>
          <code>mapStateToProps</code>: called every time the store state
          changes. It receives the entire store state, and should return an
          object of data this component needs.
        </p>
      </li>
      <li>
        <code>mapDispatchToProps</code>: this parameter can either be a
        function, or an object.
        <ul>
          <li>
            If it‚Äôs a function, it will be called once on component creation. It
            will receive <code>dispatch</code> as an argument, and should return
            an object full of functions that use <code>dispatch</code> to
            dispatch actions.
          </li>
          <li>
            If it‚Äôs an object full of action creators, each action creator will
            be turned into a prop function that automatically dispatches its
            action when called. <strong>Note</strong>: We recommend using this
            ‚Äúobject shorthand‚Äù form.
          </li>
        </ul>
      </li>
    </ul>
    <p>Normally, you‚Äôll call <code>connect</code> in this way:</p>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state<span class="op">,</span> ownProps) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="co">// ... computed data from state and optionally ownProps</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">const</span> mapDispatchToProps <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="co">// ... normally is an object full of action creators</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">// `connect` returns a new function that accepts the component to wrap:</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="kw">const</span> connectToStore <span class="op">=</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)</a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">// and that function returns the connected, wrapper component:</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="kw">const</span> ConnectedComponent <span class="op">=</span> <span class="at">connectToStore</span>(Component)</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">// We normally do both in one step, like this:</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(Component)</a></code></pre>
    </div>
    <p>
      Let‚Äôs work on <code>&lt;AddTodo /&gt;</code> first. It needs to trigger
      changes to the <code>store</code> to add new todos. Therefore, it needs to
      be able to <code>dispatch</code> actions to the store. Here‚Äôs how we do
      it.
    </p>
    <p>Our <code>addTodo</code> action creator looks like this:</p>
    <div class="sourceCode" id="cb3">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="co">// redux/actions.js</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">import</span> <span class="op">{</span> ADD_TODO <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./actionTypes&#39;</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">let</span> nextTodoId <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="im">export</span> <span class="kw">const</span> addTodo <span class="op">=</span> (content) <span class="kw">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="dt">type</span><span class="op">:</span> ADD_TODO<span class="op">,</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="dt">id</span><span class="op">:</span> <span class="op">++</span>nextTodoId<span class="op">,</span></a>
<a class="sourceLine" id="cb3-9" title="9">    content<span class="op">,</span></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="op">},</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">// ... other actions</span></a></code></pre>
    </div>
    <p>
      By passing it to <code>connect</code>, our component receives it as a
      prop, and it will automatically dispatch the action when it‚Äôs called.
    </p>
    <div class="sourceCode" id="cb4">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// components/AddTodo.js</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">// ... other imports</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-redux&#39;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="im">import</span> <span class="op">{</span> addTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../redux/actions&#39;</span></a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">class</span> AddTodo <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="co">// ... component implementation</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(<span class="kw">null</span><span class="op">,</span> <span class="op">{</span> addTodo <span class="op">}</span>)(AddTodo)</a></code></pre>
    </div>
    <p>
      Notice now that <code>&lt;AddTodo /&gt;</code> is wrapped with a parent
      component called <code>&lt;Connect(AddTodo) /&gt;</code>. Meanwhile,
      <code>&lt;AddTodo /&gt;</code> now gains one prop: the
      <code>addTodo</code> action.
    </p>
    <p><img src="https://i.imgur.com/u6aXbwl.png" /></p>
    <p>
      We also need to implement the <code>handleAddTodo</code> function to let
      it dispatch the <code>addTodo</code> action and reset the input
    </p>
    <pre class="jsx"><code>// components/AddTodo.js

import React from &#39;react&#39;
import { connect } from &#39;react-redux&#39;
import { addTodo } from &#39;../redux/actions&#39;

class AddTodo extends React.Component {
  // ...

  handleAddTodo = () =&gt; {
    // dispatches actions to add todo
    this.props.addTodo(this.state.input)

    // sets state back to empty string
    this.setState({ input: &#39;&#39; })
  }

  render() {
    return (
      &lt;div&gt;
        &lt;input
          onChange={(e) =&gt; this.updateInput(e.target.value)}
          value={this.state.input}
        /&gt;
        &lt;button className=&quot;add-todo&quot; onClick={this.handleAddTodo}&gt;
          Add Todo
        &lt;/button&gt;
      &lt;/div&gt;
    )
  }
}

export default connect(null, { addTodo })(AddTodo)</code></pre>
    <p>
      Now our <code>&lt;AddTodo /&gt;</code> is connected to the store. When we
      add a todo it would dispatch an action to change the store. We are not
      seeing it in the app because the other components are not connected yet.
      If you have the Redux DevTools Extension hooked up, you should see the
      action being dispatched:
    </p>
    <p><img src="https://i.imgur.com/kHvkqhI.png" /></p>
    <p>You should also see that the store has changed accordingly:</p>
    <p><img src="https://i.imgur.com/yx27RVC.png" /></p>
    <p>
      The <code>&lt;TodoList /&gt;</code> component is responsible for rendering
      the list of todos. Therefore, it needs to read data from the store. We
      enable it by calling <code>connect</code> with the
      <code>mapStateToProps</code> parameter, a function describing which part
      of the data we need from the store.
    </p>
    <p>
      Our <code>&lt;Todo /&gt;</code> component takes the todo item as props. We
      have this information from the <code>byIds</code> field of the
      <code>todos</code>. However, we also need the information from the
      <code>allIds</code> field of the store indicating which todos and in what
      order they should be rendered. Our <code>mapStateToProps</code> function
      may look like this:
    </p>
    <div class="sourceCode" id="cb6">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// components/TodoList.js</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">// ...other imports</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="kw">const</span> TodoList <span class="op">=</span> <span class="co">// ... UI component implementation</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">  <span class="kw">const</span> <span class="op">{</span> byIds<span class="op">,</span> allIds <span class="op">}</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">todos</span> <span class="op">||</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="kw">const</span> todos <span class="op">=</span></a>
<a class="sourceLine" id="cb6-11" title="11">    allIds <span class="op">&amp;&amp;</span> <span class="va">allIds</span>.<span class="at">length</span></a>
<a class="sourceLine" id="cb6-12" title="12">      <span class="op">?</span> <span class="va">allIds</span>.<span class="at">map</span>(id <span class="kw">=&gt;</span> (byIds <span class="op">?</span> <span class="op">{</span> ...<span class="at">byIds</span>[id]<span class="op">,</span> id <span class="op">}</span> : <span class="kw">null</span>))</a>
<a class="sourceLine" id="cb6-13" title="13">      : <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-14" title="14">  <span class="cf">return</span> <span class="op">{</span> todos <span class="op">};</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="op">};</span></a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps)(TodoList)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      Luckily we have a selector that does exactly this. We may simply import
      the selector and use it here.
    </p>
    <div class="sourceCode" id="cb7">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">// redux/selectors.js</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="im">export</span> <span class="kw">const</span> getTodosState <span class="op">=</span> (store) <span class="kw">=&gt;</span> <span class="va">store</span>.<span class="at">todos</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="im">export</span> <span class="kw">const</span> getTodoList <span class="op">=</span> (store) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="at">getTodosState</span>(store) <span class="op">?</span> <span class="at">getTodosState</span>(store).<span class="at">allIds</span> : []</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="im">export</span> <span class="kw">const</span> getTodoById <span class="op">=</span> (store<span class="op">,</span> id) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="at">getTodosState</span>(store) <span class="op">?</span> <span class="op">{</span> ...<span class="at">getTodosState</span>(store).<span class="at">byIds</span>[id]<span class="op">,</span> id <span class="op">}</span> : <span class="op">{}</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="im">export</span> <span class="kw">const</span> getTodos <span class="op">=</span> (store) <span class="kw">=&gt;</span></a>
<a class="sourceLine" id="cb7-12" title="12">  <span class="at">getTodoList</span>(store).<span class="at">map</span>((id) <span class="kw">=&gt;</span> <span class="at">getTodoById</span>(store<span class="op">,</span> id))</a></code></pre>
    </div>
    <div class="sourceCode" id="cb8">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// components/TodoList.js</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">// ...other imports</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="im">import</span> <span class="op">{</span> getTodos <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;../redux/selectors&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="kw">const</span> TodoList <span class="op">=</span> <span class="co">// ... UI component implementation</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(state <span class="kw">=&gt;</span> (<span class="op">{</span> <span class="dt">todos</span><span class="op">:</span> <span class="at">getTodos</span>(state) <span class="op">}</span>))(TodoList)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      We recommend encapsulating any complex lookups or computations of data in
      selector functions. In addition, you can further optimize the performance
      by using <a href="https://github.com/reduxjs/reselect">Reselect</a> to
      write ‚Äúmemoized‚Äù selectors that can skip unnecessary work. (See
      <a
        href="https://redux.js.org/recipes/computing-derived-data#sharing-selectors-across-multiple-components"
        >the Redux docs page on Computing Derived Data</a
      >
      and the blog post
      <a
        href="https://blog.isquaredsoftware.com/2017/12/idiomatic-redux-using-reselect-selectors/"
        >Idiomatic Redux: Using Reselect Selectors for Encapsulation and
        Performance</a
      >
      for more information on why and how to use selector functions.)
    </p>
    <p>
      Now that our <code>&lt;TodoList /&gt;</code> is connected to the store. It
      should receive the list of todos, map over them, and pass each todo to the
      <code>&lt;Todo /&gt;</code> component. <code>&lt;Todo /&gt;</code> will in
      turn render them to the screen. Now try adding a todo. It should come up
      on our todo list!
    </p>
    <p><img src="https://i.imgur.com/N68xvrG.png" /></p>
    <p>
      We will connect more components. Before we do this, let‚Äôs pause and learn
      a bit more about <code>connect</code> first.
    </p>
    <h3 id="common-ways-of-calling-connect">
      Common ways of calling <code>connect</code>
    </h3>
    <p>
      Depending on what kind of components you are working with, there are
      different ways of calling <code>connect</code> , with the most common ones
      summarized as below:
    </p>
    <table>
      <colgroup>
        <col style="width: 21%" />
        <col style="width: 34%" />
        <col style="width: 43%" />
      </colgroup>
      <thead>
        <tr class="header">
          <th></th>
          <th>Do Not Subscribe to the Store</th>
          <th>Subscribe to the Store</th>
        </tr>
      </thead>
      <tbody>
        <tr class="odd">
          <td>Do Not Inject Action Creators</td>
          <td><code>connect()(Component)</code></td>
          <td><code>connect(mapStateToProps)(Component)</code></td>
        </tr>
        <tr class="even">
          <td>Inject Action Creators</td>
          <td><code>connect(null, mapDispatchToProps)(Component)</code></td>
          <td>
            <code>connect(mapStateToProps, mapDispatchToProps)(Component)</code>
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="do-not-subscribe-to-the-store-and-do-not-inject-action-creators">
      Do not subscribe to the store and do not inject action creators
    </h4>
    <p>
      If you call <code>connect</code> without providing any arguments, your
      component will:
    </p>
    <ul>
      <li><em>not</em> re-render when the store changes</li>
      <li>
        receive <code>props.dispatch</code> that you may use to manually
        dispatch action
      </li>
    </ul>
    <div class="sourceCode" id="cb9">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">// ... Component</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>()(Component) <span class="co">// Component will receive `dispatch` (just like our &lt;TodoList /&gt;!)</span></a></code></pre>
    </div>
    <h4 id="subscribe-to-the-store-and-do-not-inject-action-creators">
      Subscribe to the store and do not inject action creators
    </h4>
    <p>
      If you call <code>connect</code> with only <code>mapStateToProps</code>,
      your component will:
    </p>
    <ul>
      <li>
        subscribe to the values that <code>mapStateToProps</code> extracts from
        the store, and re-render only when those values have changed
      </li>
      <li>
        receive <code>props.dispatch</code> that you may use to manually
        dispatch action
      </li>
    </ul>
    <div class="sourceCode" id="cb10">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// ... Component</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">partOfState</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps)(Component)</a></code></pre>
    </div>
    <h4 id="do-not-subscribe-to-the-store-and-inject-action-creators">
      Do not subscribe to the store and inject action creators
    </h4>
    <p>
      If you call <code>connect</code> with only
      <code>mapDispatchToProps</code>, your component will:
    </p>
    <ul>
      <li><em>not</em> re-render when the store changes</li>
      <li>
        receive each of the action creators you inject with
        <code>mapDispatchToProps</code> as props and automatically dispatch the
        actions upon being called
      </li>
    </ul>
    <div class="sourceCode" id="cb11">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="im">import</span> <span class="op">{</span> addTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./actionCreators&#39;</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="co">// ... Component</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(<span class="kw">null</span><span class="op">,</span> <span class="op">{</span> addTodo <span class="op">}</span>)(Component)</a></code></pre>
    </div>
    <h4 id="subscribe-to-the-store-and-inject-action-creators">
      Subscribe to the store and inject action creators
    </h4>
    <p>
      If you call <code>connect</code> with both
      <code>mapStateToProps</code> and <code>mapDispatchToProps</code>, your
      component will:
    </p>
    <ul>
      <li>
        subscribe to the values that <code>mapStateToProps</code> extracts from
        the store, and re-render only when those values have changed
      </li>
      <li>
        receive all of the action creators you inject with
        <code>mapDispatchToProps</code> as props and automatically dispatch the
        actions upon being called.
      </li>
    </ul>
    <div class="sourceCode" id="cb12">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> actionCreators <span class="im">from</span> <span class="st">&#39;./actionCreators&#39;</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">// ... Component</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="va">state</span>.<span class="at">partOfState</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> actionCreators)(Component)</a></code></pre>
    </div>
    <p>
      These four cases cover the most basic usages of <code>connect</code>. To
      read more about <code>connect</code>, continue reading our
      <a href="../api/connect.md">API section</a> that explains it in more
      detail.
    </p>
    <!-- TODO: Put up link to the page that further explains connect -->
    <hr />
    <p>Now let‚Äôs connect the rest of our <code>&lt;TodoApp /&gt;</code>.</p>
    <p>
      How should we implement the interaction of toggling todos? A keen reader
      might already have an answer. If you have your environment set up and have
      followed through up until this point, now is a good time to leave it aside
      and implement the feature by yourself. There would be no surprise that we
      connect our <code>&lt;Todo /&gt;</code> to dispatch
      <code>toggleTodo</code> in a similar way:
    </p>
    <div class="sourceCode" id="cb13">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="co">// components/Todo.js</span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">// ... other imports</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="im">import</span> <span class="op">{</span> toggleTodo <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;../redux/actions&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-6" title="6"></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="kw">const</span> Todo <span class="op">=</span> <span class="co">// ... component implementation</span></a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-11" title="11">  <span class="op">{</span> toggleTodo <span class="op">}</span></a>
<a class="sourceLine" id="cb13-12" title="12">)(Todo)<span class="op">;</span></a></code></pre>
    </div>
    <p>Now our todo‚Äôs can be toggled complete. We‚Äôre almost there!</p>
    <p><img src="https://i.imgur.com/4UBXYtj.png" /></p>
    <p>Finally, let‚Äôs implement our <code>VisibilityFilters</code> feature.</p>
    <p>
      The <code>&lt;VisibilityFilters /&gt;</code> component needs to be able to
      read from the store which filter is currently active, and dispatch actions
      to the store. Therefore, we need to pass both a
      <code>mapStateToProps</code> and <code>mapDispatchToProps</code>. The
      <code>mapStateToProps</code> here can be a simple accessor of the
      <code>visibilityFilter</code> state. And the
      <code>mapDispatchToProps</code> will contain the
      <code>setFilter</code> action creator.
    </p>
    <div class="sourceCode" id="cb14">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="co">// components/VisibilityFilters.js</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">// ... other imports</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;react-redux&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="im">import</span> <span class="op">{</span> setFilter <span class="op">}</span> <span class="im">from</span> <span class="st">&quot;../redux/actions&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw">const</span> VisibilityFilters <span class="op">=</span> <span class="co">// ... component implementation</span></a>
<a class="sourceLine" id="cb14-8" title="8"></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="kw">const</span> mapStateToProps <span class="op">=</span> state <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-10" title="10">  <span class="cf">return</span> <span class="op">{</span> <span class="dt">activeFilter</span><span class="op">:</span> <span class="va">state</span>.<span class="at">visibilityFilter</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="op">};</span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(</a>
<a class="sourceLine" id="cb14-13" title="13">  mapStateToProps<span class="op">,</span></a>
<a class="sourceLine" id="cb14-14" title="14">  <span class="op">{</span> setFilter <span class="op">}</span></a>
<a class="sourceLine" id="cb14-15" title="15">)(VisibilityFilters)<span class="op">;</span></a></code></pre>
    </div>
    <p>
      Meanwhile, we also need to update our
      <code>&lt;TodoList /&gt;</code> component to filter todos according to the
      active filter. Previously the <code>mapStateToProps</code> we passed to
      the <code>&lt;TodoList /&gt;</code> <code>connect</code> function call was
      simply the selector that selects the whole list of todos. Let‚Äôs write
      another selector to help filtering todos by their status.
    </p>
    <div class="sourceCode" id="cb15">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="co">// redux/selectors.js</span></a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">// ... other selectors</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="im">export</span> <span class="kw">const</span> getTodosByVisibilityFilter <span class="op">=</span> (store<span class="op">,</span> visibilityFilter) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="kw">const</span> allTodos <span class="op">=</span> <span class="at">getTodos</span>(store)</a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="cf">switch</span> (visibilityFilter) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-7" title="7">    <span class="cf">case</span> <span class="va">VISIBILITY_FILTERS</span>.<span class="at">COMPLETED</span><span class="op">:</span></a>
<a class="sourceLine" id="cb15-8" title="8">      <span class="cf">return</span> <span class="va">allTodos</span>.<span class="at">filter</span>((todo) <span class="kw">=&gt;</span> <span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb15-9" title="9">    <span class="cf">case</span> <span class="va">VISIBILITY_FILTERS</span>.<span class="at">INCOMPLETE</span><span class="op">:</span></a>
<a class="sourceLine" id="cb15-10" title="10">      <span class="cf">return</span> <span class="va">allTodos</span>.<span class="at">filter</span>((todo) <span class="kw">=&gt;</span> <span class="op">!</span><span class="va">todo</span>.<span class="at">completed</span>)</a>
<a class="sourceLine" id="cb15-11" title="11">    <span class="cf">case</span> <span class="va">VISIBILITY_FILTERS</span>.<span class="at">ALL</span><span class="op">:</span></a>
<a class="sourceLine" id="cb15-12" title="12">    <span class="cf">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb15-13" title="13">      <span class="cf">return</span> allTodos</a>
<a class="sourceLine" id="cb15-14" title="14">  <span class="op">}</span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="op">}</span></a></code></pre>
    </div>
    <p>And connecting to the store with the help of the selector:</p>
    <div class="sourceCode" id="cb16">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="co">// components/TodoList.js</span></a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb16-4" title="4"></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="kw">const</span> mapStateToProps <span class="op">=</span> (state) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-6" title="6">  <span class="kw">const</span> <span class="op">{</span> visibilityFilter <span class="op">}</span> <span class="op">=</span> state</a>
<a class="sourceLine" id="cb16-7" title="7">  <span class="kw">const</span> todos <span class="op">=</span> <span class="at">getTodosByVisibilityFilter</span>(state<span class="op">,</span> visibilityFilter)</a>
<a class="sourceLine" id="cb16-8" title="8">  <span class="cf">return</span> <span class="op">{</span> todos <span class="op">}</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb16-10" title="10"></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps)(TodoList)</a></code></pre>
    </div>
    <p>
      Now we‚Äôve finished a very simple example of a todo app with React Redux.
      All our components are connected! Isn‚Äôt that nice? üéâüéä
    </p>
    <p><img src="https://i.imgur.com/ONqer2R.png" /></p>
    <h2 id="links">Links</h2>
    <ul>
      <li>
        <a href="https://redux.js.org/basics/usage-with-react"
          >Usage with React</a
        >
      </li>
      <li>
        <a
          href="https://blog.isquaredsoftware.com/presentations/workshops/redux-fundamentals/react-redux.html"
          >Using the React Redux Bindings</a
        >
      </li>
      <li>
        <a
          href="https://medium.com/@franleplant/react-higher-order-components-in-depth-cf9032ee6c3e"
          >Higher Order Components in Depth</a
        >
      </li>
      <li>
        <a
          href="https://redux.js.org/recipes/computing-derived-data#sharing-selectors-across-multiple-components"
          >Computing Derived Data</a
        >
      </li>
      <li>
        <a
          href="https://blog.isquaredsoftware.com/2017/12/idiomatic-redux-using-reselect-selectors/"
          >Idiomatic Redux: Using Reselect Selectors for Encapsulation and
          Performance</a
        >
      </li>
    </ul>
    <h2 id="get-more-help">Get More Help</h2>
    <ul>
      <li><a href="https://www.reactiflux.com">Reactiflux</a> Redux channel</li>
      <li>
        <a href="https://stackoverflow.com/questions/tagged/react-redux"
          >StackOverflow</a
        >
      </li>
      <li>
        <a href="https://github.com/reduxjs/react-redux/issues/"
          >GitHub Issues</a
        >
      </li>
    </ul>
  </body>
</html>
