<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<h1 id="automatically-convert-audio-files-using-ffmpeg">Automatically convert audio files using ffmpeg</h1>
<p>This sample uses ffmpeg / fluent-ffmpeg and automatically converts audio files that are uploaded to Cloud Storage to FLAC file format with mono-channel audio @ 16000hz.</p>
<h2 id="functions-code">Functions Code</h2>
<p>See file <a href="functions/index.js">functions/index.js</a> for the audio conversion code.</p>
<p>The audio conversion is performed using ffmpeg. The audio is first downloaded locally from the Cloud Storage bucket to the <code>tmp</code> folder using the <a href="https://github.com/GoogleCloudPlatform/google-cloud-node">google-cloud</a> SDK.</p>
<p>The dependencies are listed in <a href="functions/package.json">functions/package.json</a>.</p>
<h2 id="trigger-rules">Trigger rules</h2>
<p>The function triggers on upload of any file to your Firebase project’s default Cloud Storage bucket.</p>
<h2 id="deploy-and-test">Deploy and test</h2>
<p>To deploy and test the sample:</p>
<ul>
<li>Create a Firebase project on the <a href="https://console.firebase.google.com">Firebase Console</a> and visit the <strong>Storage</strong> tab.</li>
<li>Get the code, for instance using <code>git clone https://github.com/firebase/functions-samples</code></li>
<li>Enter the correct directory <code>cd functions-samples/ffmpeg-convert-audio</code></li>
<li>Setup the CLI to use your Firebase project using <code>firebase use --add</code> and select your Firebase project</li>
<li>Deploy your project’s code using <code>firebase deploy</code></li>
<li>Go to the Firebase Console <strong>Storage</strong> tab and upload an audio. After a short time a converted audio with the same name but a <code>_output.flac</code> suffix will be created in the same folder (make sure you refresh the UI to see the new file).</li>
</ul>
<h2 id="notes">Notes</h2>
<ul>
<li>Take into account that the audio files produced should not exceed the size of the memory of your function.</li>
<li>The audio conversion could take a certain amount of time, increase the timeout of your function using the cloud functions webgui so the function can run for a longer time.</li>
</ul>
</body>
</html>
