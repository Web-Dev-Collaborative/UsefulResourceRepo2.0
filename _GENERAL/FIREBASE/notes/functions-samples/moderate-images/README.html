<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>README</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <h1 id="automatically-moderate-images">Automatically Moderate Images</h1>
    <p>
      This sample demonstrates how to automatically moderate offensive images
      uploaded to Firebase Storage. It uses The Google Cloud Vision API to
      detect if the image contains adult or violent content and if so uses
      ImageMagick to blur the image.
    </p>
    <h2 id="functions-code">Functions Code</h2>
    <p>
      See file <a href="functions/index.js">functions/index.js</a> for the
      moderation code.
    </p>
    <p>
      The detection of adult and violent content in an image is done using The
      <a href="https://cloud.google.com/vision/">Google Cloud Vision API</a>.
      The image blurring is performed using ImageMagick which is installed by
      default on all Cloud Functions instances. The image is first downloaded
      locally from the Firebase Storage bucket to the <code>tmp</code> folder
      using the
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-node"
        >google-cloud</a
      >
      SDK.
    </p>
    <p>
      The dependencies are listed in
      <a href="functions/package.json">functions/package.json</a>.
    </p>
    <h2 id="trigger-rules">Trigger rules</h2>
    <p>
      The function triggers on upload of any file to your Firebase project’s
      default Cloud Storage bucket.
    </p>
    <h2 id="setting-up-the-sample">Setting up the sample</h2>
    <ol type="1">
      <li>
        Create a Firebase project on the
        <a href="https://console.firebase.google.com">Firebase Console</a>.
      </li>
      <li>
        In the Google Cloud Console
        <a
          href="https://console.cloud.google.com/apis/api/vision.googleapis.com/overview?project=_"
          >enable the <strong>Google Cloud Vision API</strong></a
        >. Note: Billing is required to enable the Cloud Vision API so enable
        Billing on your Firebase project by switching to the Blaze plan. For
        more information have a look at the
        <a href="https://firebase.google.com/pricing/">pricing page</a>.
      </li>
      <li>
        Clone or download this repo and open the
        <code>moderate-image</code> directory.
      </li>
      <li>
        You must have the Firebase CLI installed. If you don’t have it install
        it with <code>npm install -g firebase-tools</code> and then configure it
        with <code>firebase login</code>.
      </li>
      <li>
        Configure the CLI locally by using <code>firebase use --add</code> and
        select your project in the list.
      </li>
      <li>
        Install dependencies locally by running:
        <code>cd functions; npm install; cd -</code>
      </li>
    </ol>
    <h2 id="deploy-and-test">Deploy and test</h2>
    <p>To test the sample:</p>
    <ol type="1">
      <li>Deploy your Cloud Functions using <code>firebase deploy</code></li>
      <li>
        Go to the Firebase Console <strong>Storage</strong> tab and upload an
        image that contains adult or violent content. After a short time,
        refresh the page. You’ll see a new folder that contains a blurred
        version of your uploaded image.
      </li>
    </ol>
  </body>
</html>
