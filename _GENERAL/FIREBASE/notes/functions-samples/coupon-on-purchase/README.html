<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>README</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <h1 id="send-a-coupon-via-fcm-to-users-who-have-completed-a-purchase">
      Send a coupon via FCM to users who have completed a purchase
    </h1>
    <p>
      This sample shows how to send a coupon to your users who have just
      purchased something. For instance: 10% off on your next purchase!
    </p>
    <h2 id="functions-code">Functions Code</h2>
    <p>
      See file <a href="functions/index.js">functions/index.js</a> for the
      trigger and the FCM code.
    </p>
    <p>
      The function assumes that you are setting the Firebase Analytics User ID
      to be the same as the Firebase Auth uid using the setUserId API. Also it
      is assumed that the FCM Device Tokens need to be saved in the Firebase
      Realtime Database under <code>/users/$uid/tokens</code>.
    </p>
    <p>
      The dependencies are listed in
      <a href="functions/package.json">functions/package.json</a>.
    </p>
    <h2 id="trigger-rules">Trigger rules</h2>
    <p>
      The function triggers on changes to <code>in_app_purchase</code> Firebase
      Analytics events. For other automatically logged events see:
      https://support.google.com/firebase/answer/6317485
    </p>
    <h2 id="deploy-and-test">Deploy and test</h2>
    <p>
      This sample can be tested on your Android and iOS app. To test it out:
    </p>
    <ul>
      <li>
        Set the project to your Firebase project using
        <code>firebase use --add</code> then select your projec tin the list.
      </li>
      <li>Deploy your project using <code>firebase deploy</code></li>
      <li>
        Make your app trigger the <code>in_app_purchase</code> event (somehow).
      </li>
      <li>
        Within a few hours the coupon will be sent by an FCM notification.
      </li>
    </ul>
  </body>
</html>
